// ==UserScript==
// @name         샤니마스 한글 패치 임시
// @namespace    https://github.com/newbiepr/shinycolors-trans-kr
// @version      1.10.1
// @description  샤니마스 임시 한글 패치 스크립트
// @icon         https://shinycolors.enza.fun/icon_192x192.png
// @author       Source : biuuu
// @match        https://shinycolors.enza.fun/*
// @run-at       document-start
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @connect      api.interpreter.caiyunai.com
// @connect      translate.google.cn
// @connect      fanyi.baidu.com
// @updateURL    https://newbiepr.gitlab.io/shinymaskr.gitlab.io/ShinyColors.user.js
// ==/UserScript==
!function(){"use strict";const e=(e,t=!1)=>t&&e.startsWith("​")?e:"​"+e;var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var o="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,n=o||s||Function("return this")(),a=n.Symbol,i=Object.prototype,c=i.hasOwnProperty,u=i.toString,l=a?a.toStringTag:void 0;var d=function(e){var t=c.call(e,l),r=e[l];try{e[l]=void 0;var o=!0}catch(e){}var s=u.call(e);return o&&(t?e[l]=r:delete e[l]),s},h=Object.prototype.toString;var p=function(e){return h.call(e)},f=a?a.toStringTag:void 0;var m=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":f&&f in Object(e)?d(e):p(e)},g=Array.isArray;var v=function(e){return null!=e&&"object"==typeof e};var y=function(e){return"string"==typeof e||!g(e)&&v(e)&&"[object String]"==m(e)};var w=function(e){return!0===e||!1===e||v(e)&&"[object Boolean]"==m(e)};var E=function(e,t){return function(r){return e(t(r))}}(Object.getPrototypeOf,Object),k=Function.prototype,S=Object.prototype,I=k.toString,b=S.hasOwnProperty,_=I.call(Object);var C=function(e){if(!v(e)||"[object Object]"!=m(e))return!1;var t=E(e);if(null===t)return!0;var r=b.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&I.call(r)==_};const T={origin:"https://newbiepr.gitlab.io/shinymaskr.gitlab.io",hash:"",localHash:"",version:"1.10.1",story:"normal",timeout:30,font1:"yuanti",font2:"heiti",auto:"off",bgm:"off",dev:!1},A=Object.assign({},T),R=["yuanti","heiti","yuanti2"],x={HEITI_JA:"UDKakugo_SmallPr6-B",HEITI_TRANS:"sczh-heiti,UDKakugo_SmallPr6-B",YUAN_JA:"HummingStd-E",YUAN_TRANS:"sczh-yuanti,HummingStd-E"},P=["origin","font1","font2","timeout","story","auto","bgm","dev"],M=P,F=()=>{x.HEITI_TRANS=`${R.includes(T.font2)?"sczh-":""}${T.font2},${x.HEITI_JA}`,x.YUAN_TRANS=`${R.includes(T.font1)?"sczh-":""}${T.font1},${x.YUAN_JA}`},D=()=>{const e={};M.forEach(t=>{T[t]!==A[t]&&(e[t]=T[t])}),F(),localStorage.setItem("sczh:setting",JSON.stringify(e))},O=()=>{let e=location.hash;e=e.slice(1).replace(/\?tdsourcetag=s_pc(tim|qq)_aiomsg/,""),e.split(";").forEach(e=>{let t=e.split("="),r=decodeURIComponent(t[0].trim()),o=t[1]?decodeURIComponent(t[1].trim()):"";r&&M.includes(r)&&(T[r]=o||A[r],D())})},j={origin:{id:0,title:"서버 바꾸기",callback:()=>{"https://newbiepr.gitlab.io/shinymaskr.gitlab.io"===T.origin?(T.origin="https://shinymaskr.work",alert("서버가 "+T.origin+"으로 교체되었습니다\nf5누르고 재접속 부탁드립니다")):(T.origin="https://newbiepr.gitlab.io/shinymaskr.gitlab.io",alert("서버가 "+T.origin+"으로 교체되었습니다\nf5누르고 재접속 부탁드립니다"))}},story:{normal:"커뮤추출 열기",edit:"커뮤추출 닫기",id:0,callback:()=>{if("normal"===T.story)T.story="edit";else{const e=document.getElementById("btn-close-sczh");e?e.click():T.story="normal"}}},bgm:{on:"백그라운드BGM 끄기",off:"백그라운드BGM 켜기",id:0,callback:()=>{T.bgm="off"!==T.bgm?"off":"on"}},dev:{id:0,titles:["개발자모드 켜기","개발자모드 끄기"],callback:()=>{T.dev=!T.dev}},wiki:{id:0,title:"샤니위키",callback:()=>{window.open("https://shinycolors.info/wiki")}},update:{id:0,title:"업데이트",callback:()=>{window.open(T.origin+"/ShinyColors.user.js")}}},B=e=>{const t=T[e],r=j[e];let o="";if(w(t)){let e=t?1:0;o=r.titles[e]}else o=r.title||r[t];const s=r.id;s&&window.GM_unregisterMenuCommand(s),r.id=window.GM_registerMenuCommand(o,()=>{(0,r.callback)(),D(),N()})},N=()=>{if(!window.GM_registerMenuCommand||!window.GM_unregisterMenuCommand)return;["origin","update","bgm","story","dev","wiki"].forEach(e=>{B(e)})};(()=>{const e=localStorage.getItem("sczh:setting");let t=JSON.parse(e);C(t)||(t={});const{origin:r}=t;/^https?:\/\//.test(r)&&(T.origin=r.trim()),M.forEach(e=>{let r=t[e];y(r)&&(r=r.trim()),(w(r)||r)&&(T[e]=r)}),F()})(),O(),N(),window.addEventListener("hashchange",O);const L=e=>{if(!e)return"";return e.replace(/[\u0020]+$/g,"").replace(/^[\u0020]+/g,"")},$=(e,t=!1)=>{let r=L(e).replace(/(\\r)?\\n/g,"\n").replace(/\\r/g,"\n");return t?r:r.replace(/\n{2,}/g,"\n")},U=e=>e.replace(/\u200b/g," "),H=e=>L(e).replace(/\r/g,"\n").replace(/\n{2,}/g,"\n"),z=(...e)=>{T.dev&&console.info(...e)},J=(...e)=>{console.info(...e)},q=e=>y(e)?e.replace(/\r?\n/g,"\\n").replace(/\r/g,"\\n"):e,W=(e="0.0.0",t="0.0.0")=>{let r=!1;const o=e.split(".").map(e=>parseInt(e,10)),s=t.split(".").map(e=>parseInt(e,10));for(let e=0;e<o.length;e++){(o[e]||0)>(s[e]||0)&&(r=!0)}return r},K=new Map,G=(t,r,o)=>{if(!t||!y(t[r]))return;const{expMap:s,wordMaps:n,textMap:a}=o,i=H(t[r]);let c=i;i&&((null==a?void 0:a.has(i))?t[r]=e(a.get(i)):(c=((e,t,r=[])=>{if(K.has(e))return K.get(e);let o=e;for(let[e,s]of t)o=o.replace(e,(...e)=>{let t=s;for(let o=1;o<e.length-2;o++){let s=e[o],n=!1;r.forEach(e=>{e.has(s)&&(t=t.replace("$"+o,e.get(s)),n=!0)}),n||(t=t.replace("$"+o,e[o]))}return t}),e.lastIndex=0;return e!==o&&K.set(e,o),o})(i,s,n),i!==c&&(t[r]=e(c))))};var Y=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Q,V=function(e){if(!Y(e))return!1;var t=m(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Z=n["__core-js_shared__"],X=(Q=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+Q:"";var ee=function(e){return!!X&&X in e},te=Function.prototype.toString;var re=function(e){if(null!=e){try{return te.call(e)}catch(e){}try{return e+""}catch(e){}}return""},oe=/^\[object .+?Constructor\]$/,se=Function.prototype,ne=Object.prototype,ae=se.toString,ie=ne.hasOwnProperty,ce=RegExp("^"+ae.call(ie).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ue=function(e){return!(!Y(e)||ee(e))&&(V(e)?ce:oe).test(re(e))};var le=function(e,t){return null==e?void 0:e[t]};var de=function(e,t){var r=le(e,t);return ue(r)?r:void 0},he=de(n,"Map");de(Object,"create"),function(){try{var e=de(Object,"defineProperty");e({},"",{})}catch(e){}}();var pe=function(e){return v(e)&&"[object Arguments]"==m(e)},fe=Object.prototype,me=fe.hasOwnProperty,ge=fe.propertyIsEnumerable;pe(function(){return arguments}());var ve=function(){return!1},ye=(r((function(e,t){var r=t&&!t.nodeType&&t,o=r&&e&&!e.nodeType&&e,s=o&&o.exports===r?n.Buffer:void 0,a=(s?s.isBuffer:void 0)||ve;e.exports=a})),r((function(e,t){var r=t&&!t.nodeType&&t,s=r&&e&&!e.nodeType&&e,n=s&&s.exports===r&&o.process,a=function(){try{var e=s&&s.require&&s.require("util").types;return e||n&&n.binding&&n.binding("util")}catch(e){}}();e.exports=a}))),we=(ye&&ye.isTypedArray,r((function(e,t){var r=t&&!t.nodeType&&t,o=r&&e&&!e.nodeType&&e,s=o&&o.exports===r?n.Buffer:void 0,a=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,o=a?a(r):new e.constructor(r);return e.copy(o),o}})),de(n,"DataView")),Ee=de(n,"Promise"),ke=de(n,"Set"),Se=de(n,"WeakMap"),Ie=re(we),be=re(he),_e=re(Ee),Ce=re(ke),Te=re(Se),Ae=m;(we&&"[object DataView]"!=Ae(new we(new ArrayBuffer(1)))||he&&"[object Map]"!=Ae(new he)||Ee&&"[object Promise]"!=Ae(Ee.resolve())||ke&&"[object Set]"!=Ae(new ke)||Se&&"[object WeakMap]"!=Ae(new Se))&&(Ae=function(e){var t=m(e),r="[object Object]"==t?e.constructor:void 0,o=r?re(r):"";if(o)switch(o){case Ie:return"[object DataView]";case be:return"[object Map]";case _e:return"[object Promise]";case Ce:return"[object Set]";case Te:return"[object WeakMap]"}return t});n.Uint8Array;var Re=a?a.prototype:void 0;Re&&Re.valueOf,ye&&ye.isMap,ye&&ye.isSet;const{origin:xe,version:Pe}=T,Me=async()=>{const e=Math.floor(Date.now()/1e3/60/60/6),t=await fetch(`${xe}/manifest.json?t=${e}`);if(t.ok){const e=await t.json();return e.time=Date.now(),localStorage.setItem("sczh:manifest",JSON.stringify(e)),e}throw new Error(`${t.status} ${t.url}`)},Fe=new Promise((e,t)=>{(async()=>{let e;try{let t=localStorage.getItem("sczh:manifest");t&&(e=JSON.parse(t)),Date.now()-e.time>60*T.cacheTime*1e3&&(e=!1)}catch(e){}return e?W(Pe,e.version)?e=await Me():setTimeout(Me,5e3):e=await Me(),e})().then(t=>{T.newVersion=t.version,T.hashes=t.hashes,e(t)}).catch(t)}),De=async(e,t)=>{if(!t){const{hashes:r}=await Fe;t=r[e.replace(/^\/(data\/)?/,"")]}return await(async e=>new Promise((t,r)=>{let o=setTimeout(()=>{r(`불러오기${e}시간초과`)},1e3*T.timeout);fetch(`${xe}${e}`).then(e=>{if(clearTimeout(o),!e.ok)return r(`${e.status} ${e.url}`),"";const t=e.headers.get("content-type");return(null==t?void 0:t.includes("json"))?e.json():e.text()}).then(t).catch(r)}))(`${e}${t?"?v="+t:""}`)};let Oe=null;const je=new Map([["AOBA",e=>e&&e.loaders&&e.Text&&e.BLEND_MODES],["SCENARIO",e=>e&&e.default&&e.default.load&&e.default._errorEvent&&e.default._handleError],["REQUEST",e=>e.get&&e.post&&e.put&&e.patch&&e._encryptRequest],["PHRASE",e=>e&&e.default&&e.default._polyglot&&e.default._polyglot.phrases],["SPEAKER",e=>e&&e.default&&e.default.getCharacterBackLogIconId]]),Be=new Map([["AOBA",e=>e],["SCENARIO",e=>e.default],["REQUEST",e=>e],["PHRASE",e=>e.default._polyglot.phrases],["SPEAKER",e=>e.default]]),Ne=Object.freeze;Object.freeze=new Proxy(Ne,{apply:(e,t,[r])=>r});const Le=/^function\s\w\((\w)\){var\s(\w)=(\w)\[\1\];if\(void\s0!==\2\)return\s\2\.exports;var\s(\w)=\3\[\1\]={id:\1,loaded:!1,exports:{}};return\s\w\[\1\]\.call\(\4\.exports,\4,\4\.exports,\w\),\4\.loaded=!0,\4\.exports}$/,$e=Function.prototype.call;let Ue={Reflect:window.Reflect};Function.prototype.call=new Proxy($e,{apply(e,t,r){var o;return(null==r||null===(o=r[3])||void 0===o?void 0:o.toString)&&Le.test(r[3].toString())&&(Oe=r[3],Function.prototype.call=$e),Ue.Reflect.apply(e,t,r)}});const He=async e=>{const{moduleId:t}=await Fe;let[r,o]=((e,t)=>{let r,o,s=((e,t)=>{let r=e+t,o=[];for(let s=e-t;s<=r;s++)s>=0&&s!==e&&o.push(s);return o.unshift(e),o})(e,50);for(let e=0;e<s.length;e++){let n;try{n=Oe(s[e])}catch(e){}if(t(n)){r=n,o=s[e];break}}return[r,o]})(t[e],je.get(e));return r?Be.get(e)(r):null},ze=e=>{const t=e.replace(/{num}/g,"\\d+").replace(/{uuid}/g,"[a-f\\d]{8}-([a-f\\d]{4}-){3}[a-f\\d]{12}");return new RegExp(`^${t}$`)},Je={get:new Map,post:new Map,patch:new Map,put:new Map},qe=(e,t,r)=>{if(!r.has(e)){const t=e.includes("{")||e.includes("("),o={handles:[],key:t?ze(e):e,type:t?"regexp":"string"};r.set(e,o)}const o=r.get(e);Array.isArray(t)?o.handles=o.handles.concat(t):o.handles.push(t)},We=(e,t,r)=>{if(Array.isArray(e))for(let o of e)qe(o,t,r);else qe(e,t,r)},Ke=e=>(t,r)=>{const o=Je[e];if(r)We(t,r,o);else{const e=t;for(let[t,r]of e)We(t,r,o)}},Ge={get:Ke("get"),post:Ke("post"),patch:Ke("patch"),put:Ke("put")};var Ye=r((function(e,t){e.exports=function e(){var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},r=!t.document&&!!t.postMessage,o=r&&/blob:/i.test((t.location||{}).protocol),s={},n=0,a={parse:function(r,o){var i=(o=o||{}).dynamicTyping||!1;if(k(i)&&(o.dynamicTypingFunction=i,i={}),o.dynamicTyping=i,o.transform=!!k(o.transform)&&o.transform,o.worker&&a.WORKERS_SUPPORTED){var c=function(){if(!a.WORKERS_SUPPORTED)return!1;var r,o,i=(r=t.URL||t.webkitURL||null,o=e.toString(),a.BLOB_URL||(a.BLOB_URL=r.createObjectURL(new Blob(["(",o,")();"],{type:"text/javascript"})))),c=new t.Worker(i);return c.onmessage=g,c.id=n++,s[c.id]=c}();return c.userStep=o.step,c.userChunk=o.chunk,c.userComplete=o.complete,c.userError=o.error,o.step=k(o.step),o.chunk=k(o.chunk),o.complete=k(o.complete),o.error=k(o.error),delete o.worker,void c.postMessage({input:r,config:o,workerId:c.id})}var p=null;return"string"==typeof r?p=o.download?new u(o):new d(o):!0===r.readable&&k(r.read)&&k(r.on)?p=new h(o):(t.File&&r instanceof File||r instanceof Object)&&(p=new l(o)),p.stream(r)},unparse:function(e,t){var r=!1,o=!0,s=",",n="\r\n",i='"',c=i+i,u=!1,l=null;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(s=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(n=t.newline),"string"==typeof t.quoteChar&&(i=t.quoteChar),"boolean"==typeof t.header&&(o=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");l=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+i)}}();var d=new RegExp(f(i),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,u);if("object"==typeof e[0])return p(l||h(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:h(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),p(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function h(e){if("object"!=typeof e)return[];var t=[];for(var r in e)t.push(r);return t}function p(e,t,r){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var i=Array.isArray(e)&&0<e.length,c=!Array.isArray(t[0]);if(i&&o){for(var u=0;u<e.length;u++)0<u&&(a+=s),a+=m(e[u],u);0<t.length&&(a+=n)}for(var l=0;l<t.length;l++){var d=i?e.length:t[l].length,h=!1,p=i?0===Object.keys(t[l]).length:0===t[l].length;if(r&&!i&&(h="greedy"===r?""===t[l].join("").trim():1===t[l].length&&0===t[l][0].length),"greedy"===r&&i){for(var f=[],g=0;g<d;g++){var v=c?e[g]:g;f.push(t[l][v])}h=""===f.join("").trim()}if(!h){for(var y=0;y<d;y++){0<y&&!p&&(a+=s);var w=i&&c?e[y]:y;a+=m(t[l][w],y)}l<t.length-1&&(!r||0<d&&!p)&&(a+=n)}}return a}function m(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var o=e.toString().replace(d,c);return"boolean"==typeof r&&r||"function"==typeof r&&r(e,t)||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(-1<e.indexOf(t[r]))return!0;return!1}(o,a.BAD_DELIMITERS)||-1<o.indexOf(s)||" "===o.charAt(0)||" "===o.charAt(o.length-1)?i+o+i:o}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!r&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=m,a.ParserHandle=p,a.NetworkStreamer=u,a.FileStreamer=l,a.StringStreamer=d,a.ReadableStreamStreamer=h,t.jQuery){var i=t.jQuery;i.fn.parse=function(e){var r=e.config||{},o=[];return this.each((function(e){if("INPUT"!==i(this).prop("tagName").toUpperCase()||"file"!==i(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var s=0;s<this.files.length;s++)o.push({file:this.files[s],inputElem:this,instanceConfig:i.extend({},r)})})),s(),this;function s(){if(0!==o.length){var t,r,s,c=o[0];if(k(e.before)){var u=e.before(c.file,c.inputElem);if("object"==typeof u){if("abort"===u.action)return t=c.file,r=c.inputElem,s=u.reason,void(k(e.error)&&e.error({name:"AbortError"},t,r,s));if("skip"===u.action)return void n();"object"==typeof u.config&&(c.instanceConfig=i.extend(c.instanceConfig,u.config))}else if("skip"===u)return void n()}var l=c.instanceConfig.complete;c.instanceConfig.complete=function(e){k(l)&&l(e,c.file,c.inputElem),n()},a.parse(c.file,c.instanceConfig)}else k(e.complete)&&e.complete()}function n(){o.splice(0,1),s()}}}function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=w(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new p(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,r){if(this.isFirstChunk&&k(this._config.beforeFirstChunk)){var s=this._config.beforeFirstChunk(e);void 0!==s&&(e=s)}this.isFirstChunk=!1,this._halted=!1;var n=this._partialLine+e;this._partialLine="";var i=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var c=i.meta.cursor;this._finished||(this._partialLine=n.substring(c-this._baseIndex),this._baseIndex=c),i&&i.data&&(this._rowCount+=i.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(o)t.postMessage({results:i,workerId:a.WORKER_ID,finished:u});else if(k(this._config.chunk)&&!r){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);i=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!u||!k(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(e){k(this._config.error)?this._config.error(e):o&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),c.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=E(this._chunkLoaded,this),t.onerror=E(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var o in e)t.setRequestHeader(o,e[o])}if(this._config.chunkSize){var s=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+s)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var r=t.statusText||e;this._sendError(new Error(r))}}function l(e){var t,r;(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),c.call(this,e);var o="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,o?((t=new FileReader).onload=E(this._chunkLoaded,this),t.onerror=E(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var s=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,s)}var n=t.readAsText(e,this._config.encoding);o||this._chunkLoaded({target:{result:n}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,r=this._config.chunkSize;return r?(e=t.substring(0,r),t=t.substring(r)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function h(e){c.call(this,e=e||{});var t=[],r=!0,o=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){o&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=E((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=E((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=E((function(){this._streamCleanUp(),o=!0,this._streamData("")}),this),this._streamCleanUp=E((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function p(e){var t,r,o,s=Math.pow(2,53),n=-s,i=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,c=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,u=this,l=0,d=0,h=!1,p=!1,g=[],v={data:[],errors:[],meta:{}};if(k(e.step)){var y=e.step;e.step=function(t){if(v=t,I())S();else{if(S(),0===v.data.length)return;l+=t.data.length,e.preview&&l>e.preview?r.abort():(v.data=v.data[0],y(v,u))}}}function E(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function S(){if(v&&o&&(_("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),o=!1),e.skipEmptyLines)for(var t=0;t<v.data.length;t++)E(v.data[t])&&v.data.splice(t--,1);return I()&&function(){if(v)if(Array.isArray(v.data[0])){for(var t=0;I()&&t<v.data.length;t++)v.data[t].forEach(r);v.data.splice(0,1)}else v.data.forEach(r);function r(t){k(e.transformHeader)&&(t=e.transformHeader(t)),g.push(t)}}(),function(){if(!v||!e.header&&!e.dynamicTyping&&!e.transform)return v;function t(t,r){var o,s=e.header?{}:[];for(o=0;o<t.length;o++){var n=o,a=t[o];e.header&&(n=o>=g.length?"__parsed_extra":g[o]),e.transform&&(a=e.transform(a,n)),a=b(n,a),"__parsed_extra"===n?(s[n]=s[n]||[],s[n].push(a)):s[n]=a}return e.header&&(o>g.length?_("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+o,d+r):o<g.length&&_("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+o,d+r)),s}var r=1;return!v.data.length||Array.isArray(v.data[0])?(v.data=v.data.map(t),r=v.data.length):v.data=t(v.data,0),e.header&&v.meta&&(v.meta.fields=g),d+=r,v}()}function I(){return e.header&&0===g.length}function b(t,r){return o=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[o]&&(e.dynamicTyping[o]=e.dynamicTypingFunction(o)),!0===(e.dynamicTyping[o]||e.dynamicTyping)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(function(e){if(i.test(e)){var t=parseFloat(e);if(n<t&&t<s)return!0}return!1}(r)?parseFloat(r):c.test(r)?new Date(r):""===r?null:r):r;var o}function _(e,t,r,o){var s={type:e,code:t,message:r};void 0!==o&&(s.row=o),v.errors.push(s)}this.parse=function(s,n,i){var c=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var r=new RegExp(f(t)+"([^]*?)"+f(t),"gm"),o=(e=e.replace(r,"")).split("\r"),s=e.split("\n"),n=1<s.length&&s[0].length<o[0].length;if(1===o.length||n)return"\n";for(var a=0,i=0;i<o.length;i++)"\n"===o[i][0]&&a++;return a>=o.length/2?"\r\n":"\r"}(s,c)),o=!1,e.delimiter)k(e.delimiter)&&(e.delimiter=e.delimiter(s),v.meta.delimiter=e.delimiter);else{var u=function(t,r,o,s,n){var i,c,u,l;n=n||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var d=0;d<n.length;d++){var h=n[d],p=0,f=0,g=0;u=void 0;for(var v=new m({comments:s,delimiter:h,newline:r,preview:10}).parse(t),y=0;y<v.data.length;y++)if(o&&E(v.data[y]))g++;else{var w=v.data[y].length;f+=w,void 0!==u?0<w&&(p+=Math.abs(w-u),u=w):u=w}0<v.data.length&&(f/=v.data.length-g),(void 0===c||p<=c)&&(void 0===l||l<f)&&1.99<f&&(c=p,i=h,l=f)}return{successful:!!(e.delimiter=i),bestDelimiter:i}}(s,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);u.successful?e.delimiter=u.bestDelimiter:(o=!0,e.delimiter=a.DefaultDelimiter),v.meta.delimiter=e.delimiter}var l=w(e);return e.preview&&e.header&&l.preview++,t=s,r=new m(l),v=r.parse(t,n,i),S(),h?{meta:{paused:!0}}:v||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,r.abort(),t=k(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){u.streamer._halted?(h=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return p},this.abort=function(){p=!0,r.abort(),v.meta.aborted=!0,k(e.complete)&&e.complete(v),t=""}}function f(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t,r=(e=e||{}).delimiter,o=e.newline,s=e.comments,n=e.step,i=e.preview,c=e.fastMode,u=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=","),s===r)throw new Error("Comment character same as delimiter");!0===s?s="#":("string"!=typeof s||-1<a.BAD_DELIMITERS.indexOf(s))&&(s=!1),"\n"!==o&&"\r"!==o&&"\r\n"!==o&&(o="\n");var l=0,d=!1;this.parse=function(e,a,h){if("string"!=typeof e)throw new Error("Input must be a string");var p=e.length,m=r.length,g=o.length,v=s.length,y=k(n),w=[],E=[],S=[],I=l=0;if(!e)return B();if(c||!1!==c&&-1===e.indexOf(t)){for(var b=e.split(o),_=0;_<b.length;_++){if(S=b[_],l+=S.length,_!==b.length-1)l+=o.length;else if(h)return B();if(!s||S.substring(0,v)!==s){if(y){if(w=[],F(S.split(r)),N(),d)return B()}else F(S.split(r));if(i&&i<=_)return w=w.slice(0,i),B(!0)}}return B()}for(var C=e.indexOf(r,l),T=e.indexOf(o,l),A=new RegExp(f(u)+f(t),"g"),R=e.indexOf(t,l);;)if(e[l]!==t)if(s&&0===S.length&&e.substring(l,l+v)===s){if(-1===T)return B();l=T+g,T=e.indexOf(o,l),C=e.indexOf(r,l)}else{if(-1!==C&&(C<T||-1===T)){if(!(C<R)){S.push(e.substring(l,C)),l=C+m,C=e.indexOf(r,l);continue}var x=L(C,R,T);if(x&&void 0!==x.nextDelim){C=x.nextDelim,R=x.quoteSearch,S.push(e.substring(l,C)),l=C+m,C=e.indexOf(r,l);continue}}if(-1===T)break;if(S.push(e.substring(l,T)),j(T+g),y&&(N(),d))return B();if(i&&w.length>=i)return B(!0)}else for(R=l,l++;;){if(-1===(R=e.indexOf(t,R+1)))return h||E.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:w.length,index:l}),O();if(R===p-1)return O(e.substring(l,R).replace(A,t));if(t!==u||e[R+1]!==u){if(t===u||0===R||e[R-1]!==u){-1!==C&&C<R+1&&(C=e.indexOf(r,R+1)),-1!==T&&T<R+1&&(T=e.indexOf(o,R+1));var P=D(-1===T?C:Math.min(C,T));if(e[R+1+P]===r){S.push(e.substring(l,R).replace(A,t)),e[l=R+1+P+m]!==t&&(R=e.indexOf(t,l)),C=e.indexOf(r,l),T=e.indexOf(o,l);break}var M=D(T);if(e.substring(R+1+M,R+1+M+g)===o){if(S.push(e.substring(l,R).replace(A,t)),j(R+1+M+g),C=e.indexOf(r,l),R=e.indexOf(t,l),y&&(N(),d))return B();if(i&&w.length>=i)return B(!0);break}E.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:w.length,index:l}),R++}}else R++}return O();function F(e){w.push(e),I=l}function D(t){var r=0;if(-1!==t){var o=e.substring(R+1,t);o&&""===o.trim()&&(r=o.length)}return r}function O(t){return h||(void 0===t&&(t=e.substring(l)),S.push(t),l=p,F(S),y&&N()),B()}function j(t){l=t,F(S),S=[],T=e.indexOf(o,l)}function B(e){return{data:w,errors:E,meta:{delimiter:r,linebreak:o,aborted:d,truncated:!!e,cursor:I+(a||0)}}}function N(){n(B()),w=[],E=[]}function L(o,s,n){var a={nextDelim:void 0,quoteSearch:void 0},i=e.indexOf(t,s+1);if(s<o&&o<i&&(i<n||-1===n)){var c=e.indexOf(r,i);if(-1===c)return a;i<c&&(i=e.indexOf(t,i+1)),a=L(c,i,n)}else a={nextDelim:o,quoteSearch:s};return a}},this.abort=function(){d=!0},this.getCharIndex=function(){return l}}function g(e){var t=e.data,r=s[t.workerId],o=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var n={abort:function(){o=!0,v(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(k(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},n),!o);a++);delete t.results}else k(r.userChunk)&&(r.userChunk(t.results,n,t.file),delete t.results)}t.finished&&!o&&v(t.workerId,t.results)}function v(e,t){var r=s[e];k(r.userComplete)&&r.userComplete(t),r.terminate(),delete s[e]}function y(){throw new Error("Not implemented.")}function w(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=w(e[r]);return t}function E(e,t){return function(){e.apply(t,arguments)}}function k(e){return"function"==typeof e}return o&&(t.onmessage=function(e){var r=e.data;if(void 0===a.WORKER_ID&&r&&(a.WORKER_ID=r.workerId),"string"==typeof r.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(r.input,r.config),finished:!0});else if(t.File&&r.input instanceof File||r.input instanceof Object){var o=a.parse(r.input,r.config);o&&t.postMessage({workerId:a.WORKER_ID,results:o,finished:!0})}}),(u.prototype=Object.create(c.prototype)).constructor=u,(l.prototype=Object.create(c.prototype)).constructor=l,(d.prototype=Object.create(d.prototype)).constructor=d,(h.prototype=Object.create(c.prototype)).constructor=h,a}()}));const Qe=e=>{try{return Ye.parse(e.replace(/^\ufeff/,""),{header:!0}).data}catch(e){return console.log(e),{}}},Ve=(e,t="EMPTY")=>e.sort((e,r)=>{let o=e,s=r;return"EMPTY"!==t&&(o=e[t],s=r[t]),s||(s=""),o||(o=""),s.length>o.length?1:o.length>s.length?-1:0});let Ze=null;const Xe=async e=>{if(!Ze)try{const e=localStorage.getItem("sczh:data");if(!e)return!1;Ze=JSON.parse(e)}catch(e){return console.error(e),!1}if(W(T.version,Ze.version))return Ze=null,localStorage.removeItem("sczh:data"),!1;let t=e;/(\.csv|\.json)/.test(e)||(t=e+".csv");const{hashes:r}=await Fe,o=r[t],s=Ze.hashes[t];return s&&s===o?Ze[e]:(Ze.hashes[t]=o,!1)},et=(e,t)=>{Ze&&Ze.hashes||(Ze={hashes:T.hashes,version:T.version});let r=e;/(\.csv|\.json)/.test(e)||(r=e+".csv");const o=T.hashes[r];o&&(Ze.hashes[r]=o),Ze[e]=t;const s=JSON.stringify(Ze);try{localStorage.setItem("sczh:data",s)}catch(e){console.error(e)}},tt=new Map,rt=async(e,t)=>{const r=t||e;if(tt.has(e))return tt.get(e);let o=await Xe(e);o||(o=await De(`/data/${r}.csv`),et(e,o));const s=Qe(o);return tt.set(e,s),s},ot=e=>{const t=new Map;let r=!1;const{name:o,path:s}=e,n=e.keys||{},a=n.text||"text",i=n.trans||"trans";return async()=>{if(!r){const n=await rt(o,s);e.sort&&Ve(n,e.sort),n.forEach(e=>{const r=$(e[a]),o=U($(e[i],!0));r&&o&&t.set(r,o)}),r=!0}return t}},st=(e,t=[])=>{let r=e.replace(/\./g,"\\.").replace(/\$num/g,"([+-＋－]?[0-9０-９]{1,10}\\.?[0-9０-９]{0,4}?)").replace(/\$percent/g,"([+-＋－]?[0-9０-９]{1,10}\\.?[0-9０-９]{0,4}?[%％])").replace(/\$unknown/g,"([\\s\\S]+)").replace(/\$uk/g,"([\\s\\S]+)").replace(/\$sep/g,"[\\s\\S]?");return t.forEach(e=>{r=r.replace(e.re,e.exp),e.re.lastIndex=0}),new RegExp(r,"gi")},nt=(ot({name:"name",keys:{text:"name"}}),ot({name:"etc/idol-name",keys:{text:"name"}}));let at=null;const it=async(e=!0)=>{if(at)return at;const t=await nt();at=new Map;for(let[r,o]of t){const t=r.split(" "),s=o.split(" ");e&&at.set(t[1],s[1]),at.set(t.join(""),s.join(" ")),at.set(r,s[1])}return at},ct=(t,r)=>{let o=null;const s=((e,...t)=>{let r=null,o=null;return async()=>(o||(o=e(...t)),r||(r=await o),r)})((e=>{let t=!1,r=new Map,o=[],s=new Map;return async()=>{if(!t){const n=await rt(e),a=await it(),i=new Map,c=new Map,u=new Map,l=new Map([["name",[...a.keys()]]]),d=[];Ve(n,"text").forEach(e=>{if(null==e?void 0:e.text){const t=$(e.text),r=U($(e.trans,!0)),o=L(e.type);t&&r&&(void 0===o||"text"===o?c.set(t,r):o&&"exp"!==o?(l.has(o)||l.set(o,[]),l.get(o).push((e=>e.replace(/\?/g,"\\?").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)"))(t)),i.set(t,r)):u.set(t.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),r))}});for(let[e,t]of l)d.push({re:new RegExp("\\$"+e,"g"),exp:`(${t.join("|")})`});for(let[e,t]of u){const r=st(e,d);s.set(r,t)}r=new Map([...c,...i,...a]),o=[i,a],t=!0}return{expMap:s,wordMaps:o,textMap:r}}})(t)),n=e=>async t=>(o||(o=await s(),r&&await r()),e&&e(t),o),a=e=>e.map(e=>{const t=e[1];return Array.isArray(t)?e[1]=t.map(e=>n(e)):e[1]=n(t),e}),i=(e,t)=>{if(!t){let t=[];return e.forEach((r,o)=>{let s=r.match(/([＋+]+)$/);(null==s?void 0:s[1])?(t.push(s[1]),e[o]=r.replace(/[＋+]+$/,"")):t.push("")}),t}e.forEach((r,o)=>{e[o]=r+t[o]})};return{api:{get(e){Ge.get(a(e))},post(e){Ge.post(a(e))},put(e){Ge.put(a(e))},patch(e){Ge.patch(a(e))}},transItem:(t,r,s=o)=>{if(null==t?void 0:t[r]){let o=t[r].split("/");o.forEach((e,t)=>{let r=i(o);G(o,t,s),i(o,r)});let n=o.join("/");n!==t[r]&&(t[r]=e(n,!0))}},getTransItem:e=>(t,r)=>{e(t,r,o)},ensureData:n()}},{api:ut,transItem:lt}=ct("skill"),dt=e=>{var t,r;e&&(null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{lt(e,"effectName"),lt(e,"effectDescription")}),null===(r=e.rivalMemoryAppealEffects)||void 0===r||r.forEach(e=>{lt(e,"effectName"),lt(e,"effectDescription")}))},ht=(e,t=!1)=>{e&&(lt(e,"comment"),lt(e,"name"),t&&dt(e),e.linkSkill&&(lt(e.linkSkill,"comment"),lt(e.linkSkill,"name"),t&&dt(e.linkSkill)))},pt=e=>{e&&e.forEach(e=>{lt(e,"releaseConditions"),lt(e.passiveSkills,"comment"),lt(e.passiveSkills,"name"),ht(e.skill),ht(e.concertActiveSkill),e.activeSkills&&e.activeSkills.forEach(e=>{ht(e)})})},ft=e=>{e.forEach(e=>{ht(e)})},mt=(e,t=!1)=>{var r,o,s;let n=e.userProduceIdol;n&&(null===(r=n.activeSkills)||void 0===r||r.forEach(e=>{ht(e)}),null===(o=n.passiveSkills)||void 0===o||o.forEach(e=>{ht(e)}),null===(s=n.limitBreaks)||void 0===s||s.forEach(e=>{ht(e)}),t&&pt(n.skillPanels))},gt=e=>{e.forEach(e=>{ht(e.skill,!0)})},vt=e=>{e&&e.forEach(e=>{var t,r,o;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{dt(e)})}),null===(r=e.userRaidDeck)||void 0===r||r.userRaidDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{ht(e,!0)})}),null===(o=e.rival)||void 0===o||o.rivalSkills.forEach(e=>{dt(e)})})},yt=e=>{pt(e.idol.skillPanels),ft(e.idol.memoryAppeals),(e=>{e.forEach(e=>{ht(e)})})(e.idol.abilities)},wt=e=>{var t,r,o;pt(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(r=t.supportIdolActiveSkill)||void 0===r||null===(o=r.activeSkills)||void 0===o||o.forEach(e=>{lt(e,"comment"),lt(e,"name")})},Et=e=>{const t=e.userFesIdol;t.activeSkills.forEach(e=>{ht(e)}),ht(t.memoryAppeal),t.passiveSkills.forEach(e=>{lt(e,"comment"),lt(e,"name")})},kt=Et,St=e=>{var t,r,o,s;e.userProduceSupportIdols.forEach(e=>{pt(e.skillPanels)}),mt(e,!0),null===(t=e.userProduceLimitedSkills)||void 0===t||t.forEach(e=>{ht(e.passiveSkills),ht(e.skill)}),pt(null===(r=e.userProduceIdol)||void 0===r||null===(o=r.userIdol)||void 0===o||null===(s=o.idol)||void 0===s?void 0:s.skillPanels)},It=e=>{var t;e.userFesIdol&&(e.userFesIdol.activeSkills.forEach(e=>{ht(e,!0)}),ht(e.userFesIdol.memoryAppeal,!0),null===(t=e.userFesIdol.passiveSkills)||void 0===t||t.forEach(e=>{lt(e,"comment"),lt(e,"name"),dt(e)}))},bt=e=>{var t,r,o;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(It),null===(r=e.userRaidDeck)||void 0===r||r.userRaidDeckMembers.forEach(It),null===(o=e.userFesEventDeck)||void 0===o||o.userFesEventDeckMembers.forEach(It),gt(e.judges),vt(e.userFesRivals),vt(e.userFesRaidRivals),dt(e.feverActiveSkill)},_t=e=>{var t;null===(t=e.fanActiveSkills)||void 0===t||t.forEach(e=>{ht(e,!0)}),e.userProduceSupportIdols.forEach(e=>{ht(e.activeSkill,!0)});let r=e.userProduceIdol;r.activeSkills.forEach(e=>{ht(e,!0)}),ht(r.memoryAppeal,!0),r.passiveSkills.forEach(e=>{ht(e,!0)});let o=e.produceAudition||e.produceConcert;gt(o.judges),(e=>{e.forEach(e=>{dt(e.rivalMemoryAppeal),e.rivalSkills.forEach(e=>{dt(e)})})})(o.rivals),dt(e.feverActiveSkill)},Ct=e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?_t(t):(t.userFesDeck||t.userRaidDeck)&&bt(t),e.gameData=JSON.stringify(t)}catch(e){log(e)}},Tt=e=>{e.userProduceIdol.activeSkills.forEach(e=>{ht(e)})},At=e=>{var t,r,o;null===(t=e.userProduceReporterEvent)||void 0===t||null===(r=t.produceReporterEventResult)||void 0===r||null===(o=r.produceReporterEventSkills)||void 0===o||o.forEach(e=>{lt(e,"name")})};ut.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[wt]],["userProduce(Teaching)?SupportIdols/{num}",[e=>{var t,r,o,s;pt(e.skillPanels),null===(t=e.userSupportIdol)||void 0===t||null===(r=t.supportIdol)||void 0===r||null===(o=r.supportIdolActiveSkill)||void 0===o||null===(s=o.activeSkills)||void 0===s||s.forEach(e=>{lt(e,"comment"),lt(e,"name")})}]],["userReserveSupportIdols/userSupportIdol/{num}",[e=>{var t,r,o;pt(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(r=t.supportIdolActiveSkill)||void 0===r||null===(o=r.activeSkills)||void 0===o||o.forEach(e=>{lt(e,"comment"),lt(e,"name")})}]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[yt]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],e=>{e.activeSkills.forEach(e=>{ht(e)}),ft(e.userIdol.idol.memoryAppeals)}],["userReserveIdols/userIdol/{num}",e=>{pt(e.idol.skillPanels),ft(e.idol.memoryAppeals)}],["userFesIdols/{num}",Et],[["userProduces/skillPanels","userProduceTeachings/skillPanels"],St],["userDecks/skillPanels",e=>{var t,r,o;e.userSupportIdols.forEach(e=>{pt(e.skillPanels)}),pt(null===(t=e.userIdol)||void 0===t?void 0:t.skillPanels),pt(null===(r=e.userIdol)||void 0===r||null===(o=r.idol)||void 0===o?void 0:o.skillPanels)}],["fes(Match)?Concert/actions/resume",[Ct]],["earthUsers/{uuid}/userFesIdols/{num}",kt],["userRaidDecks",e=>{e.userRaidDecks.forEach(e=>{e.userRaidDeckMembers.forEach(e=>{var t;null===(t=e.userFesIdol)||void 0===t||t.activeSkills.forEach(e=>{ht(e)})})})}],["userProduceAbilities",Tt],["userProduces",[At]]]),ut.post([["userIdols/{num}/produceExSkills/{num}/actions/set",yt],[["userProduce(Teaching)?s/skillPanels/{num}","userProduces/limitedSkills/{num}"],St],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[wt]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[e=>{e.gameData||mt(e)},Ct]],[["produces/actions/resume","produces/actions/next"],[At]],["fes(Match|Raid)?Concert/actions/start",[bt]],["fes(Match)?Concert/actions/resume",[Ct]],["fesRaidConcert/actions/resume",[e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.userRaidDeck&&bt(t),e.gameState.game_data=JSON.stringify(t)}catch(e){log(e)}}]],["fesTowerConcert/actions/start",[bt]],["fesTowerConcert/actions/resume",[e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.userFesEventDeck&&bt(t),e.gameState.game_data=JSON.stringify(t)}catch(e){log(e)}}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[_t]],[["produces/actions/next","produces/actions/resume"],e=>{e.userProduceIdol&&ft(e.userProduceIdol.userIdol.idol.memoryAppeals)}],["userProduceAbilities",Tt]]),ut.patch([["userFesDecks",e=>{e.userFesDecks.forEach(e=>{e.userFesDeckMembers.forEach(It)})}],["userSupportIdols/{num}",e=>{wt(e.userSupportIdol)}]]);const{api:Rt,transItem:xt}=ct("etc/ex-skill"),Pt=e=>{xt(e,"name"),xt(e,"description")},Mt=e=>{e.userIdolProduceExSkills.forEach(e=>{Pt(e.produceExSkill)})},Ft=e=>{var t;null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Pt(e.produceExSkill)})},Dt=e=>{const t=e.userFesIdol;t.userFesIdolProduceExSkills.forEach(e=>{Pt(e.produceExSkill)}),t.userFesSupportIdols.forEach(e=>{e.userFesSupportIdolProduceExSkills.forEach(e=>{Pt(e.produceExSkill)})})},Ot=Dt;Rt.get([[["userIdols/produceExSkillTop","userSupportIdols/produceExSkillTop","userIdols/{num}/produceExSkillTop","userSupportIdols/{num}/produceExSkillTop"],e=>{var t,r,o,s,n,a;null===(t=e.userIdols)||void 0===t||t.forEach(e=>{var t;null===(t=e.userIdolProduceExSkills)||void 0===t||t.forEach(e=>{Pt(e.produceExSkill)})}),null===(r=e.userSupportIdols)||void 0===r||r.forEach(e=>{var t;null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Pt(e.produceExSkill)})}),null===(o=e.userIdol)||void 0===o||null===(s=o.userIdolProduceExSkills)||void 0===s||s.forEach(e=>{Pt(e.produceExSkill)}),null===(n=e.userSupportIdol)||void 0===n||null===(a=n.userSupportIdolProduceExSkills)||void 0===a||a.forEach(e=>{Pt(e.produceExSkill)}),e.userProduceExSkills.forEach(e=>{var t;Pt(e.produceExSkill),Pt(null===(t=e.produceExSkillUpgrade)||void 0===t?void 0:t.produceExSkill)})}],[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[Ft]],["userProduce(Teaching)?SupportIdols/{num}",[e=>{var t;null===(t=e.userProduceSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Pt(e.produceExSkill)})}]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[Mt]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],e=>{e.userProduceIdolProduceExSkills.forEach(e=>{Pt(e.produceExSkill)})}],["userFesIdols/{num}",Dt],["earthUsers/{uuid}/userFesIdols/{num}",Ot],["userProducerSkills/summaries",e=>{e.forEach(e=>{Pt(e)})}]]),Rt.post([["userIdols/{num}/produceExSkills/{num}/actions/set",Mt],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Ft]],["produces/actions/result",[e=>{e.produceExSkillRewards.forEach(e=>{Pt(e.produceExSkill)})}]],["business/actions/finish",e=>{e.slots.forEach(e=>{e.businessProduceExSkillRewards.forEach(e=>{Pt(e.produceExSkill)})})}],["userProduceExSkills/actions/upgrade",e=>{Pt(e.produceExSkill)}]]);const{api:jt,transItem:Bt}=ct("support-skill"),Nt=e=>{null==e||e.forEach(e=>{Bt(e,"description"),Bt(e,"name")})},Lt=e=>{var t,r;const o=null!==(t=e.userSupportIdol)&&void 0!==t?t:e;Nt(o.acquiredSupportSkills),Nt(o.supportSkills),Nt(null===(r=o.supportIdol)||void 0===r?void 0:r.supportSkills)};jt.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[Lt]],["userProduce(Teaching)?SupportIdols/{num}",[Lt]],["userReserveSupportIdols/userSupportIdol/{num}",[Lt]],["produces/{num}/decks",e=>{var t;null===(t=e.userSupportIdols)||void 0===t||t.forEach(e=>{var t;Nt(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills)})}]]),jt.post([["produces/{num}/actions/ready",[e=>{e.userDecks.forEach(e=>{e.userSupportIdols.forEach(e=>{var t;Nt(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills)})})}]],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Lt]],["produces/actions/(resume|next)",[Lt]],[["produceTeachings/resume","produceTeachings/next"],Lt]]),jt.patch([["userSupportIdols/{num}",Lt],["produces/{num}/produceItem/consume",e=>{Nt(e.supportSkills)}]]);const{api:$t,transItem:Ut}=ct("etc/idea-note"),Ht=e=>{var t;e&&(Ut(e,"title"),(e=>{Ut(e,"title"),Ut(e,"comment")})(e.produceIdeaNoteCompleteBonus),null===(t=e.produceIdeaNoteExtraBonuses)||void 0===t||t.forEach(e=>{Ut(e,"comment"),Ut(e,"condition")}))},zt=e=>{var t,r;null===(t=e.ideaNoteResult)||void 0===t||null===(r=t.seasonClearBonusIdeaNotes)||void 0===r||r.forEach(e=>{Ht(e)})};$t.get([["userProduceIdeaNotes",e=>{e.forEach(e=>{Ht(e.produceIdeaNote)})}]]),$t.post([["produces/actions/(resume|next)",[e=>{var t;null===(t=e.userProduceIdeaNotes)||void 0===t||t.forEach(e=>{Ht(e.produceIdeaNote)})},zt]],["produces/actions/act",[e=>{var t,r,o;null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{var t;null===(t=e.produceIdeaNotes)||void 0===t||t.forEach(e=>{Ht(e)})});let s=null===(r=e.lessonResult)||void 0===r||null===(o=r.userProduceIdeaNote)||void 0===o?void 0:o.produceIdeaNote;Ht(s)}]],["produces/actions/endWeek",zt]]),$t.patch([["userProduceIdeaNotes/228681479/actions/select",e=>{Ht(e.userProduceIdeaNote.produceIdeaNote)}]]);const{api:Jt,transItem:qt}=ct("etc/grad-skill"),Wt=e=>{var t;e&&(qt(e,"comment"),qt(e,"name"),qt(e,"acquireComment"),qt(e,"releaseComment"),null===(t=e.produceAbilityAcquireConditionComments)||void 0===t||t.forEach(e=>{qt(e,"name")}))},Kt=e=>{e.userFesIdol.abilities.forEach(e=>{Wt(e)})},Gt=Kt,Yt=e=>{var t,r;const o=e=>{e.userFesIdol.abilities.forEach(e=>{Wt(e)}),e.userFesIdol.concertAbilities.forEach(e=>{Wt(e)})};null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(o),null===(r=e.userRaidDeck)||void 0===r||r.userRaidDeckMembers.forEach(o)},Qt=e=>{var t,r;const o=e.userProduceIdol;o&&(null===(t=o.abilities)||void 0===t||t.forEach(e=>{Wt(e)}),null===(r=o.concertAbilities)||void 0===r||r.forEach(e=>{Wt(e)}))},Vt=e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?Qt(t):(t.userFesDeck||t.userRaidDeck)&&Yt(t),e.gameData=JSON.stringify(t)}catch(e){log(e)}},Zt=e=>{e.userProduceIdol.abilities.forEach(e=>{Wt(e)}),e.userProduceAbilities.forEach(e=>{Wt(e.ability)})};Jt.get([["userFesIdols/{num}",Kt],["fes(Match)?Concert/actions/resume",[Vt]],["earthUsers/{uuid}/userFesIdols/{num}",Gt],["userProduceAbilities",Zt],[["userProduceAreas"],e=>{var t;null===(t=e.abilities)||void 0===t||t.forEach(e=>{Wt(e)})}]]),Jt.post([[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[e=>{e.gameData||((e,t=!1)=>{var r;let o=e.userProduceIdol;o&&(null===(r=o.abilities)||void 0===r||r.forEach(e=>{Wt(e)}))})(e)},Vt]],["fes(Match|Raid)?Concert/actions/start",[Yt]],["fes(Match)?Concert/actions/resume",[Vt]],["fesRaidConcert/actions/resume",[e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.userRaidDeck&&Yt(t),e.gameState.game_data=JSON.stringify(t)}catch(e){log(e)}}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[Qt]],["produces/({num}/audition|concert)/actions/(start|finish)",e=>{var t,r;null===(t=e.concertEvent)||void 0===t||null===(r=t.abilities)||void 0===r||r.forEach(e=>{qt(e,"name")})}],["userProduceAbilities",Zt]]);const{api:Xt,transItem:er}=ct("etc/landing-point"),tr=e=>{e&&(er(e,"comment"),er(e,"name"),er(e,"acquireComment"),er(e,"releaseComment"))},rr=e=>{er(e,"title"),e.produceMusicAssignmentClearBonuses.forEach(e=>{er(e,"title")})},or=e=>{var t,r;er(e.concertBgm,"songTitle"),er(e.concertBgm,"newLineSongTitle"),er(e.feverActiveSkill,"comment"),e.produceMusicProficiencyBonuses.forEach(e=>{var t;er(e,"description"),e.ability&&(tr(e.ability),null===(t=e.ability.produceAbilityAcquireConditionComments)||void 0===t||t.forEach(e=>{er(e,"name")}))}),null===(t=e.produceMusicAssignments)||void 0===t||t.forEach(rr),null===(r=e.produceMusicProficiencyJudgeStarBonuses)||void 0===r||r.forEach(e=>{er(e,"description")})},sr=e=>{var t,r,o;or(e.produceMusic),null===(t=e.userProduceMusicAssignments)||void 0===t||t.forEach(e=>{rr(e.produceMusicAssignment)}),null===(r=e.allUserProduceMusicAssignments)||void 0===r||r.forEach(e=>{rr(e.produceMusicAssignment)}),null===(o=e.judgeStarBonuses)||void 0===o||o.forEach(e=>{er(e,"description")})},nr=e=>{var t,r;null===(t=e.userProduceMusicProficiencies)||void 0===t||t.forEach(sr),null===(r=e.activatedProduceMusicAssignmentBonuses)||void 0===r||r.forEach(e=>{var t;null===(t=e.produceMusicAssignmentClearBonuses)||void 0===t||t.forEach(e=>{er(e,"title")})})},ar=e=>{var t;tr(e),null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{er(e,"effectDescription"),er(e,"effectName")})},ir=e=>{var t,r,o,s;null===(t=e.produceMusic)||void 0===t||null===(r=t.judgeStarBonuses)||void 0===r||r.forEach(e=>{er(e,"description")}),null===(o=e.userProduceIdol)||void 0===o||null===(s=o.abilities)||void 0===s||s.forEach(ar),er(e.feverActiveSkill,"comment")},cr=e=>{var t,r;null===(t=e.userFesIdol)||void 0===t||null===(r=t.abilities)||void 0===r||r.forEach(ar)},ur=cr;Xt.get([[["userProduceAreas","produceMusics"],e=>{var t;null===(t=e.produceMusics)||void 0===t||t.forEach(or)}],["userProduces",[nr]],["userFesIdols/{num}",cr],["earthUsers/{uuid}/userFesIdols/{num}",ur]]),Xt.post([[["produces/actions/resume","produces/actions/next"],[nr]],["produces/actions/resume",e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?ir(t):t.userFesDeck||t.userRaidDeck,e.gameData=JSON.stringify(t)}catch(e){log(e)}}],["userProduceMusicProficiencies",e=>{sr(e.userProduceMusicProficiency)}],["produces/concert/actions/start",ir]]),Xt.patch([["userProduceMusicAssignments/{num}",e=>{rr(e.produceMusicAssignment)}]]);const{api:lr,transItem:dr}=ct("etc/festour"),hr=e=>{var t;null===(t=e.suggestFesTowerCompleteBonuses)||void 0===t||t.forEach(e=>{mr(e)})},pr=e=>{var t;null===(t=e.suggestFesTowerAreaClearBonuses)||void 0===t||t.forEach(e=>{dr(e.fesTowerBonus,"desc")})},fr=e=>{let t=e.userFesTowerAreaSkipBonus;t&&dr(t.fesTowerBonus,"desc")},mr=e=>{var t;e&&(null===(t=e.userFesTowerCompleteBonuses)||void 0===t||t.forEach(e=>{vr(e)}))},gr=e=>{var t;e&&(null===(t=e.fesTowerBonusIdolConditions)||void 0===t||t.forEach(e=>{dr(e,"desc")}))},vr=e=>{var t,r;e&&(null===(t=e.fesTowerCompleteBonus)||void 0===t||null===(r=t.fesTowerBonuses)||void 0===r||r.forEach(e=>{dr(e,"desc")}))},yr=e=>{var t;e&&(null===(t=e.evaluationDetails)||void 0===t||t.forEach(e=>{dr(e,"evaluation")}))},wr=e=>{var t;e&&(null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{dr(e,"effectDescription")}))},Er=e=>{var t;null===(t=e.userFesTowerAreaClearBonuses)||void 0===t||t.forEach(e=>{dr(e.fesTowerBonus,"desc")})};lr.get([["userFesTowerResults",yr],["userFesTowerAdvantages",[e=>{var t;e&&(null===(t=e.fesTowerAdvantageFilters)||void 0===t||t.forEach(e=>{dr(e,"title")}))},e=>{var t;e&&(null===(t=e.userFesTowerAdvantages)||void 0===t||t.forEach(e=>{dr(e,"name"),dr(e.fesTowerAdvantageEffect,"desc"),dr(e.nextFesTowerAdvantageEffect,"desc"),wr(wr)}))}]],["userFesTowerItems",e=>{var t;e&&(null===(t=e.userFesTowerItems)||void 0===t||t.forEach(e=>{dr(e,"name"),dr(e.fesTowerItemLevel,"desc"),dr(e.nextFesTowerItemLevel,"desc")}))}],[["fesTowerBonusIdols"],e=>{var t;null===(t=e.fesTowerBonusIdols)||void 0===t||t.forEach(e=>{gr(e)})}]]),lr.post([["userFesTowerResults",yr],["fesTowerEvents/top",[hr,pr,fr,mr,e=>{var t;null===(t=e.userFesTowerAreas)||void 0===t||t.forEach(e=>{Er(e)})}]]]),lr.patch([["userFesTowerAdvantages/action/acquire",e=>{e&&(dr(e,"name"),dr(e.fesTowerAdvantageEffect,"desc"),dr(e.nextFesTowerAdvantageEffect,"desc"))}],["userFesTowerItems/action/acquire",e=>{e&&(dr(e,"name"),dr(e.fesTowerItemLevel,"desc"),dr(e.nextFesTowerItemLevel,"desc"))}],["userFesTowerAreas/action/complete",hr],[["fesTowerEvents/top","userFesTowers/action/skip"],[hr,pr,fr]]]);const{api:kr,transItem:Sr}=ct("etc/knowhowbook"),Ir=e=>{var t;null===(t=e.userKnowHowBookIndividualities)||void 0===t||t.forEach(e=>{br(e.individuality)})},br=e=>{e&&(Sr(e,"name"),Sr(e,"description"))},_r=e=>{e&&(Sr(e,"name"),e.ability&&(Sr(e.ability,"comment"),Sr(e.ability,"name")),e.activeSkill&&Sr(e.activeSkill,"comment"))};kr.get([[["userProduceAreas","userProduces/growths"],e=>{var t;null===(t=e.userProduceGrowths)||void 0===t||t.forEach(e=>{_r(e.produceGrowth)})}],[["userKnowHowBooks"],e=>{var t;null===(t=e.userKnowHowBooks)||void 0===t||t.forEach(e=>{Ir(e)})}]]),kr.post([[["produces/actions/endWeek","produces/actions/resume"],e=>{var t;null===(t=e.availableIndividualities)||void 0===t||t.forEach(e=>{br(e)})}],["produces/actions/result",e=>{var t,r;null===(t=e.userKnowHowBook)||void 0===t||null===(r=t.userKnowHowBookIndividualities)||void 0===r||r.forEach(e=>{br(e.individuality)})}]]);const{api:Cr,getTransItem:Tr,ensureData:Ar}=ct("etc/item-re"),Rr=Tr((t,r,o)=>{if(null==t?void 0:t[r]){let s=t[r].split("\n");s.forEach((e,t)=>{G(s,t,o)});let n=s.join("\n");n!==t[r]&&(t[r]=e(n,!0))}}),xr=Tr(G),Pr=Tr((e,t,r)=>{if(null==e?void 0:e[t]){let o=e[t];if(G(e,t,r),e[t]===o){e[t]=e[t].replace("\n","");let s=e[t];G(e,t,r),s===e[t]&&(e[t]=o)}}}),Mr=["produceItem","recoveryItem","exchangeItem","lotteryTicket","evolutionItem","gashaTicket","scoutTicket","enhancementItem","idolEvolutionPiece"],Fr=e=>{var t;null==e||null===(t=e.shopMerchandises)||void 0===t||t.forEach(e=>{var t;xr(e,"title"),Pr(e,"shopTitle"),Rr(e,"comment"),null===(t=e.shopContents)||void 0===t||t.forEach(e=>{xr(e.content,"name"),Rr(e.content,"comment")})})},Dr=e=>{let t=e;e.userProduceItems&&(t=e.userProduceItems),Array.isArray(t)&&t.forEach(e=>{const t=e[Mr[0]]||e[Mr[1]]||e[Mr[2]]||e[Mr[3]]||e[Mr[4]]||e[Mr[5]]||e[Mr[6]]||e[Mr[7]]||e[Mr[8]];xr(t,"name"),Rr(t,"comment")})},Or=e=>{e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{e.gameEventAccumulatedPresent.rewards.forEach(e=>{xr(e.content,"name")})})},jr=e=>{var t;null==e||null===(t=e.activeProduceItems)||void 0===t||t.forEach(e=>{xr(e.produceItem,"name"),Rr(e.produceItem,"comment")})};Cr.get([[["userShops","userIdolPieceShops"],e=>{e&&(Array.isArray(e.userShops)&&e.userShops.forEach(e=>{Fr(e)}),Array.isArray(e.userEventShops)&&e.userEventShops.forEach(e=>{Fr(e.userShop)}))}],[["userRecoveryItems","userProduceItems","userExchangeItems","userLotteryTickets","userEvolutionItems","userGashaTickets","userScoutTickets","userEnhancementItems","userIdolEvolutionPieces"],Dr],[["userPresents\\?limit={num}","userPresentHistories\\?limit={num}"],e=>{Array.isArray(e)&&e.forEach(e=>{xr(e.content,"name"),xr(e,"note")})}],["userProduces",jr],["missionEvents/{num}/top",Or],["gashaGroups",e=>{var t;null===(t=e.gashaGroups)||void 0===t||t.forEach(e=>{var t;const r=null===(t=e.userGashaTicket)||void 0===t?void 0:t.gashaTicket;xr(r,"name"),Rr(r,"comment")})}],["businessTop",e=>{var t;null===(t=e.userRecoveryItems)||void 0===t||t.forEach(e=>{xr(e.recoveryItem,"name")})}]]),Cr.post([["myPage",e=>{jr(e.userProduce)}],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",Or],["userShops/actions/purchase",e=>{xr(null==e?void 0:e.shopMerchandise,"title"),Rr(null==e?void 0:e.shopMerchandise,"comment")}],["produces/{num}/actions/ready",Dr],["userPresents/{num}/actions/receive",e=>{xr(e.receivedPresent,"Name")}],["userMissions/{num}/actions/receive",e=>{xr(e.userMission.mission.missionReward.content,"name")}],["userLoginBonuses",e=>{e.userLoginBonuses.forEach(e=>{e.loginBonus.sheets.forEach(e=>{e.rewards.forEach(e=>{xr(e.content,"name")})})}),e.userTotalBonuses.forEach(e=>{e.rewards.forEach(e=>{xr(e.content,"name")})})}],["fesTop",e=>{e.lastRankingResult&&Array.isArray(e.lastRankingResult.fesMatchGradeRewards)&&e.lastRankingResult.fesMatchGradeRewards.forEach(e=>{xr(e.content,"name")})}],["userSelectLoginBonuses/{num}",e=>{e.rewards.forEach(e=>{xr(e.content,"name")})}],["gashas/{num}/actions/draw",e=>{var t;null===(t=e.acquiredStampRewards)||void 0===t||t.forEach(e=>{xr(e.content,"name")})}]]),Cr.patch([["produces/{num}/produceItem/consume",e=>{var t;const r=null===(t=e.consumeProduceItem)||void 0===t?void 0:t.produceItem;r&&(xr(r,"name"),Rr(r,"comment"))}]]);ot({name:"etc/noun-fix",keys:{trans:"fixed"},sort:"text"}),ot({name:"etc/caiyun-prefix",keys:{trans:"fixed"},sort:"text"});let Br=new Map,Nr=!1;const Lr=async()=>{if(!Nr){(await rt("comm-story")).forEach(e=>{if(null==e?void 0:e.text){const t=$(e.text),r=$(e.trans,!0);t&&r&&t!==r&&Br.set(t,r)}}),Nr=!0}return Br};let $r=null,Ur=!1;const Hr=ot({name:"type-text"}),zr=async()=>(Ur||($r=await Hr(),Ur=!0),$r);var Jr=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},qr=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},Wr=function(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])},Kr=function(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},Gr=function(e,t){return[e[0]^t[0],e[1]^t[1]]},Yr=function(e){return e=Gr(e,[0,e[0]>>>1]),e=qr(e,[4283543511,3981806797]),e=Gr(e,[0,e[0]>>>1]),e=qr(e,[3301882366,444984403]),e=Gr(e,[0,e[0]>>>1])};let Qr="";const Vr=()=>{let e="0123456789abcdefghijklmnopqrstuvwxyz",t="";for(let r=0;r<33;r++)t+=e[Math.floor(Math.random()*e.length)];Qr=function(e,t){t=t||0;for(var r=(e=e||"").length%16,o=e.length-r,s=[0,t],n=[0,t],a=[0,0],i=[0,0],c=[2277735313,289559509],u=[1291169091,658871167],l=0;l<o;l+=16)a=[255&e.charCodeAt(l+4)|(255&e.charCodeAt(l+5))<<8|(255&e.charCodeAt(l+6))<<16|(255&e.charCodeAt(l+7))<<24,255&e.charCodeAt(l)|(255&e.charCodeAt(l+1))<<8|(255&e.charCodeAt(l+2))<<16|(255&e.charCodeAt(l+3))<<24],i=[255&e.charCodeAt(l+12)|(255&e.charCodeAt(l+13))<<8|(255&e.charCodeAt(l+14))<<16|(255&e.charCodeAt(l+15))<<24,255&e.charCodeAt(l+8)|(255&e.charCodeAt(l+9))<<8|(255&e.charCodeAt(l+10))<<16|(255&e.charCodeAt(l+11))<<24],a=qr(a,c),a=Wr(a,31),a=qr(a,u),s=Gr(s,a),s=Wr(s,27),s=Jr(s,n),s=Jr(qr(s,[0,5]),[0,1390208809]),i=qr(i,u),i=Wr(i,33),i=qr(i,c),n=Gr(n,i),n=Wr(n,31),n=Jr(n,s),n=Jr(qr(n,[0,5]),[0,944331445]);switch(a=[0,0],i=[0,0],r){case 15:i=Gr(i,Kr([0,e.charCodeAt(l+14)],48));case 14:i=Gr(i,Kr([0,e.charCodeAt(l+13)],40));case 13:i=Gr(i,Kr([0,e.charCodeAt(l+12)],32));case 12:i=Gr(i,Kr([0,e.charCodeAt(l+11)],24));case 11:i=Gr(i,Kr([0,e.charCodeAt(l+10)],16));case 10:i=Gr(i,Kr([0,e.charCodeAt(l+9)],8));case 9:i=Gr(i,[0,e.charCodeAt(l+8)]),i=qr(i,u),i=Wr(i,33),i=qr(i,c),n=Gr(n,i);case 8:a=Gr(a,Kr([0,e.charCodeAt(l+7)],56));case 7:a=Gr(a,Kr([0,e.charCodeAt(l+6)],48));case 6:a=Gr(a,Kr([0,e.charCodeAt(l+5)],40));case 5:a=Gr(a,Kr([0,e.charCodeAt(l+4)],32));case 4:a=Gr(a,Kr([0,e.charCodeAt(l+3)],24));case 3:a=Gr(a,Kr([0,e.charCodeAt(l+2)],16));case 2:a=Gr(a,Kr([0,e.charCodeAt(l+1)],8));case 1:a=Gr(a,[0,e.charCodeAt(l)]),a=qr(a,c),a=Wr(a,31),a=qr(a,u),s=Gr(s,a)}return s=Gr(s,[0,e.length]),n=Gr(n,[0,e.length]),s=Jr(s,n),n=Jr(n,s),s=Yr(s),n=Yr(n),s=Jr(s,n),n=Jr(n,s),("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)+("00000000"+(n[0]>>>0).toString(16)).slice(-8)+("00000000"+(n[1]>>>0).toString(16)).slice(-8)}(t,31),localStorage.setItem("sczh:bid",Qr)};try{Qr=localStorage.getItem("sczh:bid")}catch(e){}Qr||Vr();var Zr=Object.prototype.hasOwnProperty,Xr=Array.isArray,eo=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),to=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},o=0;o<e.length;++o)void 0!==e[o]&&(r[o]=e[o]);return r},ro={arrayToObject:to,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],o=0;o<t.length;++o)for(var s=t[o],n=s.obj[s.prop],a=Object.keys(n),i=0;i<a.length;++i){var c=a[i],u=n[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:n,prop:c}),r.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Xr(r)){for(var o=[],s=0;s<r.length;++s)void 0!==r[s]&&o.push(r[s]);t.obj[t.prop]=o}}}(t),e},decode:function(e,t,r){var o=e.replace(/\+/g," ");if("iso-8859-1"===r)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(e){return o}},encode:function(e,t,r){if(0===e.length)return e;var o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===r)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var s="",n=0;n<o.length;++n){var a=o.charCodeAt(n);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?s+=o.charAt(n):a<128?s+=eo[a]:a<2048?s+=eo[192|a>>6]+eo[128|63&a]:a<55296||a>=57344?s+=eo[224|a>>12]+eo[128|a>>6&63]+eo[128|63&a]:(n+=1,a=65536+((1023&a)<<10|1023&o.charCodeAt(n)),s+=eo[240|a>>18]+eo[128|a>>12&63]+eo[128|a>>6&63]+eo[128|63&a])}return s},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,o){if(!r)return t;if("object"!=typeof r){if(Xr(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(o&&(o.plainObjects||o.allowPrototypes)||!Zr.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var s=t;return Xr(t)&&!Xr(r)&&(s=to(t,o)),Xr(t)&&Xr(r)?(r.forEach((function(r,s){if(Zr.call(t,s)){var n=t[s];n&&"object"==typeof n&&r&&"object"==typeof r?t[s]=e(n,r,o):t.push(r)}else t[s]=r})),t):Object.keys(r).reduce((function(t,s){var n=r[s];return Zr.call(t,s)?t[s]=e(t[s],n,o):t[s]=n,t}),s)}},oo=String.prototype.replace,so=/%20/g,no={RFC1738:"RFC1738",RFC3986:"RFC3986"},ao=ro.assign({default:no.RFC3986,formatters:{RFC1738:function(e){return oo.call(e,so,"+")},RFC3986:function(e){return String(e)}}},no),io=(Date.prototype.toISOString,ao.default);ao.formatters[io];const co=async e=>{const t={text:e};try{const e="https://hooks.sla"+"ck.com/services/TN6J76CUB/BNJ2"+"YLNR3/baGxj31D5YxNhL2Q9FcbzaTA";await((e,t)=>{const{method:r="GET",headers:o,data:s}=t;return fetch(e,{body:s,headers:o,method:r,mode:"cors",referrer:"no-referrer"}).then(e=>e.json())})(e,{data:JSON.stringify(t),method:"POST",headers:{accept:"*/*",referer:"https://hooks.slack.com",origin:"https://hooks.slack.com"}});return""}catch(e){return""}},uo=["text","select","comment","title","actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment","characterComment","producerComment","comment1","comment2"],lo=["mainText","resultText","name"],ho=(t,r)=>{const o=[],s=[];return t.forEach((t,n)=>{uo.forEach(a=>{let i=H(t[a]);t[a]&&(r.has(i)?t[a]=e(r.get(i)):(o.push({key:a,index:n}),s.push(i)))})}),{textInfo:o,textList:s}};let po=!1,fo=!1;const mo=async(t,r="default",o)=>{if(!t.length)return;const s=await zr(),n=await Lr();if(o){const{textInfo:e,textList:r}=ho(t,s);if(!e.length||"……"==r||1==po||"…………"==r||"………………\n……………………\n…………………………"==r||e.length>9)return;let o=[];r.forEach((e,t)=>{o.push(q(e))});const n=o.join("\n"),a=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,i=[];["…………","……","………………\n……………………\n…………………………"].forEach(e=>{i.push(q(e))}),a.test(n)||i.includes(o[0])||await co(n),po=!0}else if("FesTower"==r){const{textInfo:r,textList:o}=((t,r)=>{const o=[],s=[];return t.forEach((t,n)=>{lo.forEach(a=>{let i=H(t[a]);t[a]&&(r.has(i)?t[a]=e(r.get(i)):(o.push({key:a,index:n}),s.push(i)))})}),{textInfo:o,textList:s}})(t,n);if(!r.length||"……"==o||1==po||1==fo||"…………"==o||"………………\n……………………\n…………………………"==o||r.length>9)return;let s=[];o.forEach((e,t)=>{s.push("commstory"+q(e))});const a=s.join("\n"),i=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,c=[];["…………","……","………………\n……………………\n…………………………"].forEach(e=>{c.push(q(e))}),i.test(a)||c.includes(s[0])||await co(a),1==po&&(fo=!0),po=!0}else{const{textInfo:e,textList:r}=ho(t,n);if(!e.length||"……"==r||1==po||"…………"==r||"………………\n……………………\n…………………………"==r||e.length>9)return;let o=[];r.forEach((e,t)=>{o.push("commstory"+q(e))});const s=o.join("\n"),a=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,i=[];["…………","……","………………\n……………………\n…………………………"].forEach(e=>{i.push(q(e))}),a.test(s)||i.includes(o[0])||await co(s),po=!0}},{api:go,transItem:vo}=ct("mission",Ar),yo=(e,t)=>{vo(e,t)||("name"===t?xr(e,t):Rr(e,t))};let wo=!1;const Eo=e=>{null==e||e.forEach(e=>{vo(e.mission,"title"),vo(e.mission,"comment"),e.mission.missionReward.content&&(yo(e.mission.missionReward.content,"name"),yo(e.mission.missionReward.content,"comment"))})},ko=e=>{e.forEach(e=>{let t=e.fesRaidAccumulatedReward;vo(t,"title"),vo(t,"comment");let r=t.fesRaidAccumulatedRewardContent;(null==r?void 0:r.content)&&(yo(r.content,"name"),yo(r.content,"comment"))})},So=(e,t=!0)=>{null==e||e.forEach(e=>{let r=e.mission||e;if(vo(r,"title"),vo(r,"comment"),vo(r,"afterAchievedComment"),vo(r,"beforeAchievedComment"),t){let e=r.lectureMissionReward;(null==e?void 0:e.content)&&(yo(e.content,"name"),yo(e.content,"comment"))}})},Io=e=>{var t,r;vo(null===(t=e.userRecommendedMission)||void 0===t?void 0:t.mission,"comment"),vo(null===(r=e.userRecommendedMission)||void 0===r?void 0:r.mission,"title"),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{vo(e.gameEventAccumulatedPresent,"comment"),vo(e.gameEventAccumulatedPresent,"title")})},bo=e=>{var t;null===(t=e.teachingHints)||void 0===t||t.forEach(e=>{var t,r;null===(t=e.userProduceHints)||void 0===t||t.forEach(e=>{vo(e.produceTeachingHint,"title")}),null===(r=e.userProduceTeachingHints)||void 0===r||r.forEach(e=>{vo(e.produceTeachingHint,"title")})})},_o=e=>{So(e.lectureMissions)},Co=e=>{var t;null===(t=e.userIdolRoad)||void 0===t||t.idolRoad.idolRoadRewards.forEach(e=>{yo(e.content,"name"),yo(e.content,"comment")})};go.get([["userMissions",e=>{var t;const r=performance.now();Eo(e.dailyUserMissions),Eo(e.weeklyUserMissions),Eo(e.fesMatchRankingUserMissions),null===(t=e.eventUserMissions)||void 0===t||t.forEach(e=>{Eo(null==e?void 0:e.userMissions)}),Eo(e.normalUserMissions),Eo(e.specialUserMissions);const o=performance.now();z(o-r,"milliseconds")}],["fesRaidEvents/{num}/rewards",e=>{ko(e.fesRaidBestScoreRewards),ko(e.fesRaidLapRewards),ko(e.fesRaidPointRewards)}],[["userProduces","userProduceTeachings"],[bo]],["userBeginnerMissions/top",_o],["idolRoads/top",e=>{var t;So(e.userMissions,!1),null===(t=e.userIdols)||void 0===t||t.forEach(Co)}],["missionEvents/{num}/top",[Io]],["producerDesk/rewards",e=>{e.producerLevelRewards.forEach(e=>{vo(e,"title"),yo(e.content,"name")})}]]),go.post([["myPage",[e=>{Eo(e.reportUserMissions)},e=>{let t=e.beginnerMission;t&&(t.clearedLectureMission&&So([t.clearedLectureMission]),t.progressLectureMission&&So([t.progressLectureMission]))},e=>{var t;(async e=>{if(!e)return;const t=[];for(let r=0;r<e.length;r++){let o=e[r];vo(e,r),o===e[r]&&t.push(o)}if(t.length&&0==wo)try{const e=t.join("\nPmessage");/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e)||await co("Pmessage"+e),wo=!0}catch(e){z(e)}})(null===(t=e.producerDesk)||void 0===t?void 0:t.messages)}]],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",[Io]],[["produceTeachings/resume","produceTeachings/next"],bo],["userLectureMissions/{num}/actions/receive",_o],["fesMatchConcert/actions/finish",[e=>{e&&e.fesMatchRankingMission&&vo(e.fesMatchRankingMission.userMission.mission,"title")}]],["producerDesk/top",e=>{e.progresses.forEach(e=>{vo(e,"comment"),vo(e,"title")})}]]),go.put([["userIdolRoads",e=>{Co(e.userIdol)}]]);const To=new Map;let Ao=!1;const Ro=new Map;let xo=!1;let Po;const Mo=async()=>(Po||(Po=(async()=>{if(!Ao){let e=await Xe("cardname");e||(e=await De("/data/cardname.csv"),et("cardname",e));Qe(e).forEach(e=>{const t=L(e.name),r=L(e.trans);t&&r&&t!==r&&To.set(t,r)}),Ao=!0}return To})()),await Po);let Fo=[];const Do=e=>{if(!e)return;let t=q(e);Fo.includes(t)||Fo.push(t)};(window.unsafeWindow||window).printUnknowCardCostumenames=()=>z(Fo.join("\n"));const Oo=(t,r)=>{if(!t||!r||!t.name)return;let o=H(t.name);r.has(t.name)&&(t.name=e(r.get(t.name))),T.dev&&o===t.name&&Do(o)},jo=async e=>{const t=await Mo();e.idol&&Oo(e.idol,t),e.supportIdol&&Oo(e.supportIdol,t),e.userSupportIdol&&Oo(e.userSupportIdol.supportIdol,t),e.userProduceSupportIdols&&e.userProduceSupportIdols.forEach((function(e){Oo(e.userSupportIdol.supportIdol,t)})),e.userIdol&&Oo(e.userIdol.idol,t),e.userProduceIdol&&Oo(e.userProduceIdol.userIdol.idol,t),e.userProduce&&e.userProduce.userProduceIdol&&Oo(e.userProduce.userProduceIdol.userIdol.idol,t),e.userFesIdol&&Oo(e.userFesIdol.idol,t)},Bo=async t=>{const r=await Mo(),o=await(async()=>{if(!xo){let e=await Xe("costumename");e||(e=await De("/data/costumename.csv"),et("costumename",e));Qe(e).forEach(e=>{const t=$(e.name),r=$(e.trans);t&&r&&t!==r&&Ro.set(t,r)}),xo=!0}return Ro})(),s=new Map([...r,...o]);t.idolCostumes&&t.idolCostumes.forEach((function(t){Oo(t,s),((t,r)=>{if(!t||!r||!t.comment)return;let o=H(t.comment);r.has(t.comment)&&(t.comment=e(r.get(t.comment))),T.dev&&o===t.comment&&Do(o)})(t,s)})),t.userFesDecks&&t.userFesDecks.forEach((function(e){e.userFesDeckMembers.forEach((function(e){e.idolCostumes.forEach((function(e){Oo(e,s)}))}))}))};Ge.get([[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],jo],[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],jo],["userProduce(Teaching)?SupportIdols/{num}",jo],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],jo],["userFesIdols/{num}",jo],["userProduces",jo],["userReserveIdols/userIdol/{num}",jo],["userReserveSupportIdols/userSupportIdol/{num}",jo],["userKnowHowBooks",async e=>{const t=await Mo();e.userKnowHowBooks&&e.userKnowHowBooks.forEach((function(e){e.idol&&Oo(e.idol,t)}))}]]),Ge.post([[["myPage","produces/actions/(resume|next)"],jo]]),Ge.post([["characterAlbums/characters/{num}",[Bo]],["produces/actions/result",async e=>{const t=await Mo();e.userKnowHowBook&&e.userKnowHowBook.idol&&Oo(e.userKnowHowBook.idol,t)}]]),Ge.patch([["userFesDecks",Bo]]),Ge.put([["userHomeDecks",Bo]]);const No=new Map,Lo=new Map,$o=new Map;let Uo=!1;let Ho,zo,Jo,qo;const Wo=async()=>{Jo||(Jo=(async()=>{if(!Uo){(await rt("title")).forEach(e=>{if(null==e?void 0:e.text){const t=$(e.text),r=$(e.trans,!0),o=L(e.type)||"text";t&&r&&t!==r&&("exp"===o?Lo.set(t,r):"text"===o&&No.set(t,r))}});for(let[e,t]of Lo){const r=st(e);$o.set(r,t)}Uo=!0}return{textMap:No,expMap:$o}})(),qo=nt()),Ho&&zo||(Ho=await Jo,zo=await qo,Ho.wordMaps=[zo])};let Ko=[];(window.unsafeWindow||window).printUnknowTitles=()=>z(Ko.join("\n"));const Go=new Map,Yo=(e,t)=>{e&&y(t)&&(Go.has(e)||Go.set(e,t))},Qo=(e={},t)=>{let r=e[t];G(e,t,Ho),r===e[t]&&T.dev&&(e=>{if(!e)return;let t=q(e);Ko.includes(t)||Ko.push(t)})(r)},Vo=e=>{e.forEach(e=>{Qo(e,"name"),e.communications.forEach(e=>{Qo(e,"name"),Qo(e,"title"),Yo(e.id,`${e.name}-${e.title}`)})})};Ge.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],async e=>{await Wo(),e.supportIdol.produceSupportIdolEvents.forEach(e=>{Qo(e,"title"),Yo(e.id,e.title)})}],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],async e=>{await Wo(),e.idol.produceAfterEvents.forEach(e=>{Qo(e,"title"),Yo(e.id,e.title)}),e.idol.produceIdolEvents.forEach(e=>{Qo(e,"title"),Yo(e.id,e.title)})}],[["characterAlbums","album/top"],async e=>{await Wo(),Vo(e.gameEvents),Vo(e.specialEvents)}],[["producerDesk/gameEvents/{num}"],[async e=>{await Wo(),Qo(e.gameEvent,"name")},async e=>{await Wo(),Qo(e.gameEventStory,"description")}]],[["userMissions"],[async e=>{var t;await Wo(),null===(t=e.eventUserMissions)||void 0===t||t.forEach(e=>{Qo(null==e?void 0:e.gameEvent,"name")})}]]]),Ge.post([["characterAlbums/characters/{num}",async e=>{await Wo(),e.albumCommunicationTitles.forEach(e=>{Qo(e,"title")}),e.communications.forEach(e=>{Qo(e,"title"),Yo(e.communicationId,e.title)}),e.voices.forEach(e=>{Qo(e,"title"),Qo(e,"releasedConditionComment")})}],["produceMarathons/{num}/top",async e=>{await Wo(),e.releasedCommunications.forEach(e=>{Qo(e,"name"),Qo(e,"title"),Yo(e.id,`${e.name}-${e.title}`)}),Qo(e.gameEvent,"name")}]]);const Zo=async t=>{const r=await it();if(t.userProduceIdol){const o=t.userProduceIdol.userIdol.idol.character;r.has(o.name)&&(o.name=e(r.get(o.name))),r.has(o.firstName)&&(o.firstName=e(r.get(o.firstName)))}},Xo=async e=>{var t;await Wo(),null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{Qo(e,"title"),Yo(e.id,e.title)})};Ge.post([["myPage",async e=>{var t;await Wo(),Qo(null==e||null===(t=e.userProduce)||void 0===t?void 0:t.produce,"title")}],["produces/actions/(resume|next)",[Xo,Zo]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],Xo],["produces/actions/act",Xo],["produces/({num}/audition|concert)/actions/(start|finish)",Zo]]);const es=async(e,t="comment")=>{if(!e)return;await mo(e,"autoTransText",!0)},ts=async e=>{try{if(e.produceAudition){let t="produceAudition";await mo(e.produceAudition.judges,t,!0)}if(e.produceConcert){let t="produceAudition";await mo(e.produceConcert.judges,t,!0)}e.produceConcertFanSkillComments&&await es(e.produceConcertFanSkillComments,"comment1")}catch(e){z(e)}},rs=async e=>{if(e.judges){let t="fesMatchConcert";await mo(e.judges,t,!0)}},os=async e=>{if(e.topCharacterReaction)try{const t=[...e.topCharacterReaction.moveReactions,...e.topCharacterReaction.skillReleasedReactions,...e.topCharacterReaction.touchExReactions,...e.topCharacterReaction.touchReactions,...e.topCharacterReaction.waitReactions];await es(t)}catch(e){z(e)}},ss=async e=>{let t=[...e.produceStaffComments||[],...e.produceStaffConcertComments||[],...e.produceStaffFailComments||[],...e.produceStaffSeasonComments||[]];await es(t)},ns=async e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.judges?await rs(t):await ts(t),e.gameData=JSON.stringify(t)}catch(e){z(e)}},as=async e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.judges&&await rs(t),e.gameState.game_data=JSON.stringify(t)}catch(e){z(e)}},is=async e=>{if(!e.characterComment)return;let t=[];t=t.concat(e.characterComment),await es(t)},cs=async e=>{if(e)try{let t=[];e.fesTowerPanelRandom.mainText&&t.push(e.fesTowerPanelRandom),e.fesTowerPanelRandom.fesTowerPanelRandomChoices&&e.fesTowerPanelRandom.fesTowerPanelRandomChoices.forEach(e=>{e.name&&t.push(e)}),await mo(t,"FesTower",!1)}catch(e){z(e)}};Ge.get([["userProduces",os],["fes(Match)?Concert/actions/resume",ns]]),Ge.post([["myPage",async e=>{try{let t=[];e.userHomeDeck.userHomeDeckAnimationMember&&(t=[...e.userHomeDeck.userHomeDeckAnimationMember.mypageComments]);let r=e.userHomeDeck.userHomeAnimationDeck.userHomeAnimationDeckMembers;r&&r.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)}),e.mypageConversations.forEach(e=>{e.mypageConversationComments.forEach(e=>{t.push(e)})})}),e.userHomeDeck.userHomeDeckMembers.length&&e.userHomeDeck.userHomeDeckMembers.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)})}),await es(t),await(async(e,t)=>{await Wo(),e.forEach(e=>{Qo(e,t)})})(t,"speakerName")}catch(e){z(e)}}],["fesTop",async e=>{if(e.userFesDeck)try{let t=[],r=e.userFesDeck.userFesDeckMembers;for(let e of r)e.fesTopCharacterReactions.forEach(e=>{t.push(e)});await es(t)}catch(e){z(e)}}],["produces/actions/(resume|next)",[os,ss,ns,is,ts,async e=>{try{var t;await es(null===(t=e.produceReporterEvent)||void 0===t?void 0:t.produceReporterEventAnswers,"comment2")}catch(e){z(e)}}]],["produces/actions/endWeek",ss],["produces/actions/act",async e=>{if(!e.lessonResult)return;let t=e.lessonResult;try{let e=[];t.produceActCutinComment&&(e=e.concat(t.produceActCutinComment)),t.produceRestBoostIdolComment&&(e=e.concat(t.produceRestBoostIdolComment)),t.produceRestBoostSupportIdolComment&&(e=e.concat(t.produceRestBoostSupportIdolComment)),t.produceRestComments&&(e=e.concat(t.produceRestComments)),await es(e)}catch(e){z(e)}}],["fes(Match|Raid)?Concert/actions/start",rs],["fes(Match)?Concert/actions/resume",ns],["fesRaidConcert/actions/resume",as],["fesTowerConcert/actions/start",rs],["fesTowerConcert/actions/resume",as],["produces/actions/result",async e=>{try{let t=e.characterTrustLevelUpComments;await es(t)}catch(e){z(e)}}],["userFesTowerPanels/{num}/random",cs],["userFesTowerPanels/{num}/random/actions/choice",async e=>{if(e)try{let t=[];e.fesTowerPanelRandomEffect.resultText&&t.push(e.fesTowerPanelRandomEffect),await mo(t,"FesTower",!1)}catch(e){z(e)}}],["userFesTowerAreas/{num}",async e=>{var t;e&&(null===(t=e.userFesTowerStages)||void 0===t||t.forEach(e=>{e.userFesTowerPanelHistory&&e.userFesTowerPanelHistory.userFesTowerRandomPanelHistory&&cs(e.userFesTowerPanelHistory.userFesTowerRandomPanelHistory)}))}],["produces/({num}/audition|concert)/actions/(start|finish)",[ts,is]],["userProduceHelperSupportIdols",async e=>{try{let t="helperSupportIdols";await mo([e],t,!0)}catch(e){z(e)}}],["fesTowerEvents/top",async e=>{if(e.userFesTowerEventTopIdols)try{let t=[];e.userFesTowerEventTopIdols.forEach(e=>{t.push(e.fesTowerEventTopCharacterReaction)}),await es(t)}catch(e){z(e)}}]]);const{api:us,transItem:ls}=ct("etc/idol-filter");us.get([["searchPopupContents",e=>{var t,r,o,s;null===(t=e.businesses)||void 0===t||t.forEach(e=>{ls(e,"name")}),null===(r=e.units)||void 0===r||r.forEach(e=>{ls(e,"name")}),null===(o=e.produces)||void 0===o||o.forEach(e=>{ls(e,"title")}),null===(s=e.characters)||void 0===s||s.forEach(e=>{ls(e,"name"),ls(e,"firstName"),ls(e.unit,"name")}),(e=>{["activeSkills","ideas","idolArrivalTypes","knowHowBooks","supportSkillAttributes","supportSkillEffects"].forEach(t=>{var r;null===(r=e[t])||void 0===r||r.forEach(e=>{ls(e,"label")})})})(e)}]]);Ge.get("gashas/{num}/redraws",async e=>{const t=[];e.forEach(e=>{e.comment&&t.push(e.comment)}),await es(t)}),Ge.post([["characterAlbums/characters/{num}",async e=>{const t=[];e.produceIdols.forEach(e=>{e.comment&&t.push(e.comment)}),await es(t)}],["gashas/{num}/actions/draw",async e=>{var t;const r=[];null===(t=e.gashaDraws)||void 0===t||t.forEach(e=>{e.comment&&r.push(e.comment)}),await es(r)}]]);Ge.post("characterAlbums/characters/{num}",async e=>{if(e.voices){const t=[];e.voices.forEach(e=>{e.characterTrustLevelComment&&t.push(e.characterTrustLevelComment)}),await es(t)}});const ds=new Map;let hs=!1;const ps=["nameKana","unit","age","bloodType","birthday","starSign","height","weight","figure","arm","place","hobby","specialty","cv"],fs=async()=>{if(!hs){(await rt("profile-re")).forEach(t=>{if(null==t?void 0:t.id){const r=$(t.id);if(r)if("label"===r){const o=$(t.nameKana).split("|");ds.set(r,new Map(ps.map((t,r)=>[t,e(L(o[r]))])))}else{for(let r in t)t[r]=e($(t[r]));ds.set(r,t)}}}),hs=!0}return ds},ms=async e=>{const t=(await fs()).get(e.id);for(let r in t)"id"!==r&&e[r]&&("unit"===r?e.unit.name=t[r]:e[r]=t[r])},gs=async e=>{e.beginnerMissionUnits&&e.beginnerMissionUnits.forEach(e=>{e.idols.forEach(e=>{ms(e.idol.character)})}),e.units&&e.units.forEach(e=>{e.idols.forEach(e=>{ms(e.character)})})};Ge.post("characterAlbums/characters/{num}",async e=>{await ms(e)}),Ge.get("userIdols/{num}",async e=>{const t=e.idol.character;await ms(t)}),Ge.get("userSupportIdols/{num}",async e=>{const t=e.supportIdol.character;await ms(t)}),Ge.get("userFesIdols/{num}",async e=>{const t=e.userFesIdol.idol.character;await ms(t)}),Ge.get("userBeginnerMissions/top",gs),Ge.get("tutorialIdols",gs);let vs=!1,ys=null;const ws=ot({name:"common"});let Es=new Map,ks=new Map;const Ss=[],Is=e=>{e&&e.fontFamily&&(e.fontFamily===x.HEITI_JA?Reflect.set(e,"fontFamily",x.HEITI_TRANS):e.fontFamily===x.YUAN_JA&&Reflect.set(e,"fontFamily",x.YUAN_TRANS))},bs=(e,t,r)=>{let o=e,s=H(e);return t.has(s)?(o="​"+t.get(s),Is(r)):e.startsWith("​")||(e=>{e&&e.fontFamily&&(e.fontFamily===x.HEITI_TRANS?Reflect.set(e,"fontFamily",x.HEITI_JA):e.fontFamily===x.YUAN_TRANS&&Reflect.set(e,"fontFamily",x.YUAN_JA))})(r),o},_s=(e,t,r=!1)=>{if(!y(e))return e;let o=e;return e.startsWith("​")?Is(t):e.trim()&&(r?(o=bs(e,ks,t),o===e&&(e=>{Ss.push(e),T.dev,setTimeout(()=>Ss.shift(),1e4)})(e)):(e=>{let t=!1;return Ss.forEach(r=>{r.startsWith(e)&&(t=!0)}),t})(e)||e.startsWith("‌")||(o=bs(e,Es,t))),o};async function Cs(){const e=await He("AOBA");try{Es=await(async()=>{if(!vs){ys=await ws();const e=await it();ys=new Map([...e,...ys]),vs=!0}return ys})(),ks=await zr()}catch(e){}const t=e.Text.prototype.typeText;e.Text.prototype.typeText=function(...e){const r=e[0];return e[0]=_s(r,this.style,!0),t.apply(this,e)};const r=e.Text.prototype.updateText;e.Text.prototype.updateText=function(e){if(this.localStyleID!==this._style.styleID&&(this.dirty=!0,this._style.styleID),this.dirty||!e){T.dev,0;const t=_s(this._text,this._style);return Reflect.set(this,"_text",t),r.call(this,e)}}}const Ts=new Map;let As=!1;let Rs=null;let xs=null;const Ps=()=>xs||(xs=(async()=>{if(Rs)return Rs;try{const e=await fetch("https://newbiepr.gitlab.io/shinymaskr.gitlab.io/data/image/comics/4ko.json?t="+Math.floor(Date.now()/36e5)),t=await e.json();Rs=new Map(t)}catch(e){Rs=new Map}return Rs})(),xs);Ge.get([[["comics"],async t=>{await Ps(),t.comics.forEach(t=>{const r=parseInt(t.id);if(Rs.has(r)){const o=Rs.get(r).title;o&&(t.title=e(o))}})}]]);let Ms=null;const Fs=async()=>(Ms||(Ms=(async()=>{if(!As){(await rt("image")).forEach(e=>{if(null==e?void 0:e.name){const t=L(e.name),r=L(e.url),o=L(e.version)||"1";t&&r&&Ts.set(t,{url:r,version:o})}}),As=!0}return Ts})()),await Ms);let Ds="";(()=>{try{Ds=sessionStorage.getItem("sczh:res-name")}catch(e){}})();(window.unsafeWindow||window).queryImageName=e=>{try{sessionStorage.setItem("sczh:res-name",e)}catch(e){}};let Os=!1;async function js(){const e=await He("AOBA");if(Os)return;const t=e.loaders.Resource.prototype._loadElement,r=async function(e){T.dev&&"image"===e&&Ds&&this.url.includes(Ds)&&(J("%c조회한 이미지：","color:#66ccff"),J(this.url,this.name));try{const t=await Fs();if("image"===e){if(t.has(this.name)){const e=t.get(this.name);if(this.url.endsWith("v="+e.version)){const t="image/"+e.url;this.url=`${T.origin}/data/${t}?v=${T.hashes[t]}`,this.crossOrigin=!0}else z("%cimage version not match","color:#fc4175"),z(this.name,this.url)}else"image"===e&&this.originUrl.includes("idols/name")&&(z("%cidol name display!!","color:#fc4175"),z(this.name,this.url));await async function(e){if(/^images\/content\/comics\/(web|limited|special)\/page\/[^_]+_\d+\.jpg/.test(e.name)){const t=parseInt(e.name.match(/page\/[^_]+_(\d+)\.jpg/)[1]);await Ps(),Rs.has(t)&&(e.url="https://newbiepr.gitlab.io/shinymaskr.gitlab.io/data/image/comics/4ko/"+Rs.get(t).name,e.crossOrigin=!0)}}(this)}}catch(e){}return t.call(this,e)},o=new Proxy(e.loaders.Resource,{construct(e,t,o){var s=Reflect.construct(e,t,o);return new Proxy(s,{get:(e,t,o)=>"_loadElement"==t?r:Reflect.get(e,t,o)})},get:(e,t,r)=>Reflect.get(e,t,r)});Object.defineProperty(e.loaders,"Resource",{value:o}),Os=!0}const Bs=e=>{const t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.setAttribute("as","font"),t.setAttribute("type","font/woff2"),t.setAttribute("crossorigin","anonymous"),document.head.appendChild(t)},Ns=(e,t)=>`/data/font/${e}.woff2?v=${t[`font/${e}.woff2`]}`,Ls=async()=>{const e=document.createElement("style"),{hashes:t}=await Fe;e.innerHTML=`\n  @font-face {\n    font-family: "sczh-heiti";\n    src: url("${T.origin}${Ns("heiti",t)}");\n  }\n  @font-face {\n    font-family: "sczh-yuanti";\n    src: url("${T.origin}${Ns("heiti",t)}");\n  }\n  ::-webkit-scrollbar {\n    display: none;\n  }\n  `,"yuanti"===T.font1&&Bs(`${T.origin}${Ns("heiti",t)}`),"heiti"===T.font2&&Bs(`${T.origin}${Ns("heiti",t)}`),document.head.appendChild(e)};window.addEventListener("blur",(function(e){"on"===T.bgm&&e.stopImmediatePropagation()}),!1),document.addEventListener("visibilitychange",(function(e){"on"===T.bgm&&e.stopImmediatePropagation()}));let $s=0;const Us=async()=>{var e;Oe||$s>=300?(async()=>{try{await Promise.all([js(),Ls(),Cs()])}catch(e){z(e)}})():(await(e=100,new Promise(t=>{setTimeout(t,e)})),$s++,$s%10==0&&z(`Waiting: ${$s/10}s`),await Us())};"loading"!=document.readyState?Us():window.unsafeWindow?window.unsafeWindow.addEventListener("DOMContentLoaded",Us):window.addEventListener("DOMContentLoaded",Us)}();
