// ==UserScript==
// @name         샤니마스 한글 패치 임시
// @namespace    https://github.com/newbiepr/shinycolors-trans-kr
// @version      1.6.2
// @description  샤니마스 임시 한글 패치 스크립트
// @icon         https://shinycolors.enza.fun/icon_192x192.png
// @author       Source : biuuu
// @match        https://shinycolors.enza.fun/*
// @run-at       document-start
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @connect      api.interpreter.caiyunai.com
// @connect      translate.google.cn
// @connect      fanyi.baidu.com
// @updateURL    https://newbiepr.gitlab.io/shinymaskr.gitlab.io/ShinyColors.user.js
// ==/UserScript==
!function(){"use strict";let e;"onbeforescriptexecute"in document||(e=new MutationObserver(e=>{for(let t of e)for(let e of t.addedNodes)if("SCRIPT"===e.tagName){let t=new CustomEvent("beforescriptexecute",{detail:e,cancelable:!0});document.dispatchEvent(t)||e.remove()}}),e.observe(document,{childList:!0,subtree:!0}));const t=e=>{e=(e=>{let t=[/(\w)\.(\w)=function\((\w)\)\{var\s(\w)=\[\]/,"Object.freeze({addHeader:"],n=[";window._require=$1;$1.$2=function($3){var $4=[]","({addHeader:"];for(let r=0;r<t.length;r++)e&&(console.log("Match found: "+t[r]),e=e.replace(t[r],n[r]));return e})(e);var t=document.createElement("script");t.type="text/javascript",t.textContent=e,document.getElementsByTagName("body")[0].appendChild(t)},n=function(e){let t=e.detail||e.target;r(t,e)},r=(r,o)=>{/app-[\w\d]{20}\.js/.test(r.src)&&(o.preventDefault(),o.stopPropagation(),e.disconnect(),document.removeEventListener("beforescriptexecute",n),fetch(r.src).then(e=>e.text()).then(e=>t(e)))};document.addEventListener("beforescriptexecute",n);const o=e=>"​"+e,a=e=>e.startsWith("​")?e.slice(1,e.length):e;var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var c="object"==typeof s&&s&&s.Object===Object&&s,u="object"==typeof self&&self&&self.Object===Object&&self,l=c||u||Function("return this")(),d=l.Symbol,p=Object.prototype,f=p.hasOwnProperty,h=p.toString,m=d?d.toStringTag:void 0;var v=function(e){var t=f.call(e,m),n=e[m];try{e[m]=void 0;var r=!0}catch(e){}var o=h.call(e);return r&&(t?e[m]=n:delete e[m]),o},y=Object.prototype.toString;var g=function(e){return y.call(e)},w=d?d.toStringTag:void 0;var b=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":w&&w in Object(e)?v(e):g(e)},E=Array.isArray;var _=function(e){return null!=e&&"object"==typeof e};var k=function(e){return"string"==typeof e||!E(e)&&_(e)&&"[object String]"==b(e)};var S=function(e){return!0===e||!1===e||_(e)&&"[object Boolean]"==b(e)};var I=function(e,t){return function(n){return e(t(n))}},x=I(Object.getPrototypeOf,Object),j=Function.prototype,A=Object.prototype,C=j.toString,M=A.hasOwnProperty,R=C.call(Object);var O=function(e){if(!_(e)||"[object Object]"!=b(e))return!1;var t=x(e);if(null===t)return!0;var n=M.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&C.call(n)==R};const T={origin:"https://newbiepr.gitlab.io/shinymaskr.gitlab.io",hash:"",localHash:"",version:"1.6.2",story:"normal",timeout:30,font1:"yuanti",font2:"heiti",auto:"off",bgm:"off",dev:!1},P=Object.assign({},T),D=["yuanti","heiti","yuanti2"],$={HEITI_JA:"UDKakugo_SmallPr6-B",HEITI_TRANS:"sczh-heiti,UDKakugo_SmallPr6-B",YUAN_JA:"HummingStd-E",YUAN_TRANS:"sczh-yuanti,HummingStd-E"},z=["origin","font1","font2","timeout","story","auto","bgm","dev"],F=z,L=()=>{$.HEITI_TRANS=`${D.includes(T.font2)?"sczh-":""}${T.font2},${$.HEITI_JA}`,$.YUAN_TRANS=`${D.includes(T.font1)?"sczh-":""}${T.font1},${$.YUAN_JA}`},N=()=>{const e={};F.forEach(t=>{T[t]!==P[t]&&(e[t]=T[t])}),L(),localStorage.setItem("sczh:setting",JSON.stringify(e))},B=()=>{let e=location.hash;e=e.slice(1).replace(/\?tdsourcetag=s_pc(tim|qq)_aiomsg/,""),e.split(";").forEach(e=>{let t=e.split("="),n=decodeURIComponent(t[0].trim()),r=t[1]?decodeURIComponent(t[1].trim()):"";n&&F.includes(n)&&(T[n]=r||P[n],N())})},U={story:{normal:"커뮤추출 열기",edit:"커뮤추출 닫기",id:0,callback:()=>{if("normal"===T.story)T.story="edit";else{const e=document.getElementById("btn-close-sczh");e?e.click():T.story="normal"}}},bgm:{on:"백그라운드BGM 끄기",off:"백그라운드BGM 켜기",id:0,callback:()=>{T.bgm="off"!==T.bgm?"off":"on"}},dev:{id:0,titles:["개발자모드 켜기","개발자모드 끄기"],callback:()=>{T.dev=!T.dev}},wiki:{id:0,title:"샤니위키",callback:()=>{window.open("https://shinycolors.info/wiki")}},update:{id:0,title:"업데이트",callback:()=>{window.open(T.origin+"/ShinyColors.user.js")}}},H=e=>{const t=T[e],n=U[e];let r="";if(S(t)){let e=t?1:0;r=n.titles[e]}else r=n.title||n[t];const o=n.id;o&&window.GM_unregisterMenuCommand(o),n.id=window.GM_registerMenuCommand(r,()=>{(0,n.callback)(),N(),W()})},W=()=>{if(!window.GM_registerMenuCommand||!window.GM_unregisterMenuCommand)return;["update","bgm","story","dev","wiki"].forEach(e=>{H(e)})};(()=>{const e=localStorage.getItem("sczh:setting");let t=JSON.parse(e);O(t)||(t={});const{origin:n}=t;/^https?:\/\//.test(n)&&(T.origin=n.trim()),F.forEach(e=>{let n=t[e];k(n)&&(n=n.trim()),(S(n)||n)&&(T[e]=n)}),L()})(),B(),W(),window.addEventListener("hashchange",B);const q=e=>{if(!e)return"";return e.replace(/[\u0020]+$/g,"").replace(/^[\u0020]+/g,"")},J=(e,t=!1)=>{let n=q(e).replace(/(\\r)?\\n/g,"\n").replace(/\\r/g,"\n");return t?n:n.replace(/\n{2,}/g,"\n")},G=e=>q(e).replace(/\r/g,"\n").replace(/\n{2,}/g,"\n"),K=e=>e.replace(/\?/g,"\\?").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)"),Y=(...e)=>{T.dev&&console.info(...e)},Q=e=>k(e)?e.replace(/\r?\n/g,"\\n").replace(/\r/g,"\\n"):e,V=(e="0.0.0",t="0.0.0")=>{let n=!1;const r=e.split(".").map(e=>parseInt(e,10)),o=t.split(".").map(e=>parseInt(e,10));for(let e=0;e<r.length;e++){(r[e]||0)>(o[e]||0)&&(n=!0)}return n},Z=()=>{const e=new Map;return t=>{if(t&&!/^0+$/.test(t)&&"select"!==t){if(e.has(t)){const n=e.get(t);return e.set(t,n+1),`${t}-${n}`}e.set(t,0)}return t}},X=new Map,ee=(e,t,n=[])=>{if(X.has(e))return X.get(e);let r=e;for(let[e,o]of t)r=r.replace(e,(...e)=>{let t=o;for(let r=1;r<e.length-2;r++){let o=e[r],a=!1;n.forEach(e=>{e.has(o)&&(t=t.replace("$"+r,e.get(o)),a=!0)}),a||(t=t.replace("$"+r,e[r]))}return t}),e.lastIndex=0;return X.set(e,r),r},te=(e,t,n)=>{if(!e||!k(e[t]))return;const{expMap:r,wordMaps:a,textMap:s}=n,i=G(e[t]);let c=i;i&&((null==s?void 0:s.has(i))?e[t]=o(s.get(i)):(c=ee(i,r,a),i!==c&&(e[t]=o(c))))},{origin:ne,version:re}=T,oe=async()=>{const e=Math.floor(Date.now()/1e3/60/60/6),t=await fetch(`${ne}/manifest.json?t=${e}`);if(t.ok){const e=await t.json();return e.time=Date.now(),localStorage.setItem("sczh:manifest",JSON.stringify(e)),e}throw new Error(`${t.status} ${t.url}`)},ae=new Promise((e,t)=>{(async()=>{let e;try{let t=localStorage.getItem("sczh:manifest");t&&(e=JSON.parse(t)),Date.now()-e.time>60*T.cacheTime*1e3&&(e=!1)}catch(e){}return e?V(re,e.version)?e=await oe():setTimeout(oe,5e3):e=await oe(),e})().then(t=>{T.newVersion=t.version,T.hashes=t.hashes,e(t)}).catch(t)}),se=async(e,t)=>{if(!t){const{hashes:n}=await ae;t=n[e.replace(/^\/(data\/)?/,"")]}return await(async e=>new Promise((t,n)=>{let r=setTimeout(()=>{n(`불러오기${e}시간초과`)},1e3*T.timeout);fetch(`${ne}${e}`).then(e=>{if(clearTimeout(r),!e.ok)return n(`${e.status} ${e.url}`),"";const t=e.headers.get("content-type");return(null==t?void 0:t.includes("json"))?e.json():e.text()}).then(t).catch(n)}))(`${e}${t?"?v="+t:""}`)};var ie=i((function(e,t){e.exports=function e(){var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},n=!t.document&&!!t.postMessage,r=n&&/blob:/i.test((t.location||{}).protocol),o={},a=0,s={parse:function(n,r){var i=(r=r||{}).dynamicTyping||!1;if(E(i)&&(r.dynamicTypingFunction=i,i={}),r.dynamicTyping=i,r.transform=!!E(r.transform)&&r.transform,r.worker&&s.WORKERS_SUPPORTED){var c=function(){if(!s.WORKERS_SUPPORTED)return!1;var n,r,i=(n=t.URL||t.webkitURL||null,r=e.toString(),s.BLOB_URL||(s.BLOB_URL=n.createObjectURL(new Blob(["(",r,")();"],{type:"text/javascript"})))),c=new t.Worker(i);return c.onmessage=v,c.id=a++,o[c.id]=c}();return c.userStep=r.step,c.userChunk=r.chunk,c.userComplete=r.complete,c.userError=r.error,r.step=E(r.step),r.chunk=E(r.chunk),r.complete=E(r.complete),r.error=E(r.error),delete r.worker,void c.postMessage({input:n,config:r,workerId:c.id})}var f=null;return"string"==typeof n?f=r.download?new u(r):new d(r):!0===n.readable&&E(n.read)&&E(n.on)?f=new p(r):(t.File&&n instanceof File||n instanceof Object)&&(f=new l(r)),f.stream(n)},unparse:function(e,t){var n=!1,r=!0,o=",",a="\r\n",i='"',c=i+i,u=!1,l=null;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||s.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(o=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(a=t.newline),"string"==typeof t.quoteChar&&(i=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");l=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+i)}}();var d=new RegExp(h(i),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return f(null,e,u);if("object"==typeof e[0])return f(l||p(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:p(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),f(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function p(e){if("object"!=typeof e)return[];var t=[];for(var n in e)t.push(n);return t}function f(e,t,n){var s="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var i=Array.isArray(e)&&0<e.length,c=!Array.isArray(t[0]);if(i&&r){for(var u=0;u<e.length;u++)0<u&&(s+=o),s+=m(e[u],u);0<t.length&&(s+=a)}for(var l=0;l<t.length;l++){var d=i?e.length:t[l].length,p=!1,f=i?0===Object.keys(t[l]).length:0===t[l].length;if(n&&!i&&(p="greedy"===n?""===t[l].join("").trim():1===t[l].length&&0===t[l][0].length),"greedy"===n&&i){for(var h=[],v=0;v<d;v++){var y=c?e[v]:v;h.push(t[l][y])}p=""===h.join("").trim()}if(!p){for(var g=0;g<d;g++){0<g&&!f&&(s+=o);var w=i&&c?e[g]:g;s+=m(t[l][w],g)}l<t.length-1&&(!n||0<d&&!f)&&(s+=a)}}return s}function m(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var r=e.toString().replace(d,c);return"boolean"==typeof n&&n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||function(e,t){for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1}(r,s.BAD_DELIMITERS)||-1<r.indexOf(o)||" "===r.charAt(0)||" "===r.charAt(r.length-1)?i+r+i:r}}};if(s.RECORD_SEP=String.fromCharCode(30),s.UNIT_SEP=String.fromCharCode(31),s.BYTE_ORDER_MARK="\ufeff",s.BAD_DELIMITERS=["\r","\n",'"',s.BYTE_ORDER_MARK],s.WORKERS_SUPPORTED=!n&&!!t.Worker,s.NODE_STREAM_INPUT=1,s.LocalChunkSize=10485760,s.RemoteChunkSize=5242880,s.DefaultDelimiter=",",s.Parser=m,s.ParserHandle=f,s.NetworkStreamer=u,s.FileStreamer=l,s.StringStreamer=d,s.ReadableStreamStreamer=p,t.jQuery){var i=t.jQuery;i.fn.parse=function(e){var n=e.config||{},r=[];return this.each((function(e){if("INPUT"!==i(this).prop("tagName").toUpperCase()||"file"!==i(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var o=0;o<this.files.length;o++)r.push({file:this.files[o],inputElem:this,instanceConfig:i.extend({},n)})})),o(),this;function o(){if(0!==r.length){var t,n,o,c=r[0];if(E(e.before)){var u=e.before(c.file,c.inputElem);if("object"==typeof u){if("abort"===u.action)return t=c.file,n=c.inputElem,o=u.reason,void(E(e.error)&&e.error({name:"AbortError"},t,n,o));if("skip"===u.action)return void a();"object"==typeof u.config&&(c.instanceConfig=i.extend(c.instanceConfig,u.config))}else if("skip"===u)return void a()}var l=c.instanceConfig.complete;c.instanceConfig.complete=function(e){E(l)&&l(e,c.file,c.inputElem),a()},s.parse(c.file,c.instanceConfig)}else E(e.complete)&&e.complete()}function a(){r.splice(0,1),o()}}}function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=w(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new f(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,n){if(this.isFirstChunk&&E(this._config.beforeFirstChunk)){var o=this._config.beforeFirstChunk(e);void 0!==o&&(e=o)}this.isFirstChunk=!1,this._halted=!1;var a=this._partialLine+e;this._partialLine="";var i=this._handle.parse(a,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var c=i.meta.cursor;this._finished||(this._partialLine=a.substring(c-this._baseIndex),this._baseIndex=c),i&&i.data&&(this._rowCount+=i.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(r)t.postMessage({results:i,workerId:s.WORKER_ID,finished:u});else if(E(this._config.chunk)&&!n){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);i=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!u||!E(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(e){E(this._config.error)?this._config.error(e):r&&this._config.error&&t.postMessage({workerId:s.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=s.RemoteChunkSize),c.call(this,e),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),n||(t.onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var r in e)t.setRequestHeader(r,e[r])}if(this._config.chunkSize){var o=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+o)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}n&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(new Error(n))}}function l(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=s.LocalChunkSize),c.call(this,e);var r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var o=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,o)}var a=t.readAsText(e,this._config.encoding);r||this._chunkLoaded({target:{result:a}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,n=this._config.chunkSize;return n?(e=t.substring(0,n),t=t.substring(n)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function p(e){c.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=b((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=b((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=b((function(){this._streamCleanUp(),r=!0,this._streamData("")}),this),this._streamCleanUp=b((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function f(e){var t,n,r,o=Math.pow(2,53),a=-o,i=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,c=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,u=this,l=0,d=0,p=!1,f=!1,v=[],y={data:[],errors:[],meta:{}};if(E(e.step)){var g=e.step;e.step=function(t){if(y=t,k())_();else{if(_(),0===y.data.length)return;l+=t.data.length,e.preview&&l>e.preview?n.abort():(y.data=y.data[0],g(y,u))}}}function b(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function _(){if(y&&r&&(I("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+s.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines)for(var t=0;t<y.data.length;t++)b(y.data[t])&&y.data.splice(t--,1);return k()&&function(){if(y)if(Array.isArray(y.data[0])){for(var t=0;k()&&t<y.data.length;t++)y.data[t].forEach(n);y.data.splice(0,1)}else y.data.forEach(n);function n(t){E(e.transformHeader)&&(t=e.transformHeader(t)),v.push(t)}}(),function(){if(!y||!e.header&&!e.dynamicTyping&&!e.transform)return y;function t(t,n){var r,o=e.header?{}:[];for(r=0;r<t.length;r++){var a=r,s=t[r];e.header&&(a=r>=v.length?"__parsed_extra":v[r]),e.transform&&(s=e.transform(s,a)),s=S(a,s),"__parsed_extra"===a?(o[a]=o[a]||[],o[a].push(s)):o[a]=s}return e.header&&(r>v.length?I("FieldMismatch","TooManyFields","Too many fields: expected "+v.length+" fields but parsed "+r,d+n):r<v.length&&I("FieldMismatch","TooFewFields","Too few fields: expected "+v.length+" fields but parsed "+r,d+n)),o}var n=1;return!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(t),n=y.data.length):y.data=t(y.data,0),e.header&&y.meta&&(y.meta.fields=v),d+=n,y}()}function k(){return e.header&&0===v.length}function S(t,n){return r=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[r]&&(e.dynamicTyping[r]=e.dynamicTypingFunction(r)),!0===(e.dynamicTyping[r]||e.dynamicTyping)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&(function(e){if(i.test(e)){var t=parseFloat(e);if(a<t&&t<o)return!0}return!1}(n)?parseFloat(n):c.test(n)?new Date(n):""===n?null:n):n;var r}function I(e,t,n,r){var o={type:e,code:t,message:n};void 0!==r&&(o.row=r),y.errors.push(o)}this.parse=function(o,a,i){var c=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var n=new RegExp(h(t)+"([^]*?)"+h(t),"gm"),r=(e=e.replace(n,"")).split("\r"),o=e.split("\n"),a=1<o.length&&o[0].length<r[0].length;if(1===r.length||a)return"\n";for(var s=0,i=0;i<r.length;i++)"\n"===r[i][0]&&s++;return s>=r.length/2?"\r\n":"\r"}(o,c)),r=!1,e.delimiter)E(e.delimiter)&&(e.delimiter=e.delimiter(o),y.meta.delimiter=e.delimiter);else{var u=function(t,n,r,o,a){var i,c,u,l;a=a||[",","\t","|",";",s.RECORD_SEP,s.UNIT_SEP];for(var d=0;d<a.length;d++){var p=a[d],f=0,h=0,v=0;u=void 0;for(var y=new m({comments:o,delimiter:p,newline:n,preview:10}).parse(t),g=0;g<y.data.length;g++)if(r&&b(y.data[g]))v++;else{var w=y.data[g].length;h+=w,void 0!==u?0<w&&(f+=Math.abs(w-u),u=w):u=w}0<y.data.length&&(h/=y.data.length-v),(void 0===c||f<=c)&&(void 0===l||l<h)&&1.99<h&&(c=f,i=p,l=h)}return{successful:!!(e.delimiter=i),bestDelimiter:i}}(o,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);u.successful?e.delimiter=u.bestDelimiter:(r=!0,e.delimiter=s.DefaultDelimiter),y.meta.delimiter=e.delimiter}var l=w(e);return e.preview&&e.header&&l.preview++,t=o,n=new m(l),y=n.parse(t,a,i),_(),p?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return p},this.pause=function(){p=!0,n.abort(),t=E(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){u.streamer._halted?(p=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return f},this.abort=function(){f=!0,n.abort(),y.meta.aborted=!0,E(e.complete)&&e.complete(y),t=""}}function h(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t,n=(e=e||{}).delimiter,r=e.newline,o=e.comments,a=e.step,i=e.preview,c=e.fastMode,u=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof n||-1<s.BAD_DELIMITERS.indexOf(n))&&(n=","),o===n)throw new Error("Comment character same as delimiter");!0===o?o="#":("string"!=typeof o||-1<s.BAD_DELIMITERS.indexOf(o))&&(o=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var l=0,d=!1;this.parse=function(e,s,p){if("string"!=typeof e)throw new Error("Input must be a string");var f=e.length,m=n.length,v=r.length,y=o.length,g=E(a),w=[],b=[],_=[],k=l=0;if(!e)return z();if(c||!1!==c&&-1===e.indexOf(t)){for(var S=e.split(r),I=0;I<S.length;I++){if(_=S[I],l+=_.length,I!==S.length-1)l+=r.length;else if(p)return z();if(!o||_.substring(0,y)!==o){if(g){if(w=[],T(_.split(n)),F(),d)return z()}else T(_.split(n));if(i&&i<=I)return w=w.slice(0,i),z(!0)}}return z()}for(var x=e.indexOf(n,l),j=e.indexOf(r,l),A=new RegExp(h(u)+h(t),"g"),C=e.indexOf(t,l);;)if(e[l]!==t)if(o&&0===_.length&&e.substring(l,l+y)===o){if(-1===j)return z();l=j+v,j=e.indexOf(r,l),x=e.indexOf(n,l)}else{if(-1!==x&&(x<j||-1===j)){if(!(x<C)){_.push(e.substring(l,x)),l=x+m,x=e.indexOf(n,l);continue}var M=L(x,C,j);if(M&&void 0!==M.nextDelim){x=M.nextDelim,C=M.quoteSearch,_.push(e.substring(l,x)),l=x+m,x=e.indexOf(n,l);continue}}if(-1===j)break;if(_.push(e.substring(l,j)),$(j+v),g&&(F(),d))return z();if(i&&w.length>=i)return z(!0)}else for(C=l,l++;;){if(-1===(C=e.indexOf(t,C+1)))return p||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:w.length,index:l}),D();if(C===f-1)return D(e.substring(l,C).replace(A,t));if(t!==u||e[C+1]!==u){if(t===u||0===C||e[C-1]!==u){-1!==x&&x<C+1&&(x=e.indexOf(n,C+1)),-1!==j&&j<C+1&&(j=e.indexOf(r,C+1));var R=P(-1===j?x:Math.min(x,j));if(e[C+1+R]===n){_.push(e.substring(l,C).replace(A,t)),e[l=C+1+R+m]!==t&&(C=e.indexOf(t,l)),x=e.indexOf(n,l),j=e.indexOf(r,l);break}var O=P(j);if(e.substring(C+1+O,C+1+O+v)===r){if(_.push(e.substring(l,C).replace(A,t)),$(C+1+O+v),x=e.indexOf(n,l),C=e.indexOf(t,l),g&&(F(),d))return z();if(i&&w.length>=i)return z(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:w.length,index:l}),C++}}else C++}return D();function T(e){w.push(e),k=l}function P(t){var n=0;if(-1!==t){var r=e.substring(C+1,t);r&&""===r.trim()&&(n=r.length)}return n}function D(t){return p||(void 0===t&&(t=e.substring(l)),_.push(t),l=f,T(_),g&&F()),z()}function $(t){l=t,T(_),_=[],j=e.indexOf(r,l)}function z(e){return{data:w,errors:b,meta:{delimiter:n,linebreak:r,aborted:d,truncated:!!e,cursor:k+(s||0)}}}function F(){a(z()),w=[],b=[]}function L(r,o,a){var s={nextDelim:void 0,quoteSearch:void 0},i=e.indexOf(t,o+1);if(o<r&&r<i&&(i<a||-1===a)){var c=e.indexOf(n,i);if(-1===c)return s;i<c&&(i=e.indexOf(t,i+1)),s=L(c,i,a)}else s={nextDelim:r,quoteSearch:o};return s}},this.abort=function(){d=!0},this.getCharIndex=function(){return l}}function v(e){var t=e.data,n=o[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var a={abort:function(){r=!0,y(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:g,resume:g};if(E(n.userStep)){for(var s=0;s<t.results.data.length&&(n.userStep({data:t.results.data[s],errors:t.results.errors,meta:t.results.meta},a),!r);s++);delete t.results}else E(n.userChunk)&&(n.userChunk(t.results,a,t.file),delete t.results)}t.finished&&!r&&y(t.workerId,t.results)}function y(e,t){var n=o[e];E(n.userComplete)&&n.userComplete(t),n.terminate(),delete o[e]}function g(){throw new Error("Not implemented.")}function w(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=w(e[n]);return t}function b(e,t){return function(){e.apply(t,arguments)}}function E(e){return"function"==typeof e}return r&&(t.onmessage=function(e){var n=e.data;if(void 0===s.WORKER_ID&&n&&(s.WORKER_ID=n.workerId),"string"==typeof n.input)t.postMessage({workerId:s.WORKER_ID,results:s.parse(n.input,n.config),finished:!0});else if(t.File&&n.input instanceof File||n.input instanceof Object){var r=s.parse(n.input,n.config);r&&t.postMessage({workerId:s.WORKER_ID,results:r,finished:!0})}}),(u.prototype=Object.create(c.prototype)).constructor=u,(l.prototype=Object.create(c.prototype)).constructor=l,(d.prototype=Object.create(d.prototype)).constructor=d,(p.prototype=Object.create(c.prototype)).constructor=p,s}()}));const ce=e=>{try{return ie.parse(e.replace(/^\ufeff/,""),{header:!0}).data}catch(e){return console.log(e),{}}};let ue=null;const le=async e=>{if(!ue)try{const e=localStorage.getItem("sczh:data");if(!e)return!1;ue=JSON.parse(e)}catch(e){return console.error(e),!1}if(V(T.version,ue.version))return ue=null,localStorage.removeItem("sczh:data"),!1;let t=e;/(\.csv|\.json)/.test(e)||(t=e+".csv");const{hashes:n}=await ae,r=n[t],o=ue.hashes[t];return o&&o===r?ue[e]:(ue.hashes[t]=r,!1)},de=(e,t)=>{ue&&ue.hashes||(ue={hashes:T.hashes,version:T.version});let n=e;/(\.csv|\.json)/.test(e)||(n=e+".csv");const r=T.hashes[n];r&&(ue.hashes[n]=r),ue[e]=t;const o=JSON.stringify(ue);try{localStorage.setItem("sczh:data",o)}catch(e){console.error(e)}},pe=(e,t="EMPTY")=>e.sort((e,n)=>{let r=e,o=n;return"EMPTY"!==t&&(r=e[t],o=n[t]),o||(o=""),r||(r=""),o.length>r.length?1:r.length>o.length?-1:0}),fe=(e,t=[])=>{let n=e.replace(/\./g,"\\.").replace(/\$num/g,"([+-＋－]?[0-9０-９①-─]{1,10}\\.?[0-9０-９①-─]{0,4}?)").replace(/\$percent/g,"([+-＋－]?[0-9０-９]{1,10}\\.?[0-9０-９]{0,4}?[%％])").replace(/\$unknown/g,"(.+?)").replace(/\$uk/g,"(.+?)").replace(/\$sep/g,".?");return t.forEach(e=>{n=n.replace(e.re,e.exp),e.re.lastIndex=0}),new RegExp(n,"gi")},he={expMap:new Map,nounMap:new Map,nounArr:[],loaded:!1},me=async()=>{const{expMap:e,nounMap:t,nounArr:n,loaded:r}=he;if(!r){let r=await le("support-skill");r||(r=await se("/data/support-skill.csv"),de("support-skill",r));const o=ce(r),a=new Map;pe(o,"text").forEach(e=>{if(null==e?void 0:e.text){const r=J(e.text),o=J(e.trans,!0),s=q(e.type);r&&o&&("noun"===s?(n.push(K(r)),t.set(r,o)):a.set(r,o))}});const s=[{re:/\$noun/g,exp:`(${n.join("|")})`}];for(let[t,n]of a){const r=fe(t,s);e.set(r,n)}he.loaded=!0}return{expMap:e,wordMaps:[t]}},ve={expMap:new Map,textMap:new Map,nounMap:new Map,nameMap:new Map,otherMap:new Map,nounArr:[],nameArr:[],otherArr:[],loaded:!1};var ye=function(){this.__data__=[],this.size=0};var ge=function(e,t){return e===t||e!=e&&t!=t};var we=function(e,t){for(var n=e.length;n--;)if(ge(e[n][0],t))return n;return-1},be=Array.prototype.splice;var Ee=function(e){var t=this.__data__,n=we(t,e);return!(n<0)&&(n==t.length-1?t.pop():be.call(t,n,1),--this.size,!0)};var _e=function(e){var t=this.__data__,n=we(t,e);return n<0?void 0:t[n][1]};var ke=function(e){return we(this.__data__,e)>-1};var Se=function(e,t){var n=this.__data__,r=we(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ie.prototype.clear=ye,Ie.prototype.delete=Ee,Ie.prototype.get=_e,Ie.prototype.has=ke,Ie.prototype.set=Se;var xe=Ie;var je=function(){this.__data__=new xe,this.size=0};var Ae=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Ce=function(e){return this.__data__.get(e)};var Me=function(e){return this.__data__.has(e)};var Re=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Oe,Te=function(e){if(!Re(e))return!1;var t=b(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Pe=l["__core-js_shared__"],De=(Oe=/[^.]+$/.exec(Pe&&Pe.keys&&Pe.keys.IE_PROTO||""))?"Symbol(src)_1."+Oe:"";var $e=function(e){return!!De&&De in e},ze=Function.prototype.toString;var Fe=function(e){if(null!=e){try{return ze.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Le=/^\[object .+?Constructor\]$/,Ne=Function.prototype,Be=Object.prototype,Ue=Ne.toString,He=Be.hasOwnProperty,We=RegExp("^"+Ue.call(He).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var qe=function(e){return!(!Re(e)||$e(e))&&(Te(e)?We:Le).test(Fe(e))};var Je=function(e,t){return null==e?void 0:e[t]};var Ge=function(e,t){var n=Je(e,t);return qe(n)?n:void 0},Ke=Ge(l,"Map"),Ye=Ge(Object,"create");var Qe=function(){this.__data__=Ye?Ye(null):{},this.size=0};var Ve=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ze=Object.prototype.hasOwnProperty;var Xe=function(e){var t=this.__data__;if(Ye){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Ze.call(t,e)?t[e]:void 0},et=Object.prototype.hasOwnProperty;var tt=function(e){var t=this.__data__;return Ye?void 0!==t[e]:et.call(t,e)};var nt=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ye&&void 0===t?"__lodash_hash_undefined__":t,this};function rt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}rt.prototype.clear=Qe,rt.prototype.delete=Ve,rt.prototype.get=Xe,rt.prototype.has=tt,rt.prototype.set=nt;var ot=rt;var at=function(){this.size=0,this.__data__={hash:new ot,map:new(Ke||xe),string:new ot}};var st=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var it=function(e,t){var n=e.__data__;return st(t)?n["string"==typeof t?"string":"hash"]:n.map};var ct=function(e){var t=it(this,e).delete(e);return this.size-=t?1:0,t};var ut=function(e){return it(this,e).get(e)};var lt=function(e){return it(this,e).has(e)};var dt=function(e,t){var n=it(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function pt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}pt.prototype.clear=at,pt.prototype.delete=ct,pt.prototype.get=ut,pt.prototype.has=lt,pt.prototype.set=dt;var ft=pt;var ht=function(e,t){var n=this.__data__;if(n instanceof xe){var r=n.__data__;if(!Ke||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ft(r)}return n.set(e,t),this.size=n.size,this};function mt(e){var t=this.__data__=new xe(e);this.size=t.size}mt.prototype.clear=je,mt.prototype.delete=Ae,mt.prototype.get=Ce,mt.prototype.has=Me,mt.prototype.set=ht;var vt=mt;var yt=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},gt=function(){try{var e=Ge(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var wt=function(e,t,n){"__proto__"==t&&gt?gt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},bt=Object.prototype.hasOwnProperty;var Et=function(e,t,n){var r=e[t];bt.call(e,t)&&ge(r,n)&&(void 0!==n||t in e)||wt(e,t,n)};var _t=function(e,t,n,r){var o=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var i=t[a],c=r?r(n[i],e[i],i,n,e):void 0;void 0===c&&(c=e[i]),o?wt(n,i,c):Et(n,i,c)}return n};var kt=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var St=function(e){return _(e)&&"[object Arguments]"==b(e)},It=Object.prototype,xt=It.hasOwnProperty,jt=It.propertyIsEnumerable,At=St(function(){return arguments}())?St:function(e){return _(e)&&xt.call(e,"callee")&&!jt.call(e,"callee")};var Ct=function(){return!1},Mt=i((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n?l.Buffer:void 0,a=(o?o.isBuffer:void 0)||Ct;e.exports=a})),Rt=/^(?:0|[1-9]\d*)$/;var Ot=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Rt.test(e))&&e>-1&&e%1==0&&e<t};var Tt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Pt={};Pt["[object Float32Array]"]=Pt["[object Float64Array]"]=Pt["[object Int8Array]"]=Pt["[object Int16Array]"]=Pt["[object Int32Array]"]=Pt["[object Uint8Array]"]=Pt["[object Uint8ClampedArray]"]=Pt["[object Uint16Array]"]=Pt["[object Uint32Array]"]=!0,Pt["[object Arguments]"]=Pt["[object Array]"]=Pt["[object ArrayBuffer]"]=Pt["[object Boolean]"]=Pt["[object DataView]"]=Pt["[object Date]"]=Pt["[object Error]"]=Pt["[object Function]"]=Pt["[object Map]"]=Pt["[object Number]"]=Pt["[object Object]"]=Pt["[object RegExp]"]=Pt["[object Set]"]=Pt["[object String]"]=Pt["[object WeakMap]"]=!1;var Dt=function(e){return _(e)&&Tt(e.length)&&!!Pt[b(e)]};var $t=function(e){return function(t){return e(t)}},zt=i((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n&&c.process,a=function(){try{var e=r&&r.require&&r.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),Ft=zt&&zt.isTypedArray,Lt=Ft?$t(Ft):Dt,Nt=Object.prototype.hasOwnProperty;var Bt=function(e,t){var n=E(e),r=!n&&At(e),o=!n&&!r&&Mt(e),a=!n&&!r&&!o&&Lt(e),s=n||r||o||a,i=s?kt(e.length,String):[],c=i.length;for(var u in e)!t&&!Nt.call(e,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ot(u,c))||i.push(u);return i},Ut=Object.prototype;var Ht=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ut)},Wt=I(Object.keys,Object),qt=Object.prototype.hasOwnProperty;var Jt=function(e){if(!Ht(e))return Wt(e);var t=[];for(var n in Object(e))qt.call(e,n)&&"constructor"!=n&&t.push(n);return t};var Gt=function(e){return null!=e&&Tt(e.length)&&!Te(e)};var Kt=function(e){return Gt(e)?Bt(e):Jt(e)};var Yt=function(e,t){return e&&_t(t,Kt(t),e)};var Qt=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Vt=Object.prototype.hasOwnProperty;var Zt=function(e){if(!Re(e))return Qt(e);var t=Ht(e),n=[];for(var r in e)("constructor"!=r||!t&&Vt.call(e,r))&&n.push(r);return n};var Xt=function(e){return Gt(e)?Bt(e,!0):Zt(e)};var en=function(e,t){return e&&_t(t,Xt(t),e)},tn=i((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n?l.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}}));var nn=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};var rn=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,a=[];++n<r;){var s=e[n];t(s,n,e)&&(a[o++]=s)}return a};var on=function(){return[]},an=Object.prototype.propertyIsEnumerable,sn=Object.getOwnPropertySymbols,cn=sn?function(e){return null==e?[]:(e=Object(e),rn(sn(e),(function(t){return an.call(e,t)})))}:on;var un=function(e,t){return _t(e,cn(e),t)};var ln=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e},dn=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ln(t,cn(e)),e=x(e);return t}:on;var pn=function(e,t){return _t(e,dn(e),t)};var fn=function(e,t,n){var r=t(e);return E(e)?r:ln(r,n(e))};var hn=function(e){return fn(e,Kt,cn)};var mn=function(e){return fn(e,Xt,dn)},vn=Ge(l,"DataView"),yn=Ge(l,"Promise"),gn=Ge(l,"Set"),wn=Ge(l,"WeakMap"),bn=Fe(vn),En=Fe(Ke),_n=Fe(yn),kn=Fe(gn),Sn=Fe(wn),In=b;(vn&&"[object DataView]"!=In(new vn(new ArrayBuffer(1)))||Ke&&"[object Map]"!=In(new Ke)||yn&&"[object Promise]"!=In(yn.resolve())||gn&&"[object Set]"!=In(new gn)||wn&&"[object WeakMap]"!=In(new wn))&&(In=function(e){var t=b(e),n="[object Object]"==t?e.constructor:void 0,r=n?Fe(n):"";if(r)switch(r){case bn:return"[object DataView]";case En:return"[object Map]";case _n:return"[object Promise]";case kn:return"[object Set]";case Sn:return"[object WeakMap]"}return t});var xn=In,jn=Object.prototype.hasOwnProperty;var An=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&jn.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Cn=l.Uint8Array;var Mn=function(e){var t=new e.constructor(e.byteLength);return new Cn(t).set(new Cn(e)),t};var Rn=function(e,t){var n=t?Mn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},On=/\w*$/;var Tn=function(e){var t=new e.constructor(e.source,On.exec(e));return t.lastIndex=e.lastIndex,t},Pn=d?d.prototype:void 0,Dn=Pn?Pn.valueOf:void 0;var $n=function(e){return Dn?Object(Dn.call(e)):{}};var zn=function(e,t){var n=t?Mn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var Fn=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Mn(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return Rn(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return zn(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return Tn(e);case"[object Set]":return new r;case"[object Symbol]":return $n(e)}},Ln=Object.create,Nn=function(){function e(){}return function(t){if(!Re(t))return{};if(Ln)return Ln(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var Bn=function(e){return"function"!=typeof e.constructor||Ht(e)?{}:Nn(x(e))};var Un=function(e){return _(e)&&"[object Map]"==xn(e)},Hn=zt&&zt.isMap,Wn=Hn?$t(Hn):Un;var qn=function(e){return _(e)&&"[object Set]"==xn(e)},Jn=zt&&zt.isSet,Gn=Jn?$t(Jn):qn,Kn={};Kn["[object Arguments]"]=Kn["[object Array]"]=Kn["[object ArrayBuffer]"]=Kn["[object DataView]"]=Kn["[object Boolean]"]=Kn["[object Date]"]=Kn["[object Float32Array]"]=Kn["[object Float64Array]"]=Kn["[object Int8Array]"]=Kn["[object Int16Array]"]=Kn["[object Int32Array]"]=Kn["[object Map]"]=Kn["[object Number]"]=Kn["[object Object]"]=Kn["[object RegExp]"]=Kn["[object Set]"]=Kn["[object String]"]=Kn["[object Symbol]"]=Kn["[object Uint8Array]"]=Kn["[object Uint8ClampedArray]"]=Kn["[object Uint16Array]"]=Kn["[object Uint32Array]"]=!0,Kn["[object Error]"]=Kn["[object Function]"]=Kn["[object WeakMap]"]=!1;var Yn=function e(t,n,r,o,a,s){var i,c=1&n,u=2&n,l=4&n;if(r&&(i=a?r(t,o,a,s):r(t)),void 0!==i)return i;if(!Re(t))return t;var d=E(t);if(d){if(i=An(t),!c)return nn(t,i)}else{var p=xn(t),f="[object Function]"==p||"[object GeneratorFunction]"==p;if(Mt(t))return tn(t,c);if("[object Object]"==p||"[object Arguments]"==p||f&&!a){if(i=u||f?{}:Bn(t),!c)return u?pn(t,en(i,t)):un(t,Yt(i,t))}else{if(!Kn[p])return a?t:{};i=Fn(t,p,c)}}s||(s=new vt);var h=s.get(t);if(h)return h;s.set(t,i),Gn(t)?t.forEach((function(o){i.add(e(o,n,r,o,t,s))})):Wn(t)&&t.forEach((function(o,a){i.set(a,e(o,n,r,a,t,s))}));var m=d?void 0:(l?u?mn:hn:u?Xt:Kt)(t);return yt(m||t,(function(o,a){m&&(o=t[a=o]),Et(i,a,e(o,n,r,a,t,s))})),i};var Qn=function(e){return Yn(e,5)};let Vn=window.unsafeWindow||window;const Zn=new Map([["AOBA",e=>e&&e.loaders&&e.Text&&e.BLEND_MODES],["SCENARIO",e=>e&&e.default&&e.default.load&&e.default._errorEvent&&e.default._handleError],["REQUEST",e=>e&&e.get&&e.post&&e.put&&e.patch],["PHRASE",e=>e&&e.default&&e.default._polyglot&&e.default._polyglot.phrases],["SPEAKER",e=>e&&e.default&&e.default.getCharacterBackLogIconId]]),Xn=new Map([["AOBA",e=>e],["SCENARIO",e=>e.default],["REQUEST",e=>e],["PHRASE",e=>e.default._polyglot.phrases],["SPEAKER",e=>e.default]]);const er=async e=>{const{moduleId:t}=await ae;let[n,r]=((e,t)=>{let n,r,o=((e,t)=>{let n=e+t,r=[];for(let o=e-t;o<=n;o++)o>=0&&o!==e&&r.push(o);return r.unshift(e),r})(e,20);for(let e=0;e<o.length;e++){let a=Vn._require(o[e]);if(t(a)){n=a,r=o[e];break}}return[n,r]})(t[e],Zn.get(e));return n?Xn.get(e)(n):null},tr=(e,t,n,r)=>{if(T.dev){let o=r;r&&(o=Qn(r)),Y(`%c${e}%c %c${n[0]}`,...(e=>[`background-color:${e};color:#fff;padding:0 0.3em`,"",`color:${e};text-decoration:underline`])(t),n[1]||"","\n=>",o)}},nr=async(e,t,n)=>{try{for(let[r,o]of n){let n=!1;if(("string"===o.type&&o.key===t||"regexp"===o.type&&o.key.test(t))&&(n=!0),n){const t=o.handles;for(let n of t)await n(e)}}}catch(e){Y(e)}},rr=e=>{const t=e.replace(/{num}/g,"\\d+").replace(/{uuid}/g,"[a-f\\d]{8}-([a-f\\d]{4}-){3}[a-f\\d]{12}");return new RegExp(`^${t}$`)},or={get:new Map,post:new Map,patch:new Map,put:new Map},ar=(e,t,n)=>{if(!n.has(e)){const t=e.includes("{")||e.includes("("),r={handles:[],key:t?rr(e):e,type:t?"regexp":"string"};n.set(e,r)}const r=n.get(e);Array.isArray(t)?r.handles=r.handles.concat(t):r.handles.push(t)},sr=(e,t,n)=>{if(Array.isArray(e))for(let r of e)ar(r,t,n);else ar(e,t,n)},ir=e=>(t,n)=>{const r=or[e];if(n)sr(t,n,r);else{const e=t;for(let[t,n]of e)sr(t,n,r)}},cr={get:ir("get"),post:ir("post"),patch:ir("patch"),put:ir("put")};async function ur(){const e=await er("REQUEST"),t=e.get;e.get=async function(...e){const n=e[0],r=await t.apply(this,e);if(!n)return r;let o=r.body;return tr("GET","#009688",e,o),await nr(o,n,or.get),r};const n=e.patch;e.patch=async function(...e){const t=e[0],r=await n.apply(this,e);if(!t)return r;let o=r.body;return tr("PATCH","#8BC34A",e,o),await nr(o,t,or.patch),r};const r=e.post;e.post=async function(...e){const t=e[0],n=await r.apply(this,e);if(!t)return n;let o=n.body;return tr("POST","#3F51B5",e,o),await nr(o,t,or.post),n};const o=e.put;e.put=async function(...e){const t=e[0],n=await o.apply(this,e);if(!t)return n;let r=n.body;return tr("PUT","#9C27B0",e,r),await nr(r,t,or.put),n}}let lr=null,dr=null;const pr=async()=>{lr||(lr=(async()=>{const{expMap:e,nounMap:t,textMap:n,nameMap:r,otherMap:o,nounArr:a,nameArr:s,otherArr:i,loaded:c}=ve;if(!c){let c=await le("skill");c||(c=await se("/data/skill.csv"),de("skill",c));const u=ce(c),l=new Map;pe(u,"text").forEach(e=>{if(null==e?void 0:e.text){const c=J(e.text),u=J(e.trans,!0),d=q(e.type);c&&u&&("noun"===d?(a.push(K(c)),t.set(c,u)):"text"===d?n.set(c,u):"name"===d?(s.push(K(c)),r.set(c,u)):"other"===d?(i.push(K(c)),o.set(c,u)):l.set(c.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),u))}});const d=[{re:/\$noun/g,exp:`(${a.join("|")})`},{re:/\$name/g,exp:`(${s.join("|")})`},{re:/\$other/g,exp:`(${i.join("|")})`}];for(let[t,n]of l){const r=fe(t,d);e.set(r,n)}ve.loaded=!0}return{expMap:e,wordMaps:[t,o,r],textMap:n}})()),dr||(dr=await lr)},fr=(e,t)=>{if(!t){let t=[];return e.forEach((n,r)=>{let o=n.match(/([＋+]+)$/);(null==o?void 0:o[1])?(t.push(o[1]),e[r]=n.replace(/[＋+]+$/,"")):t.push("")}),t}e.forEach((n,r)=>{e[r]=n+t[r]})},hr=(e,t,n=dr)=>{if(null==e?void 0:e[t]){let r=e[t].split("/");r.forEach((e,t)=>{let o=fr(r);te(r,t,n),fr(r,o)});let a=r.join("/");a!==e[t]&&(e[t]=o(a))}},mr=(e,t)=>{null==e||e.forEach(e=>{hr(e,"description",t),hr(e,"name",t)})},vr=async e=>{var t,n;const r=await me(),o=null!==(t=e.userSupportIdol)&&void 0!==t?t:e;mr(o.acquiredSupportSkills,r),mr(o.supportSkills,r),mr(null===(n=o.supportIdol)||void 0===n?void 0:n.supportSkills,r)},yr=e=>{var t,n;null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{hr(e,"effectName"),hr(e,"effectDescription")}),null===(n=e.rivalMemoryAppealEffects)||void 0===n||n.forEach(e=>{hr(e,"effectName"),hr(e,"effectDescription")})},gr=(e,t=!1)=>{e&&(hr(e,"comment"),hr(e,"name"),t&&yr(e),e.linkSkill&&(hr(e.linkSkill,"comment"),hr(e.linkSkill,"name"),t&&yr(e.linkSkill)))},wr=e=>{hr(e,"name"),hr(e,"description")},br=e=>{e&&e.forEach(e=>{hr(e,"releaseConditions"),hr(e.passiveSkills,"comment"),hr(e.passiveSkills,"name"),gr(e.skill),gr(e.concertActiveSkill),e.activeSkills&&e.activeSkills.forEach(e=>{gr(e)})})},Er=e=>{e.forEach(e=>{gr(e)})},_r=(e,t=!1)=>{var n,r,o,a;let s=e.userProduceIdol;s&&(null===(n=s.activeSkills)||void 0===n||n.forEach(e=>{gr(e)}),null===(r=s.abilities)||void 0===r||r.forEach(e=>{gr(e)}),null===(o=s.passiveSkills)||void 0===o||o.forEach(e=>{gr(e)}),null===(a=s.limitBreaks)||void 0===a||a.forEach(e=>{gr(e)}),t&&br(s.skillPanels))},kr=e=>{e.forEach(e=>{gr(e.skill,!0)})},Sr=e=>{e&&e.forEach(e=>{var t,n,r;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{yr(e)})}),null===(n=e.userRaidDeck)||void 0===n||n.userRaidDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{gr(e,!0)})}),null===(r=e.rival)||void 0===r||r.rivalSkills.forEach(e=>{yr(e)})})},Ir=async e=>{await pr(),br(e.idol.skillPanels),Er(e.idol.memoryAppeals),e.userIdolProduceExSkills.forEach(e=>{wr(e.produceExSkill)})},xr=async e=>{var t,n,r,o;await pr(),br(e.supportIdol.skillPanels),null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{wr(e.produceExSkill)}),null===(n=e.supportIdol)||void 0===n||null===(r=n.supportIdolActiveSkill)||void 0===r||null===(o=r.activeSkills)||void 0===o||o.forEach(e=>{hr(e,"comment"),hr(e,"name")})},jr=async e=>{await pr();const t=e.userFesIdol;t.activeSkills.forEach(e=>{gr(e)}),t.abilities.forEach(e=>{gr(e)}),gr(t.memoryAppeal),t.passiveSkills.forEach(e=>{hr(e,"comment"),hr(e,"name")}),t.userFesIdolProduceExSkills.forEach(e=>{wr(e.produceExSkill)}),t.userFesSupportIdols.forEach(e=>{e.userFesSupportIdolProduceExSkills.forEach(e=>{wr(e.produceExSkill)})})},Ar=jr,Cr=async e=>{await pr(),e.userProduceExSkills.forEach(e=>{wr(e.produceExSkill)})},Mr=async e=>{var t,n,r,o;await pr(),e.userProduceSupportIdols.forEach(e=>{br(e.skillPanels)}),_r(e,!0),null===(t=e.userProduceLimitedSkills)||void 0===t||t.forEach(e=>{gr(e.passiveSkills),gr(e.skill)}),br(null===(n=e.userProduceIdol)||void 0===n||null===(r=n.userIdol)||void 0===r||null===(o=r.idol)||void 0===o?void 0:o.skillPanels)},Rr=async e=>{var t,n;await pr();const r=e=>{e.userFesIdol.activeSkills.forEach(e=>{gr(e,!0)}),e.userFesIdol.abilities.forEach(e=>{gr(e)}),e.userFesIdol.concertAbilities.forEach(e=>{gr(e)}),gr(e.userFesIdol.memoryAppeal,!0),e.userFesIdol.passiveSkills.forEach(e=>{hr(e,"comment"),hr(e,"name"),yr(e)})};null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(r),null===(n=e.userRaidDeck)||void 0===n||n.userRaidDeckMembers.forEach(r),kr(e.judges),Sr(e.userFesRivals),Sr(e.userFesRaidRivals)},Or=async e=>{var t,n,r;await pr(),null===(t=e.fanActiveSkills)||void 0===t||t.forEach(e=>{gr(e,!0)}),e.userProduceSupportIdols.forEach(e=>{gr(e.activeSkill,!0)});let o=e.userProduceIdol;o.activeSkills.forEach(e=>{gr(e,!0)}),null===(n=o.abilities)||void 0===n||n.forEach(e=>{gr(e,!0)}),null===(r=o.concertAbilities)||void 0===r||r.forEach(e=>{gr(e,!0)}),gr(o.memoryAppeal,!0),o.passiveSkills.forEach(e=>{gr(e,!0)});let a=e.produceAudition||e.produceConcert;kr(a.judges),(e=>{e.forEach(e=>{yr(e.rivalMemoryAppeal),e.rivalSkills.forEach(e=>{yr(e)})})})(a.rivals)},Tr=async e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?await Or(t):(t.userFesDeck||t.userRaidDeck)&&await Rr(t),e.gameData=JSON.stringify(t)}catch(e){Y(e)}},Pr=async e=>{await pr(),e.userProduceIdol.activeSkills.forEach(e=>{gr(e)}),e.userProduceIdol.abilities.forEach(e=>{gr(e)}),e.userProduceAbilities.forEach(e=>{gr(e.ability),hr(e.ability,"acquireComment"),e.ability.produceAbilityAcquireConditionComments.forEach(e=>{hr(e,"name")})})};cr.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[vr,xr]],["userProduce(Teaching)?SupportIdols/{num}",[vr,async e=>{var t,n,r,o,a;await pr(),br(e.skillPanels),null===(t=e.userProduceSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{wr(e.produceExSkill)}),null===(n=e.userSupportIdol)||void 0===n||null===(r=n.supportIdol)||void 0===r||null===(o=r.supportIdolActiveSkill)||void 0===o||null===(a=o.activeSkills)||void 0===a||a.forEach(e=>{hr(e,"comment"),hr(e,"name")})}]],["userReserveSupportIdols/userSupportIdol/{num}",[vr,async e=>{var t,n,r;await pr(),br(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(n=t.supportIdolActiveSkill)||void 0===n||null===(r=n.activeSkills)||void 0===r||r.forEach(e=>{hr(e,"comment"),hr(e,"name")})}]],["userIdols/{num}/produceExSkillTop",Cr],["userSupportIdols/{num}/produceExSkillTop",Cr],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[Ir]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],async e=>{await pr(),e.activeSkills.forEach(e=>{gr(e)}),Er(e.userIdol.idol.memoryAppeals),e.userProduceIdolProduceExSkills.forEach(e=>{wr(e.produceExSkill)})}],["userReserveIdols/userIdol/{num}",async e=>{await pr(),br(e.idol.skillPanels),Er(e.idol.memoryAppeals)}],["userFesIdols/{num}",jr],["userDecks/skillPanels",async e=>{var t,n,r;await pr(),e.userSupportIdols.forEach(e=>{br(e.skillPanels)}),br(null===(t=e.userIdol)||void 0===t?void 0:t.skillPanels),br(null===(n=e.userIdol)||void 0===n||null===(r=n.idol)||void 0===r?void 0:r.skillPanels)}],[["userProduces/skillPanels","userProduceTeachings/skillPanels"],Mr],["fes(Match)?Concert/actions/resume",[Tr]],["earthUsers/{uuid}/userFesIdols/{num}",Ar],["userRaidDecks",async e=>{await pr(),e.userRaidDecks.forEach(e=>{e.userRaidDeckMembers.forEach(e=>{var t;null===(t=e.userFesIdol)||void 0===t||t.activeSkills.forEach(e=>{gr(e)})})})}],["produces/{num}/decks",async e=>{var t;const n=await me();null===(t=e.userSupportIdols)||void 0===t||t.forEach(e=>{var t;mr(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills,n)})}],["userProduceAbilities",Pr],["userProduceAreas",async e=>{var t;await pr(),null===(t=e.abilities)||void 0===t||t.forEach(e=>{hr(e,"acquireComment"),hr(e,"name"),hr(e,"comment")})}]]),cr.post([["userIdols/{num}/produceExSkills/{num}/actions/set",Ir],["produces/{num}/actions/ready",[async e=>{const t=await me();e.userDecks.forEach(e=>{e.userSupportIdols.forEach(e=>{var n;mr(null===(n=e.supportIdol)||void 0===n?void 0:n.supportSkills,t)})})}]],[["userProduce(Teaching)?s/skillPanels/{num}","userProduces/limitedSkills/{num}"],Mr],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[xr,vr]],["produces/actions/(resume|next)",[async e=>{e.userProduceIdeaNotes&&(await pr(),e.userProduceIdeaNotes.forEach(e=>{let t=e.produceIdeaNote.produceIdeaNoteCompleteBonus;hr(t,"title"),hr(t,"comment"),e.produceIdeaNote.produceIdeaNoteExtraBonuses.forEach(e=>{hr(e,"comment"),hr(e,"condition")})}))},vr]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[async e=>{e.gameData||(await pr(),_r(e))},Tr]],["produces/actions/act",[async e=>{var t,n,r;await pr();let o=null===(t=e.lessonResult)||void 0===t||null===(n=t.userProduceIdeaNote)||void 0===n||null===(r=n.produceIdeaNote)||void 0===r?void 0:r.produceIdeaNoteCompleteBonus;gr(o)}]],["fes(Match|Raid)?Concert/actions/start",[Rr]],["fes(Match)?Concert/actions/resume",[Tr]],["fesRaidConcert/actions/resume",[async e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.userRaidDeck&&await Rr(t),e.gameState.game_data=JSON.stringify(t)}catch(e){Y(e)}}]],["produces/actions/result",[async e=>{await pr(),e.produceExSkillRewards.forEach(e=>{wr(e.produceExSkill)})}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[Or]],["produces/({num}/audition|concert)/actions/(start|finish)",async e=>{var t,n;await pr(),null===(t=e.concertEvent)||void 0===t||null===(n=t.abilities)||void 0===n||n.forEach(e=>{hr(e,"name")})}],[["produceTeachings/resume","produceTeachings/next"],vr],["userProduceAbilities",Pr]]),cr.patch("userSupportIdols/{num}",vr);const Dr=new Map,$r=new Map,zr=new Map;let Fr=!1;const Lr=async()=>{if(!Fr){let e=await le("item");e||(e=await se("/data/item.csv"),de("item",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=J(e.text),n=J(e.trans,!0),r=q(e.type)||"normal";t&&n&&t!==n&&("limit"===r?$r.set(t,n):"note"===r?zr.set(t,n):Dr.set(t,n))}}),Fr=!0}return{itemMap:Dr,itemLimitMap:$r,itemNoteMap:zr}};let Nr=new Map,Br=new Map,Ur=new Map,Hr=new Map,Wr=new Map,qr=!1;const Jr=["produceItem","recoveryItem","exchangeItem","lotteryTicket","evolutionItem","gashaTicket","scoutTicket","enhancementItem"];let Gr,Kr;const Yr=async()=>{Kr||(Kr=Lr()),Gr||(Gr=await Kr)};let Qr=[];(window.unsafeWindow||window).printUnknowItems=()=>Y(Qr.join("\n"));const Vr=(e,t)=>{if(!e||"string"!=typeof e[t])return;const{itemMap:n,itemLimitMap:r,itemNoteMap:a}=Gr;let s=G(e[t]),i="",c="",u="";if(/[\s\S]+[\r\n]{0,2}\[[^\]]+\]$/.test(s)){let e=s.match(/([\s\S]+)([\r\n]{0,2}\[[^\]]+\])$/);s=e[1].trim();let t=e[2];i=r.has(t)?r.get(t):t}if(/[\s\S]+[\r\n]{0,2}【Exp:\d+】$/.test(s)){let e=s.match(/([\s\S]+)([\r\n]{0,2}【Exp:\d+】)$/);s=e[1].trim(),u=e[2]}if(/[\s\S]+[\r\n]{0,2}[(（][^)）]+[）)]$/.test(s)){let e=s.match(/([\s\S]+)([\r\n]{0,2})[(（]([^)）]+)[）)]$/);s=e[1].trim();let t=e[3];c=a.has(t)?`${e[2]}（${a.get(t)}）`:e[2]+"（txt）"}if(n.has(s)){let r=n.get(s);r=`${r}${c}${u}${i}`,e[t]=o(r)}else T.dev&&(e=>{if(!e)return;let t=Q(e);Qr.includes(t)||Qr.push(t)})(e[t])},Zr=e=>{var t;null==e||null===(t=e.shopMerchandises)||void 0===t||t.forEach(e=>{Vr(e,"title"),Vr(e,"shopTitle"),Vr(e,"comment")})},Xr=async e=>{let t=e;e.userProduceItems&&(t=e.userProduceItems),await Yr(),Array.isArray(t)&&t.forEach(e=>{const t=e[Jr[0]]||e[Jr[1]]||e[Jr[2]]||e[Jr[3]]||e[Jr[4]]||e[Jr[5]]||e[Jr[6]]||e[Jr[7]];Vr(t,"name"),Vr(t,"comment")})},eo=async e=>{await Yr(),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{e.gameEventAccumulatedPresent.rewards.forEach(e=>{Vr(e.content,"name")})})},to=async e=>{var t;await Yr(),null==e||null===(t=e.activeProduceItems)||void 0===t||t.forEach(e=>{Vr(e.produceItem,"name"),Vr(e.produceItem,"comment")})};cr.get([[["userShops","userIdolPieceShops"],async e=>{await Yr(),e&&(Array.isArray(e.userShops)&&e.userShops.forEach(e=>{Zr(e)}),Array.isArray(e.userEventShops)&&e.userEventShops.forEach(e=>{Zr(e.userShop)}))}],[["userRecoveryItems","userProduceItems","userExchangeItems","userLotteryTickets","userEvolutionItems","userGashaTickets","userScoutTickets","userEnhancementItems"],Xr],[["userPresents\\?limit={num}","userPresentHistories\\?limit={num}"],async e=>{await Yr(),Array.isArray(e)&&e.forEach(e=>{Vr(e.content,"name"),Vr(e,"note")})}],["userProduces",to],["missionEvents/{num}/top",eo]]),cr.post([["myPage",async e=>{await to(e.userProduce)}],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",eo],["userShops/actions/purchase",async e=>{await Yr(),Vr(null==e?void 0:e.shopMerchandise,"title"),Vr(null==e?void 0:e.shopMerchandise,"comment")}],["produces/{num}/actions/ready",Xr],["userPresents/{num}/actions/receive",async e=>{await Yr(),Vr(e.receivedPresent,"Name")}],["userMissions/{num}/actions/receive",async e=>{await Yr(),Vr(e.userMission.mission.missionReward.content,"name")}],["userLoginBonuses",async e=>{await Yr(),e.userLoginBonuses.forEach(e=>{e.loginBonus.sheets.forEach(e=>{e.rewards.forEach(e=>{Vr(e.content,"name")})})}),e.userTotalBonuses.forEach(e=>{e.rewards.forEach(e=>{Vr(e.content,"name")})})}],["fesTop",async e=>{await Yr(),e.lastRankingResult&&Array.isArray(e.lastRankingResult.fesMatchGradeRewards)&&e.lastRankingResult.fesMatchGradeRewards.forEach(e=>{Vr(e.content,"name")})}],["userSelectLoginBonuses/{num}",async e=>{await Yr(),e.rewards.forEach(e=>{Vr(e.content,"name")})}]]),cr.patch("produces/{num}/produceItem/consume",async e=>{var t;await Yr();const n=null===(t=e.consumeProduceItem)||void 0===t?void 0:t.produceItem;n&&(Vr(n,"name"),Vr(n,"comment"))});let no=null,ro=null;const oo=async()=>{ro||(ro=(async(e=!1)=>{if(!qr){let e=await le("mission-re");e||(e=await se("/data/mission-re.csv"),de("mission-re",e));const t=ce(e),n=[],r=[],o=[],a=new Map;pe(t,"text").forEach(e=>{if(null==e?void 0:e.text){const t=J(e.text),s=J(e.trans,!0),i=q(e.type);t&&s&&("noun"===i?(n.push(K(t)),Ur.set(t,s)):"note"===i?(o.push(K(t)),Wr.set(t,s),a.set(`【${t}】`,`【${s}】`)):"name"===i?(r.push(K(t)),Hr.set(t,s)):"exp"===i&&a.set(t,s),"exp"!==i&&Nr.set(t,s))}});const s=[{re:/\$name/g,exp:`(${r.join("|")})`},{re:/\$noun/g,exp:`(${n.join("|")})`},{re:/\$note/g,exp:`(${o.join("|")})`}];for(let[e,t]of a){const n=fe(e,s);Br.set(n,t)}qr=!0}const t=[Ur,Wr,Hr];let{itemMap:n}=await Lr();return Nr=new Map([...n,...Nr]),{expMap:Br,wordMaps:t,textMap:Nr}})()),await Yr(),no=await ro},ao=(e,t)=>{let n=!1;if(!e||"string"!=typeof e[t])return n;const{expMap:r,wordMaps:a,textMap:s}=no,i=G(e[t]);let c=i;return i?(s.has(i)?(n=!0,e[t]=o(s.get(i))):(c=ee(i,r,a),i!==c?(n=!0,e[t]=o(c)):T.dev&&po(e,t)),n):n},so=(e,t)=>{ao(e,t)||Vr(e,t)},io=e=>{null==e||e.forEach(e=>{ao(e.mission,"title"),ao(e.mission,"comment"),e.mission.missionReward.content&&(so(e.mission.missionReward.content,"name"),so(e.mission.missionReward.content,"comment"))})},co=e=>{e.forEach(e=>{let t=e.fesRaidAccumulatedReward;ao(t,"title"),ao(t,"comment");let n=t.fesRaidAccumulatedRewardContent;(null==n?void 0:n.content)&&(so(n.content,"name"),so(n.content,"comment"))})},uo=(e,t=!0)=>{null==e||e.forEach(e=>{let n=e.mission||e;if(ao(n,"title"),ao(n,"comment"),ao(n,"afterAchievedComment"),ao(n,"beforeAchievedComment"),t){let e=n.lectureMissionReward;(null==e?void 0:e.content)&&(so(e.content,"name"),so(e.content,"comment"))}})},lo=[],po=(e,t)=>{if(!e[t])return;const n=Q(e[t]);lo.includes(n)||lo.push(n)};(window.unsafeWindow||window).printUnknownMission=()=>Y(lo.join("\n"));const fo=async e=>{var t,n;await oo(),ao(null===(t=e.userRecommendedMission)||void 0===t?void 0:t.mission,"comment"),ao(null===(n=e.userRecommendedMission)||void 0===n?void 0:n.mission,"title"),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{ao(e.gameEventAccumulatedPresent,"comment"),ao(e.gameEventAccumulatedPresent,"title")})},ho=async e=>{var t;await oo(),null===(t=e.teachingHints)||void 0===t||t.forEach(e=>{var t,n;null===(t=e.userProduceHints)||void 0===t||t.forEach(e=>{ao(e.produceTeachingHint,"title")}),null===(n=e.userProduceTeachingHints)||void 0===n||n.forEach(e=>{ao(e.produceTeachingHint,"title")})})},mo=async e=>{await oo(),uo(e.lectureMissions)},vo=e=>{var t;null===(t=e.userIdolRoad)||void 0===t||t.idolRoad.idolRoadRewards.forEach(e=>{so(e.content,"name"),so(e.content,"comment")})};cr.get([["userMissions",async e=>{var t;await oo(),io(e.dailyUserMissions),io(e.weeklyUserMissions),null===(t=e.eventUserMissions)||void 0===t||t.forEach(e=>{io(null==e?void 0:e.userMissions)}),io(e.normalUserMissions),io(e.specialUserMissions)}],["fesRaidEvents/{num}/rewards",async e=>{await oo(),co(e.fesRaidBestScoreRewards),co(e.fesRaidLapRewards),co(e.fesRaidPointRewards)}],[["userProduces","userProduceTeachings"],[ho]],["userBeginnerMissions/top",mo],["idolRoads/top",async e=>{var t;await oo(),uo(e.userMissions,!1),null===(t=e.userIdols)||void 0===t||t.forEach(vo)}],["missionEvents/{num}/top",[fo]]]),cr.post([["myPage",[async e=>{await oo(),io(e.reportUserMissions)},async e=>{await oo();let t=e.beginnerMission;t&&(t.clearedLectureMission&&uo([t.clearedLectureMission]),t.progressLectureMission&&uo([t.progressLectureMission]))}]],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",[fo]],[["produceTeachings/resume","produceTeachings/next"],ho],["userLectureMissions/{num}/actions/receive",mo]]),cr.put("userIdolRoads",async e=>{await oo(),vo(e.userIdol)});const yo=new Map;let go=!1;const wo=async()=>{if(!go){let e=await le("name");e||(e=await se("/data/name.csv"),de("name",e));ce(e).forEach(e=>{const t=q(e.name),n=q(e.trans);t&&n&&t!==n&&yo.set(t,n)}),go=!0}return yo},bo=new Map,Eo=new Map,_o=new Map;let ko=!1;let So,Io,xo,jo;const Ao=async()=>{xo||(xo=(async()=>{if(!ko){let e=await le("title");e||(e=await se("/data/title.csv"),de("title",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=J(e.text),n=J(e.trans,!0),r=q(e.type)||"text";t&&n&&t!==n&&("exp"===r?Eo.set(t,n):"text"===r&&bo.set(t,n))}});for(let[e,t]of Eo){const n=fe(e);_o.set(n,t)}ko=!0}return{textMap:bo,expMap:_o}})(),jo=wo()),So&&Io||(So=await xo,Io=await jo,So.wordMaps=[Io])};let Co=[];(window.unsafeWindow||window).printUnknowTitles=()=>Y(Co.join("\n"));const Mo=new Map,Ro=(e,t)=>{e&&k(t)&&(Mo.has(e)||Mo.set(e,t))},Oo=(e={},t)=>{let n=e[t];te(e,t,So),T.dev&&n===e[t]&&(e=>{if(!e)return;let t=Q(e);Co.includes(t)||Co.push(t)})(n)},To=e=>{e.forEach(e=>{Oo(e,"name"),e.communications.forEach(e=>{Oo(e,"name"),Oo(e,"title"),Ro(e.id,`${e.name}-${e.title}`)})})};cr.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],async e=>{await Ao(),e.supportIdol.produceSupportIdolEvents.forEach(e=>{Oo(e,"title"),Ro(e.id,e.title)})}],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],async e=>{await Ao(),e.idol.produceAfterEvents.forEach(e=>{Oo(e,"title"),Ro(e.id,e.title)}),e.idol.produceIdolEvents.forEach(e=>{Oo(e,"title"),Ro(e.id,e.title)})}],[["characterAlbums","album/top"],async e=>{await Ao(),To(e.gameEvents),To(e.specialEvents)}]]),cr.post([["characterAlbums/characters/{num}",async e=>{await Ao(),e.albumCommunicationTitles.forEach(e=>{Oo(e,"title")}),e.communications.forEach(e=>{Oo(e,"title"),Ro(e.communicationId,e.title)}),e.voices.forEach(e=>{Oo(e,"title"),Oo(e,"releasedConditionComment")})}],["produceMarathons/{num}/top",async e=>{await Ao(),e.releasedCommunications.forEach(e=>{Oo(e,"name"),Oo(e,"title"),Ro(e.id,`${e.name}-${e.title}`)}),Oo(e.gameEvent,"name")}]]);const Po=async e=>{const t=await wo();if(e.userProduceIdol){const n=e.userProduceIdol.userIdol.idol.character;t.has(n.name)&&(n.name=o(t.get(n.name))),t.has(n.firstName)&&(n.firstName=o(t.get(n.firstName)))}},Do=async e=>{var t;await Ao(),null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{Oo(e,"title"),Ro(e.id,e.title)})};cr.post([["myPage",async e=>{var t;await Ao(),Oo(null==e||null===(t=e.userProduce)||void 0===t?void 0:t.produce,"title")}],["produces/actions/(resume|next)",[Do,Po]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],Do],["produces/actions/act",Do],["produces/({num}/audition|concert)/actions/(start|finish)",Po]]);const $o=new Map,zo=new Map;let Fo=!1,Lo=null;const No=e=>{const t=ce(e),n=new Map,r=Z();return t.forEach(e=>{const t=r(q(e.id)),a=J(e.text),s=J(e.trans,!0),i=q(e.name);a&&s&&(t&&!/^0+$/.test(t)&&"select"!==t?n.set(t,o(s)):"select"===t?n.set(a+"-select",o(s)):n.set(a,o(s))),t&&i&&"info"===t&&n.set("name",i)}),n},Bo=async()=>{if(!Fo){let e=await le("comm-story");e||(e=await se("/data/comm-story.csv"),de("comm-story",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=J(e.text),n=J(e.trans,!0);t&&n&&t!==n&&zo.set(t,n)}}),Fo=!0}return zo};let Uo=new Map,Ho=!1;const Wo=async()=>{if(!Ho){let e=await le("type-text");e||(e=await se("/data/type-text.csv"),de("type-text",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=J(e.text),n=J(e.trans,!0);t&&n&&t!==n&&Uo.set(t,n)}});const t=await Bo();Uo=new Map([...t,...Uo]),Ho=!0}return Uo};var qo=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},Jo=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]},Go=function(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])},Ko=function(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},Yo=function(e,t){return[e[0]^t[0],e[1]^t[1]]},Qo=function(e){return e=Yo(e,[0,e[0]>>>1]),e=Jo(e,[4283543511,3981806797]),e=Yo(e,[0,e[0]>>>1]),e=Jo(e,[3301882366,444984403]),e=Yo(e,[0,e[0]>>>1])};let Vo="";const Zo=()=>{let e="0123456789abcdefghijklmnopqrstuvwxyz",t="";for(let n=0;n<33;n++)t+=e[Math.floor(Math.random()*e.length)];Vo=function(e,t){t=t||0;for(var n=(e=e||"").length%16,r=e.length-n,o=[0,t],a=[0,t],s=[0,0],i=[0,0],c=[2277735313,289559509],u=[1291169091,658871167],l=0;l<r;l+=16)s=[255&e.charCodeAt(l+4)|(255&e.charCodeAt(l+5))<<8|(255&e.charCodeAt(l+6))<<16|(255&e.charCodeAt(l+7))<<24,255&e.charCodeAt(l)|(255&e.charCodeAt(l+1))<<8|(255&e.charCodeAt(l+2))<<16|(255&e.charCodeAt(l+3))<<24],i=[255&e.charCodeAt(l+12)|(255&e.charCodeAt(l+13))<<8|(255&e.charCodeAt(l+14))<<16|(255&e.charCodeAt(l+15))<<24,255&e.charCodeAt(l+8)|(255&e.charCodeAt(l+9))<<8|(255&e.charCodeAt(l+10))<<16|(255&e.charCodeAt(l+11))<<24],s=Jo(s,c),s=Go(s,31),s=Jo(s,u),o=Yo(o,s),o=Go(o,27),o=qo(o,a),o=qo(Jo(o,[0,5]),[0,1390208809]),i=Jo(i,u),i=Go(i,33),i=Jo(i,c),a=Yo(a,i),a=Go(a,31),a=qo(a,o),a=qo(Jo(a,[0,5]),[0,944331445]);switch(s=[0,0],i=[0,0],n){case 15:i=Yo(i,Ko([0,e.charCodeAt(l+14)],48));case 14:i=Yo(i,Ko([0,e.charCodeAt(l+13)],40));case 13:i=Yo(i,Ko([0,e.charCodeAt(l+12)],32));case 12:i=Yo(i,Ko([0,e.charCodeAt(l+11)],24));case 11:i=Yo(i,Ko([0,e.charCodeAt(l+10)],16));case 10:i=Yo(i,Ko([0,e.charCodeAt(l+9)],8));case 9:i=Yo(i,[0,e.charCodeAt(l+8)]),i=Jo(i,u),i=Go(i,33),i=Jo(i,c),a=Yo(a,i);case 8:s=Yo(s,Ko([0,e.charCodeAt(l+7)],56));case 7:s=Yo(s,Ko([0,e.charCodeAt(l+6)],48));case 6:s=Yo(s,Ko([0,e.charCodeAt(l+5)],40));case 5:s=Yo(s,Ko([0,e.charCodeAt(l+4)],32));case 4:s=Yo(s,Ko([0,e.charCodeAt(l+3)],24));case 3:s=Yo(s,Ko([0,e.charCodeAt(l+2)],16));case 2:s=Yo(s,Ko([0,e.charCodeAt(l+1)],8));case 1:s=Yo(s,[0,e.charCodeAt(l)]),s=Jo(s,c),s=Go(s,31),s=Jo(s,u),o=Yo(o,s)}return o=Yo(o,[0,e.length]),a=Yo(a,[0,e.length]),o=qo(o,a),a=qo(a,o),o=Qo(o),a=Qo(a),o=qo(o,a),a=qo(a,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)}(t,31),localStorage.setItem("sczh:bid",Vo)};try{Vo=localStorage.getItem("sczh:bid")}catch(e){}Vo||Zo();var Xo=Object.prototype.hasOwnProperty,ea=Array.isArray,ta=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),na=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n},ra={arrayToObject:na,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],a=o.obj[o.prop],s=Object.keys(a),i=0;i<s.length;++i){var c=s[i],u=a[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:a,prop:c}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(ea(n)){for(var r=[],o=0;o<n.length;++o)void 0!==n[o]&&r.push(n[o]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n){if(0===e.length)return e;var r=e;if("symbol"==typeof e?r=Symbol.prototype.toString.call(e):"string"!=typeof e&&(r=String(e)),"iso-8859-1"===n)return escape(r).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var o="",a=0;a<r.length;++a){var s=r.charCodeAt(a);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?o+=r.charAt(a):s<128?o+=ta[s]:s<2048?o+=ta[192|s>>6]+ta[128|63&s]:s<55296||s>=57344?o+=ta[224|s>>12]+ta[128|s>>6&63]+ta[128|63&s]:(a+=1,s=65536+((1023&s)<<10|1023&r.charCodeAt(a)),o+=ta[240|s>>18]+ta[128|s>>12&63]+ta[128|s>>6&63]+ta[128|63&s])}return o},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(ea(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!Xo.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var o=t;return ea(t)&&!ea(n)&&(o=na(t,r)),ea(t)&&ea(n)?(n.forEach((function(n,o){if(Xo.call(t,o)){var a=t[o];a&&"object"==typeof a&&n&&"object"==typeof n?t[o]=e(a,n,r):t.push(n)}else t[o]=n})),t):Object.keys(n).reduce((function(t,o){var a=n[o];return Xo.call(t,o)?t[o]=e(t[o],a,r):t[o]=a,t}),o)}},oa=String.prototype.replace,aa=/%20/g,sa={RFC1738:"RFC1738",RFC3986:"RFC3986"},ia=ra.assign({default:sa.RFC3986,formatters:{RFC1738:function(e){return oa.call(e,aa,"+")},RFC3986:function(e){return String(e)}}},sa),ca=(Date.prototype.toISOString,ia.default);ia.formatters[ca];const ua=async e=>{const t={text:e};try{const e="https://hooks.sla"+"ck.com/services/TN6J76CUB/BNJ2"+"YLNR3/baGxj31D5YxNhL2Q9FcbzaTA";await((e,t)=>{const{method:n="GET",headers:r,data:o}=t;return fetch(e,{body:o,headers:r,method:n,mode:"cors",referrer:"no-referrer"}).then(e=>e.json())})(e,{data:JSON.stringify(t),method:"POST",headers:{accept:"*/*",referer:"https://hooks.slack.com",origin:"https://hooks.slack.com"}});return""}catch(e){return""}},la=["text","select","comment","title","actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment","characterComment","producerComment","comment1","comment2"];let da=!1;const pa=async(e,t,n)=>{if(!e.length)return;const r=await Wo(),{textInfo:a,textList:s}=((e,t)=>{const n=[],r=[];return e.forEach((e,a)=>{la.forEach(s=>{let i=G(e[s]);e[s]&&(t.has(i)?e[s]=o(t.get(i)):(n.push({key:s,index:a}),r.push(i)))})}),{textInfo:n,textList:r}})(e,r);if(a.length&&"……"!=s&&1!=da&&"…………"!=s&&"………………\n……………………\n…………………………"!=s&&!(a.length>9))if(n){let e=[];s.forEach((t,n)=>{e.push(Q(t))});const t=e.join("\n"),n=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,r=[];["…………","……","………………\n……………………\n…………………………"].forEach(e=>{r.push(Q(e))}),n.test(t)||r.includes(e[0])||await ua(t),da=!0}else{let e=[];s.forEach((t,n)=>{e.push("commstory"+Q(t))});const t=e.join("\n"),n=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,r=[];["…………","……","………………\n……………………\n…………………………"].forEach(e=>{r.push(Q(e))}),n.test(t)||r.includes(e[0])||await ua(t),da=!0}},fa=async(e,t="comment")=>{if(!e)return;e.map(e=>e[t]).join("").trim();await pa(e,0,!0)},ha=["actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment"],ma=async e=>{try{if(e.produceAudition){e.produceAudition.judges.map(e=>ha.map(t=>e[t]||"").join("")).join("").trim();await pa(e.produceAudition.judges,0,!0)}if(e.produceConcert){e.produceConcert.judges.map(e=>ha.map(t=>e[t]||"").join("")).join("").trim();await pa(e.produceConcert.judges,0,!0)}e.produceConcertFanSkillComments&&await fa(e.produceConcertFanSkillComments,"comment1")}catch(e){Y(e)}},va=async e=>{if(e.judges){e.judges.map(e=>ha.map(t=>e[t]||"").join("")).join("").trim();await pa(e.judges,0,!0)}},ya=async e=>{if(e.topCharacterReaction)try{const t=[...e.topCharacterReaction.moveReactions,...e.topCharacterReaction.skillReleasedReactions,...e.topCharacterReaction.touchExReactions,...e.topCharacterReaction.touchReactions,...e.topCharacterReaction.waitReactions];await fa(t)}catch(e){Y(e)}},ga=async e=>{let t=[...e.produceStaffComments||[],...e.produceStaffConcertComments||[],...e.produceStaffFailComments||[],...e.produceStaffSeasonComments||[]];await fa(t)},wa=async e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.judges?await va(t):await ma(t),e.gameData=JSON.stringify(t)}catch(e){Y(e)}},ba=async e=>{if(!e.characterComment)return;let t=[];t=t.concat(e.characterComment),await fa(t)};cr.get([["userProduces",ya],["fes(Match)?Concert/actions/resume",wa]]),cr.post([["myPage",async e=>{try{let t=[];e.userHomeDeck.userHomeDeckAnimationMember&&(t=[...e.userHomeDeck.userHomeDeckAnimationMember.mypageComments]);let n=e.userHomeDeck.userHomeAnimationDeck.userHomeAnimationDeckMembers;n&&n.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)}),e.mypageConversations.forEach(e=>{e.mypageConversationComments.forEach(e=>{t.push(e)})})}),e.userHomeDeck.userHomeDeckMembers.length&&e.userHomeDeck.userHomeDeckMembers.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)})}),await fa(t)}catch(e){Y(e)}}],["fesTop",async e=>{if(e.userFesDeck)try{let t=[],n=e.userFesDeck.userFesDeckMembers;for(let e of n)e.fesTopCharacterReactions.forEach(e=>{t.push(e)});await fa(t)}catch(e){Y(e)}}],["produces/actions/(resume|next)",[ya,ga,wa,ba,ma,async e=>{try{var t;await fa(null===(t=e.produceReporterEvent)||void 0===t?void 0:t.produceReporterEventAnswers,"comment2")}catch(e){Y(e)}}]],["produces/actions/endWeek",ga],["produces/actions/act",async e=>{if(!e.lessonResult)return;let t=e.lessonResult;try{let e=[];t.produceActCutinComment&&(e=e.concat(t.produceActCutinComment)),t.produceRestBoostIdolComment&&(e=e.concat(t.produceRestBoostIdolComment)),t.produceRestBoostSupportIdolComment&&(e=e.concat(t.produceRestBoostSupportIdolComment)),t.produceRestComments&&(e=e.concat(t.produceRestComments)),await fa(e)}catch(e){Y(e)}}],["fes(Match|Raid)?Concert/actions/start",va],["fes(Match)?Concert/actions/resume",wa],["fesRaidConcert/actions/resume",async e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.judges&&await va(t),e.gameState.game_data=JSON.stringify(t)}catch(e){Y(e)}}],["produces/actions/result",async e=>{try{let t=e.characterTrustLevelUpComments;await fa(t)}catch(e){Y(e)}}],["produces/({num}/audition|concert)/actions/(start|finish)",[ma,ba]],["userProduceHelperSupportIdols",async e=>{try{e.characterComment,e.producerComment;await pa([e],0,!0)}catch(e){Y(e)}}]]);cr.get("gashas/{num}/redraws",async e=>{const t=[];e.forEach(e=>{e.comment&&t.push(e.comment)}),await fa(t)}),cr.post([["characterAlbums/characters/{num}",async e=>{const t=[];e.produceIdols.forEach(e=>{e.comment&&t.push(e.comment)}),await fa(t)}],["gashas/{num}/actions/draw",async e=>{var t;const n=[];null===(t=e.gashaDraws)||void 0===t||t.forEach(e=>{e.comment&&n.push(e.comment)}),await fa(n)}]]);const Ea=new Map;let _a=!1;let ka=null;const Sa=async()=>(ka||(ka=(async()=>{if(!_a){let e=await le("profile");e||(e=await se("/data/profile.csv"),de("profile",e));ce(e).forEach(e=>{const t=q(e.name);t&&Ea.set(t,e)}),_a=!0}return Ea})()),await ka),Ia=(e,t,n)=>{"unit_name"==t&&n[t]?e.unit.name=n[t]:n[t]&&(e[t]=n[t])},xa=(e,t)=>{Ia(e,"arm",t),Ia(e,"birthDay",t),Ia(e,"characterVoice",t),Ia(e,"firstName",t),Ia(e,"hobby",t),Ia(e,"nameKana",t),Ia(e,"place",t),Ia(e,"arm",t),Ia(e,"specialty",t),Ia(e,"starSign",t),Ia(e,"unit_name",t)},ja=async e=>{const t=await Sa();if(e.name){const n=t.get(e.name);xa(e,n)}e.beginnerMissionUnits&&e.beginnerMissionUnits.forEach(e=>{e.idols.forEach(e=>{const n=t.get(e.idol.character.name);xa(e.idol.character,n)})}),e.units&&e.units.forEach(e=>{e.idols.forEach(e=>{const n=t.get(e.character.name);xa(e.character,n)})})},Aa=new Map;let Ca=!1;const Ma=new Map;let Ra=!1;let Oa;const Ta=async()=>(Oa||(Oa=(async()=>{if(!Ca){let e=await le("cardname");e||(e=await se("/data/cardname.csv"),de("cardname",e));ce(e).forEach(e=>{const t=q(e.name),n=q(e.trans);t&&n&&t!==n&&Aa.set(t,n)}),Ca=!0}return Aa})()),await Oa);let Pa=[];const Da=e=>{if(!e)return;let t=Q(e);Pa.includes(t)||Pa.push(t)};(window.unsafeWindow||window).printUnknowCardnames=()=>Y(Pa.join("\n"));const $a=(e,t)=>{if(!e||!t||!e.name)return;let n=G(e.name);t.has(e.name)&&(e.name=o(t.get(e.name))),T.dev&&n===e.name&&Da(n)},za=async e=>{const t=await Ta();e.idol&&$a(e.idol,t),e.supportIdol&&$a(e.supportIdol,t),e.userSupportIdol&&$a(e.userSupportIdol.supportIdol,t),e.userProduceSupportIdols&&e.userProduceSupportIdols.forEach((function(e){$a(e.userSupportIdol.supportIdol,t)})),e.userIdol&&$a(e.userIdol.idol,t),e.userProduceIdol&&$a(e.userProduceIdol.userIdol.idol,t),e.userProduce&&e.userProduce.userProduceIdol&&$a(e.userProduce.userProduceIdol.userIdol.idol,t),e.userFesIdol&&$a(e.userFesIdol.idol,t)},Fa=async e=>{const t=await Ta(),n=await(async()=>{if(!Ra){let e=await le("costumename");e||(e=await se("/data/costumename.csv"),de("costumename",e));ce(e).forEach(e=>{const t=J(e.name),n=J(e.trans);t&&n&&t!==n&&Ma.set(t,n)}),Ra=!0}return Ma})(),r=new Map([...t,...n]);e.idolCostumes&&e.idolCostumes.forEach((function(e){$a(e,r),((e,t)=>{if(!e||!t||!e.comment)return;let n=G(e.comment);t.has(e.comment)&&(e.comment=o(t.get(e.comment))),T.dev&&n===e.comment&&Da(n)})(e,r)})),e.userFesDecks&&e.userFesDecks.forEach((function(e){e.userFesDeckMembers.forEach((function(e){e.idolCostumes.forEach((function(e){$a(e,r)}))}))}))};cr.get([["userBeginnerMissions/top",[ja]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],za],[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],za],["userProduce(Teaching)?SupportIdols/{num}",za],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],za],["userFesIdols/{num}",za],["userProduces",za],["userReserveIdols/userIdol/{num}",za],["userReserveSupportIdols/userSupportIdol/{num}",za],["tutorialIdols",ja]]),cr.post([[["myPage","produces/actions/(resume|next)"],za]]),cr.post("characterAlbums/characters/{num}",[async e=>{if(e.voices){const t=[];e.voices.forEach(e=>{e.characterTrustLevelComment&&t.push(e.characterTrustLevelComment)}),await fa(t)}},ja,Fa]),cr.patch([["userFesDecks",Fa]]),cr.put([["userHomeDecks",Fa]]);const La=new Map;let Na=!1;let Ba=null;async function Ua(){const e=await er("PHRASE");if(e){Ba=await(async(e=!1)=>{if(!Na){let t=await le("phrase");t||(t=await se("/data/phrase.csv"),de("phrase",t));ce(t).forEach(t=>{if(null==t?void 0:t.id){const n=J(t.id),r=J(t.trans,!0);n&&(e?La.set(n,t.trans):r&&La.set(n,o(r)))}}),Na=!0}return La})();for(let[t,n]of Ba)e[t]=n}}let Ha=new Map,Wa=!1;let qa=new Map,Ja=new Map;const Ga=[],Ka=e=>{e&&e.fontFamily&&(e.fontFamily===$.HEITI_JA?Reflect.set(e,"fontFamily",$.HEITI_TRANS):e.fontFamily===$.YUAN_JA&&Reflect.set(e,"fontFamily",$.YUAN_TRANS))},Ya=(e,t,n)=>{let r=e,o=G(e);return t.has(o)?(r="​"+t.get(o),Ka(n)):e.startsWith("​")||(e=>{e&&e.fontFamily&&(e.fontFamily===$.HEITI_TRANS?Reflect.set(e,"fontFamily",$.HEITI_JA):e.fontFamily===$.YUAN_TRANS&&Reflect.set(e,"fontFamily",$.YUAN_JA))})(n),r},Qa=(e,t,n=!1)=>{if(!k(e))return e;let r=e;return e.startsWith("​")?Ka(t):e.trim()&&(n?(r=Ya(e,Ja,t),r===e&&(e=>{Ga.push(e),T.dev,setTimeout(()=>Ga.shift(),1e4)})(e)):(e=>{let t=!1;return Ga.forEach(n=>{n.startsWith(e)&&(t=!0)}),t})(e)||e.startsWith("‌")||(r=Ya(e,qa,t))),r};async function Va(){const e=await er("AOBA");try{qa=await(async()=>{if(!Wa){let e=await le("common");e||(e=await se("/data/common.csv"),de("common",e));ce(e).forEach(e=>{if(null==e?void 0:e.text){const t=J(e.text),n=J(e.trans,!0);t&&n&&t!==n&&Ha.set(t,n)}});const{itemMap:t}=await Lr(),n=await wo();Ha=new Map([...t,...n,...Ha]),Wa=!0}return Ha})(),Ja=await Wo()}catch(e){}const t=e.Text.prototype.typeText;e.Text.prototype.typeText=function(...e){const n=e[0];return e[0]=Qa(n,this.style,!0),t.apply(this,e)};const n=e.Text.prototype.updateText;e.Text.prototype.updateText=function(e){if(this.localStyleID!==this._style.styleID&&(this.dirty=!0,this._style.styleID),this.dirty||!e){T.dev,0;const t=Qa(this._text,this._style);return Reflect.set(this,"_text",t),n.call(this,e)}}}const Za=new Map;let Xa=!1;let es=null;const ts=async()=>(es||(es=(async()=>{if(!Xa){let e=await le("image");e||(e=await se("/data/image.csv"),de("image",e));ce(e).forEach(e=>{if(null==e?void 0:e.name){const t=q(e.name),n=q(e.url),r=q(e.version)||"1";t&&n&&Za.set(t,{url:n,version:r})}}),Xa=!0}return Za})()),await es);let ns=!1;async function rs(){const e=await er("AOBA");if(ns)return;const t=e.loaders.Resource.prototype._loadElement,n=async function(e){T.dev;try{const t=await ts();if("image"===e&&t.has(this.name)){const e=t.get(this.name);if(this.url.endsWith("v="+e.version)){const t="image/"+e.url;this.url=`${T.origin}/data/${t}?v=${T.hashes[t]}`,this.crossOrigin=!0}else Y("%cimage version not match","color:#fc4175"),Y(this.name,this.url)}else"image"===e&&this.originUrl.includes("idols/name")&&(Y("%cidol name display!!","color:#fc4175"),Y(this.name,this.url))}catch(e){}return t.call(this,e)},r=new Proxy(e.loaders.Resource,{construct(e,t,r){var o=Reflect.construct(e,t,r);return new Proxy(o,{get:(e,t,r)=>"_loadElement"==t?n:Reflect.get(e,t,r)})},get:(e,t,n)=>Reflect.get(e,t,n)});Object.defineProperty(e.loaders,"Resource",{value:r}),ns=!0}var os=function(){return l.Date.now()},as=/\s/;var ss=function(e){for(var t=e.length;t--&&as.test(e.charAt(t)););return t},is=/^\s+/;var cs=function(e){return e?e.slice(0,ss(e)+1).replace(is,""):e};var us=function(e){return"symbol"==typeof e||_(e)&&"[object Symbol]"==b(e)},ls=/^[-+]0x[0-9a-f]+$/i,ds=/^0b[01]+$/i,ps=/^0o[0-7]+$/i,fs=parseInt;var hs=function(e){if("number"==typeof e)return e;if(us(e))return NaN;if(Re(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Re(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=cs(e);var n=ds.test(e);return n||ps.test(e)?fs(e.slice(2),n?2:8):ls.test(e)?NaN:+e},ms=Math.max,vs=Math.min;var ys=function(e,t,n){var r,o,a,s,i,c,u=0,l=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,a=o;return r=o=void 0,u=t,s=e.apply(a,n)}function h(e){return u=e,i=setTimeout(v,t),l?f(e):s}function m(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-u>=a}function v(){var e=os();if(m(e))return y(e);i=setTimeout(v,function(e){var n=t-(e-c);return d?vs(n,a-(e-u)):n}(e))}function y(e){return i=void 0,p&&r?f(e):(r=o=void 0,s)}function g(){var e=os(),n=m(e);if(r=arguments,o=this,c=e,n){if(void 0===i)return h(c);if(d)return clearTimeout(i),i=setTimeout(v,t),f(c)}return void 0===i&&(i=setTimeout(v,t)),s}return t=hs(t)||0,Re(n)&&(l=!!n.leading,a=(d="maxWait"in n)?ms(hs(n.maxWait)||0,t):a,p="trailing"in n?!!n.trailing:p),g.cancel=function(){void 0!==i&&clearTimeout(i),u=0,r=c=o=i=void 0},g.flush=function(){return void 0===i?s:y(os())},g};const gs=`\n  <style>\n  #sczh-story-tool {\n    position: absolute;\n    display: none;\n    background: #ffffff;\n    border-radius: 24px;\n    box-sizing: border-box;\n    font-family: sczh-yuanti;\n    align-items: center;\n    justify-content: center;\n    color: #ff6499;\n    text-shadow: 0 0 6px #fff;\n    cursor: pointer;\n    user-select: none;\n    width: 100px;\n    height: 100px;\n    font-size: 32px;\n    border: 7px solid transparent;\n    border-image: url(${T.origin}/data/image/border.png);\n    border-image-slice: 7;\n    transform-origin: top right;\n    transition: opacity 0.3s;\n  }\n  .story-tool-btns {\n    width: 100%;\n    height: 100%;\n    display: none;\n  }\n  .story-tool-btns .btn-download-sczh,\n  .story-tool-btns label {\n    flex: 1;\n    height: 100%;\n    background: #fff;\n    display: flex;\n    box-sizing: content-box;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    color: #c0aade;\n    text-shadow: 0 0 6px #fff;\n  }\n  .story-tool-btns .btn-download-sczh:hover {\n    color: #9f66ec;\n  }\n  .story-tool-btns label {\n    color: rgb(242, 156, 199);\n    border-right: 1px solid #c9c9c9;\n  }\n  #sczh-story-tool .btn-close-sczh {\n    height: 25px;\n    width: 50px;\n    background: rgba(0, 0, 0, 0.58);\n    color: #fff;\n    letter-spacing: 2px;\n    position: absolute;\n    right: -25px;\n    top: -20px;\n    border-radius: 4px;\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 1;\n    font-family: sczh-heiti;\n    font-size: 15px;\n  }\n  #sczh-story-tool:hover {\n    width: 200px;\n  }\n  #sczh-story-tool:hover .story-tool-btns {\n    display: flex;\n  }\n  #sczh-story-tool:hover .btn-close-sczh {\n    display: flex;\n  }\n  #sczh-story-tool:hover > .text-sczh {\n    display: none;\n  }\n  #sczh-story-tool .btn-close-sczh:hover {\n    background: rgba(0, 0, 0, 0.9);\n  }\n  #sczh-story-tool.blur {\n    opacity: 0.2;\n  }\n  .story-tool-btns label:hover {\n    color: #f270b1;\n  }\n  .story-tool-btns .btn-download-sczh:hover,\n  .story-tool-btns label:hover {\n    background-color: #f7f7f7;\n  }\n  </style>\n  <div id="sczh-story-tool"><span class="text-sczh">커뮤</span>\n    <span id="btn-close-sczh" class="btn-close-sczh">닫기</span>\n    <input type="file" style="display:none" id="ipt-preview-sczh" multiple accept=".csv">\n    <div class="story-tool-btns">\n      <label for="ipt-preview-sczh">실험</label>\n      <div id="btn-download-sczh" class="btn-download-sczh">다운</div>\n    </div>\n  </div>\n  `;let ws=!1;const bs=e=>{if(ws)return;ws=!0,document.body.insertAdjacentHTML("beforeend",gs);const t=document.getElementById("sczh-story-tool"),n=ys(()=>{const n=[.017,.22],r=window.innerHeight,o=window.innerWidth;let a=r,s=o,i=0,c=0;r/o>9/16?(a=9*o/16,i=(r-a)/2):(s=16*r/9,c=(o-s)/2),t.style.right=Math.floor(c+n[0]*s)+"px",t.style.top=Math.floor(i+n[1]*a)+"px",t.style.transform=`scale(${(a/900).toFixed(3)})`,e.name?t.style.display="flex":t.style.display="none"},300);n(),window.addEventListener("resize",n);document.getElementById("btn-download-sczh").addEventListener("click",(function(){if(e.name){((e,t)=>{const n=document.createElement("a");n.download=t,n.style.display="none";const r=new Blob([e],{type:"text/csv"});n.href=URL.createObjectURL(r),document.body.appendChild(n),n.click(),document.body.removeChild(n)})(ie.unparse(e.list),e.filename)}}));document.getElementById("btn-close-sczh").addEventListener("click",(function(){t.style.display="none",T.story="normal",N()}));let r;document.getElementById("ipt-preview-sczh").addEventListener("change",(function(){const t=this.files;t.length&&t.forEach(t=>{const n=new FileReader;n.onload=t=>{const n=t.target.result,r=No(n);if(r.has("name")){const t=r.get("name");e.preview.set(t,r),(e=>{const t=[...e].slice(-5).map(e=>(e[1]=[...e[1]],e));sessionStorage.setItem("sczh:preview",JSON.stringify(t))})(e.preview),alert(`도입${t}성공`)}},n.readAsText(t)})})),t.addEventListener("mouseenter",()=>{clearTimeout(r),t.classList.remove("blur")});const o=()=>{clearTimeout(r),r=setTimeout(()=>{t.classList.add("blur")},5e3)};t.addEventListener("mouseleave",o),o()},Es=new Map,_s=new Map;let ks=!1;const Ss=async()=>{if(!ks){let e=await le("speaker-icon");e||(e=await se("/data/speaker-icon.csv"),de("speaker-icon",e));ce(e).forEach(e=>{let{name:t,id:n,type:r}=e;t=q(t),n=q(n),r=q(r),t&&n&&("sub"===r?_s.set(t,n):Es.set(t,n))}),ks=!0}return{iconMap:Es,subIconMap:_s}};let Is=null;let xs=!1;const js=async()=>{if(xs)return;xs=!0;const e=await er("SPEAKER");if(!e)return((...e)=>{console.info(...e)})("Speaker-icon module not found.");const{iconMap:t,subIconMap:n}=await Ss(),r=e.getSubCharacterBackLogIconId,o=e.getCharacterBackLogIconId;e.getSubCharacterBackLogIconId=function(e){const t=a(e);return n.has(t)?n.get(t):r.call(this,e)},e.getCharacterBackLogIconId=function(e){const n=a(e);return t.has(n)?t.get(n):o.call(this,e)}},As=(e,t)=>{let n=e,r="";return/[0-9０-９]$/.test(e)&&(r=e.match(/([0-9０-９])$/)[1],n=e.slice(0,e.length-1)),t.has(n)?t.get(n)+r:e},Cs=async e=>{if(e.speaker){await js();const t=await(async()=>(Is||(Is=wo()),await Is))();let n=q(e.speaker);if(t.has(n))return e.speaker=o(t.get(n));["＆","&"].forEach(e=>{n=((e,t,n)=>{const r=e.split(t);for(let e=0;e<r.length;e++)r[e]=As(r[e],n);return r.join(t)})(n,e,t)}),n!==e.speaker&&(e.speaker=o(n))}},Ms={name:"",filename:"",list:"",preview:new Map};let Rs=!1;const Os=async()=>{const e=await er("SCENARIO"),t=e.load;e.load=async function(...e){const n=await t.apply(this,e),r=e[0];if(!r)return n;if(T.dev&&r.includes("/assets/json/")&&tr("STORY","#ad37c2",e,n),r.includes("/produce_events/")||r.includes("/produce_communications/")||r.includes("/produce_communications_promises/")||r.includes("/produce_communication_promise_results/")||r.includes("/support_skills/")||r.includes("/game_event_communications/")||r.includes("/special_communications/")||r.includes("/mypage_communications/")||r.includes("/produce_communication_cheers/")||r.includes("/produce_communication_auditions/")||r.includes("/business_unit_communication/")||r.includes("/produce_communication_televisions/"))try{if(!Array.isArray(n))return n;const e=r.replace(/^\/assets\/json\//,"");let t;if("edit"===T.story&&(((e,t)=>{const n=t.replace(".json",""),r=(e=>{var t;const n=e.match(/\/(\d+)$/);return null!==(t=null==n?void 0:n[1])&&void 0!==t?t:""})(n);let o=Mo.get(r)||n.replace(/\//g,"_");o=o.replace("​","");const a=[];e.forEach(e=>{let t=q(Q(e.text));(null==t?void 0:t.trim())?a.push({id:e.id||"0000000000000",name:e.speaker||"",text:t,trans:""}):e.select&&a.push({id:"select",name:"",text:q(Q(e.select)),trans:""})}),a.push({id:"info",name:t,text:"",trans:""}),a.push({id:"번역자",name:"",text:"",trans:""}),Ms.name=t,Ms.filename=o+".csv",Ms.list=a})(n,e),bs(Ms)),(()=>{if(Rs)return;Rs=!0;const e=sessionStorage.getItem("sczh:preview");if(e)try{const t=JSON.parse(e),n=new Map(t);for(let[e,t]of n)n.set(e,new Map(t));Ms.preview=n}catch(e){Y(e)}})(),t=Ms.preview.has(e)?Ms.preview.get(e):await(async e=>{if(!Lo){let e=await le("story.json");if(e)Lo=new Map(JSON.parse(e));else{const e=await se("/story.json");Lo=new Map(e),de("story.json",JSON.stringify(Lo))}}if(Lo.has(e)){if($o.has(e))return $o.get(e);{const t=Lo.get(e),n=await se(`/data/story/${t}.csv`),r=No(n);return $o.set(e,r),r}}return!1})(e),t){((e,t,n)=>{const r=Z();e.forEach(e=>{if(e.text){const a=r(e.id),s=G(e.text);t.has(s)?e.text=t.get(s):a&&t.has(""+a)?e.text=t.get(""+a):n.has(s)&&(e.text=o(n.get(s)))}if(e.select){const r=G(e.select),a=r+"-select";t.has(a)?e.select=t.get(a):n.has(r)&&(e.select=o(n.get(e.select)))}})})(n,t,await Bo())}else await pa(n,0,!1);for(let e of n)await Cs(e)}catch(e){Y(e)}return n}},Ts=e=>{const t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.setAttribute("as","font"),t.setAttribute("type","font/woff2"),t.setAttribute("crossorigin","anonymous"),document.head.appendChild(t)},Ps=(e,t)=>`/data/font/${e}.woff2?v=${t[`font/${e}.woff2`]}`,Ds=async()=>{const e=document.createElement("style"),{hashes:t}=await ae;e.innerHTML=`\n  @font-face {\n    font-family: "sczh-heiti";\n    src: url("${T.origin}${Ps("heiti",t)}");\n  }\n  @font-face {\n    font-family: "sczh-yuanti";\n    src: url("${T.origin}${Ps("heiti",t)}");\n  }\n  ::-webkit-scrollbar {\n    display: none;\n  }\n  `,"yuanti"===T.font1&&Ts(`${T.origin}${Ps("heiti",t)}`),"heiti"===T.font2&&Ts(`${T.origin}${Ps("heiti",t)}`),document.head.appendChild(e)};window.addEventListener("blur",(function(e){"on"===T.bgm&&e.stopImmediatePropagation()}),!1),document.addEventListener("visibilitychange",(function(e){"on"===T.bgm&&e.stopImmediatePropagation()}));let $s=0;const zs=async()=>{var e;Vn._require||$s>=300?(async()=>{try{await Promise.all([rs(),Ds(),Ua(),Va(),ur(),Os()])}catch(e){Y(e)}})():(await(e=100,new Promise(t=>{setTimeout(t,e)})),$s++,$s%10==0&&Y(`Waiting: ${$s/10}s`),await zs())};"loading"!=document.readyState?zs():window.unsafeWindow?window.unsafeWindow.addEventListener("DOMContentLoaded",zs):window.addEventListener("DOMContentLoaded",zs)}();
