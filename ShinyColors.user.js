// ==UserScript==
// @name         샤니마스 한글 패치 임시
// @namespace    https://github.com/newbiepr/shinycolors-trans-kr
// @version      1.7.3
// @description  샤니마스 임시 한글 패치 스크립트
// @icon         https://shinycolors.enza.fun/icon_192x192.png
// @author       Source : biuuu
// @match        https://shinycolors.enza.fun/*
// @run-at       document-start
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @connect      api.interpreter.caiyunai.com
// @connect      translate.google.cn
// @connect      fanyi.baidu.com
// @updateURL    https://newbiepr.gitlab.io/shinymaskr.gitlab.io/ShinyColors.user.js
// ==/UserScript==
!function(){"use strict";const e=(e,t=!1)=>t&&e.startsWith("​")?e:"​"+e,t=e=>e.startsWith("​")?e.slice(1,e.length):e;var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var o="object"==typeof r&&r&&r.Object===Object&&r,s="object"==typeof self&&self&&self.Object===Object&&self,a=o||s||Function("return this")(),i=a.Symbol,c=Object.prototype,u=c.hasOwnProperty,l=c.toString,d=i?i.toStringTag:void 0;var p=function(e){var t=u.call(e,d),r=e[d];try{e[d]=void 0;var n=!0}catch(e){}var o=l.call(e);return n&&(t?e[d]=r:delete e[d]),o},f=Object.prototype.toString;var h=function(e){return f.call(e)},m=i?i.toStringTag:void 0;var v=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":m&&m in Object(e)?p(e):h(e)},g=Array.isArray;var y=function(e){return null!=e&&"object"==typeof e};var w=function(e){return"string"==typeof e||!g(e)&&y(e)&&"[object String]"==v(e)};var b=function(e){return!0===e||!1===e||y(e)&&"[object Boolean]"==v(e)};var E=function(e,t){return function(r){return e(t(r))}},_=E(Object.getPrototypeOf,Object),S=Function.prototype,k=Object.prototype,I=S.toString,x=k.hasOwnProperty,A=I.call(Object);var j=function(e){if(!y(e)||"[object Object]"!=v(e))return!1;var t=_(e);if(null===t)return!0;var r=x.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&I.call(r)==A};const M={origin:"https://newbiepr.gitlab.io/shinymaskr.gitlab.io",hash:"",localHash:"",version:"1.7.3",story:"normal",timeout:30,font1:"yuanti",font2:"heiti",auto:"off",bgm:"off",dev:!1},C=Object.assign({},M),R=["yuanti","heiti","yuanti2"],P={HEITI_JA:"UDKakugo_SmallPr6-B",HEITI_TRANS:"sczh-heiti,UDKakugo_SmallPr6-B",YUAN_JA:"HummingStd-E",YUAN_TRANS:"sczh-yuanti,HummingStd-E"},O=["origin","font1","font2","timeout","story","auto","bgm","dev"],T=O,D=()=>{P.HEITI_TRANS=`${R.includes(M.font2)?"sczh-":""}${M.font2},${P.HEITI_JA}`,P.YUAN_TRANS=`${R.includes(M.font1)?"sczh-":""}${M.font1},${P.YUAN_JA}`},F=()=>{const e={};T.forEach(t=>{M[t]!==C[t]&&(e[t]=M[t])}),D(),localStorage.setItem("sczh:setting",JSON.stringify(e))},z=()=>{let e=location.hash;e=e.slice(1).replace(/\?tdsourcetag=s_pc(tim|qq)_aiomsg/,""),e.split(";").forEach(e=>{let t=e.split("="),r=decodeURIComponent(t[0].trim()),n=t[1]?decodeURIComponent(t[1].trim()):"";r&&T.includes(r)&&(M[r]=n||C[r],F())})},$={story:{normal:"커뮤추출 열기",edit:"커뮤추출 닫기",id:0,callback:()=>{if("normal"===M.story)M.story="edit";else{const e=document.getElementById("btn-close-sczh");e?e.click():M.story="normal"}}},bgm:{on:"백그라운드BGM 끄기",off:"백그라운드BGM 켜기",id:0,callback:()=>{M.bgm="off"!==M.bgm?"off":"on"}},dev:{id:0,titles:["개발자모드 켜기","개발자모드 끄기"],callback:()=>{M.dev=!M.dev}},wiki:{id:0,title:"샤니위키",callback:()=>{window.open("https://shinycolors.info/wiki")}},update:{id:0,title:"업데이트",callback:()=>{window.open(M.origin+"/ShinyColors.user.js")}}},N=e=>{const t=M[e],r=$[e];let n="";if(b(t)){let e=t?1:0;n=r.titles[e]}else n=r.title||r[t];const o=r.id;o&&window.GM_unregisterMenuCommand(o),r.id=window.GM_registerMenuCommand(n,()=>{(0,r.callback)(),F(),L()})},L=()=>{if(!window.GM_registerMenuCommand||!window.GM_unregisterMenuCommand)return;["update","bgm","story","dev","wiki"].forEach(e=>{N(e)})};(()=>{const e=localStorage.getItem("sczh:setting");let t=JSON.parse(e);j(t)||(t={});const{origin:r}=t;/^https?:\/\//.test(r)&&(M.origin=r.trim()),T.forEach(e=>{let r=t[e];w(r)&&(r=r.trim()),(b(r)||r)&&(M[e]=r)}),D()})(),z(),L(),window.addEventListener("hashchange",z);const B=e=>{if(!e)return"";return e.replace(/[\u0020]+$/g,"").replace(/^[\u0020]+/g,"")},U=(e,t=!1)=>{let r=B(e).replace(/(\\r)?\\n/g,"\n").replace(/\\r/g,"\n");return t?r:r.replace(/\n{2,}/g,"\n")},H=e=>B(e).replace(/\r/g,"\n").replace(/\n{2,}/g,"\n"),J=e=>e.replace(/\?/g,"\\?").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)"),W=(...e)=>{M.dev&&console.info(...e)},q=(...e)=>{console.info(...e)},G=e=>w(e)?e.replace(/\r?\n/g,"\\n").replace(/\r/g,"\\n"):e,K=(e="0.0.0",t="0.0.0")=>{let r=!1;const n=e.split(".").map(e=>parseInt(e,10)),o=t.split(".").map(e=>parseInt(e,10));for(let e=0;e<n.length;e++){(n[e]||0)>(o[e]||0)&&(r=!0)}return r},Y=()=>{const e=new Map;return t=>{if(t&&!/^0+$/.test(t)&&"select"!==t){if(e.has(t)){const r=e.get(t);return e.set(t,r+1),`${t}-${r}`}e.set(t,0)}return t}},Q=new Map,V=(e,t,r=[])=>{if(Q.has(e))return Q.get(e);let n=e;for(let[e,o]of t)n=n.replace(e,(...e)=>{let t=o;for(let n=1;n<e.length-2;n++){let o=e[n],s=!1;r.forEach(e=>{e.has(o)&&(t=t.replace("$"+n,e.get(o)),s=!0)}),s||(t=t.replace("$"+n,e[n]))}return t}),e.lastIndex=0;return Q.set(e,n),n},Z=(t,r,n)=>{if(!t||!w(t[r]))return;const{expMap:o,wordMaps:s,textMap:a}=n,i=H(t[r]);let c=i;i&&((null==a?void 0:a.has(i))?t[r]=e(a.get(i)):(c=V(i,o,s),i!==c&&(t[r]=e(c))))};var X=function(){this.__data__=[],this.size=0};var ee=function(e,t){return e===t||e!=e&&t!=t};var te=function(e,t){for(var r=e.length;r--;)if(ee(e[r][0],t))return r;return-1},re=Array.prototype.splice;var ne=function(e){var t=this.__data__,r=te(t,e);return!(r<0)&&(r==t.length-1?t.pop():re.call(t,r,1),--this.size,!0)};var oe=function(e){var t=this.__data__,r=te(t,e);return r<0?void 0:t[r][1]};var se=function(e){return te(this.__data__,e)>-1};var ae=function(e,t){var r=this.__data__,n=te(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ie.prototype.clear=X,ie.prototype.delete=ne,ie.prototype.get=oe,ie.prototype.has=se,ie.prototype.set=ae;var ce=ie;var ue=function(){this.__data__=new ce,this.size=0};var le=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var de=function(e){return this.__data__.get(e)};var pe=function(e){return this.__data__.has(e)};var fe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var he,me=function(e){if(!fe(e))return!1;var t=v(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},ve=a["__core-js_shared__"],ge=(he=/[^.]+$/.exec(ve&&ve.keys&&ve.keys.IE_PROTO||""))?"Symbol(src)_1."+he:"";var ye=function(e){return!!ge&&ge in e},we=Function.prototype.toString;var be=function(e){if(null!=e){try{return we.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Ee=/^\[object .+?Constructor\]$/,_e=Function.prototype,Se=Object.prototype,ke=_e.toString,Ie=Se.hasOwnProperty,xe=RegExp("^"+ke.call(Ie).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ae=function(e){return!(!fe(e)||ye(e))&&(me(e)?xe:Ee).test(be(e))};var je=function(e,t){return null==e?void 0:e[t]};var Me=function(e,t){var r=je(e,t);return Ae(r)?r:void 0},Ce=Me(a,"Map"),Re=Me(Object,"create");var Pe=function(){this.__data__=Re?Re(null):{},this.size=0};var Oe=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Te=Object.prototype.hasOwnProperty;var De=function(e){var t=this.__data__;if(Re){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Te.call(t,e)?t[e]:void 0},Fe=Object.prototype.hasOwnProperty;var ze=function(e){var t=this.__data__;return Re?void 0!==t[e]:Fe.call(t,e)};var $e=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Re&&void 0===t?"__lodash_hash_undefined__":t,this};function Ne(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ne.prototype.clear=Pe,Ne.prototype.delete=Oe,Ne.prototype.get=De,Ne.prototype.has=ze,Ne.prototype.set=$e;var Le=Ne;var Be=function(){this.size=0,this.__data__={hash:new Le,map:new(Ce||ce),string:new Le}};var Ue=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var He=function(e,t){var r=e.__data__;return Ue(t)?r["string"==typeof t?"string":"hash"]:r.map};var Je=function(e){var t=He(this,e).delete(e);return this.size-=t?1:0,t};var We=function(e){return He(this,e).get(e)};var qe=function(e){return He(this,e).has(e)};var Ge=function(e,t){var r=He(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Ke(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ke.prototype.clear=Be,Ke.prototype.delete=Je,Ke.prototype.get=We,Ke.prototype.has=qe,Ke.prototype.set=Ge;var Ye=Ke;var Qe=function(e,t){var r=this.__data__;if(r instanceof ce){var n=r.__data__;if(!Ce||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ye(n)}return r.set(e,t),this.size=r.size,this};function Ve(e){var t=this.__data__=new ce(e);this.size=t.size}Ve.prototype.clear=ue,Ve.prototype.delete=le,Ve.prototype.get=de,Ve.prototype.has=pe,Ve.prototype.set=Qe;var Ze=Ve;var Xe=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},et=function(){try{var e=Me(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var tt=function(e,t,r){"__proto__"==t&&et?et(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},rt=Object.prototype.hasOwnProperty;var nt=function(e,t,r){var n=e[t];rt.call(e,t)&&ee(n,r)&&(void 0!==r||t in e)||tt(e,t,r)};var ot=function(e,t,r,n){var o=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var i=t[s],c=n?n(r[i],e[i],i,r,e):void 0;void 0===c&&(c=e[i]),o?tt(r,i,c):nt(r,i,c)}return r};var st=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var at=function(e){return y(e)&&"[object Arguments]"==v(e)},it=Object.prototype,ct=it.hasOwnProperty,ut=it.propertyIsEnumerable,lt=at(function(){return arguments}())?at:function(e){return y(e)&&ct.call(e,"callee")&&!ut.call(e,"callee")};var dt=function(){return!1},pt=n((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?a.Buffer:void 0,s=(o?o.isBuffer:void 0)||dt;e.exports=s})),ft=/^(?:0|[1-9]\d*)$/;var ht=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&ft.test(e))&&e>-1&&e%1==0&&e<t};var mt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},vt={};vt["[object Float32Array]"]=vt["[object Float64Array]"]=vt["[object Int8Array]"]=vt["[object Int16Array]"]=vt["[object Int32Array]"]=vt["[object Uint8Array]"]=vt["[object Uint8ClampedArray]"]=vt["[object Uint16Array]"]=vt["[object Uint32Array]"]=!0,vt["[object Arguments]"]=vt["[object Array]"]=vt["[object ArrayBuffer]"]=vt["[object Boolean]"]=vt["[object DataView]"]=vt["[object Date]"]=vt["[object Error]"]=vt["[object Function]"]=vt["[object Map]"]=vt["[object Number]"]=vt["[object Object]"]=vt["[object RegExp]"]=vt["[object Set]"]=vt["[object String]"]=vt["[object WeakMap]"]=!1;var gt=function(e){return y(e)&&mt(e.length)&&!!vt[v(e)]};var yt=function(e){return function(t){return e(t)}},wt=n((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,s=n&&n.exports===r&&o.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=a})),bt=wt&&wt.isTypedArray,Et=bt?yt(bt):gt,_t=Object.prototype.hasOwnProperty;var St=function(e,t){var r=g(e),n=!r&&lt(e),o=!r&&!n&&pt(e),s=!r&&!n&&!o&&Et(e),a=r||n||o||s,i=a?st(e.length,String):[],c=i.length;for(var u in e)!t&&!_t.call(e,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ht(u,c))||i.push(u);return i},kt=Object.prototype;var It=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||kt)},xt=E(Object.keys,Object),At=Object.prototype.hasOwnProperty;var jt=function(e){if(!It(e))return xt(e);var t=[];for(var r in Object(e))At.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Mt=function(e){return null!=e&&mt(e.length)&&!me(e)};var Ct=function(e){return Mt(e)?St(e):jt(e)};var Rt=function(e,t){return e&&ot(t,Ct(t),e)};var Pt=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Ot=Object.prototype.hasOwnProperty;var Tt=function(e){if(!fe(e))return Pt(e);var t=It(e),r=[];for(var n in e)("constructor"!=n||!t&&Ot.call(e,n))&&r.push(n);return r};var Dt=function(e){return Mt(e)?St(e,!0):Tt(e)};var Ft=function(e,t){return e&&ot(t,Dt(t),e)},zt=n((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?a.Buffer:void 0,s=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=s?s(r):new e.constructor(r);return e.copy(n),n}}));var $t=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t};var Nt=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,s=[];++r<n;){var a=e[r];t(a,r,e)&&(s[o++]=a)}return s};var Lt=function(){return[]},Bt=Object.prototype.propertyIsEnumerable,Ut=Object.getOwnPropertySymbols,Ht=Ut?function(e){return null==e?[]:(e=Object(e),Nt(Ut(e),(function(t){return Bt.call(e,t)})))}:Lt;var Jt=function(e,t){return ot(e,Ht(e),t)};var Wt=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},qt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Wt(t,Ht(e)),e=_(e);return t}:Lt;var Gt=function(e,t){return ot(e,qt(e),t)};var Kt=function(e,t,r){var n=t(e);return g(e)?n:Wt(n,r(e))};var Yt=function(e){return Kt(e,Ct,Ht)};var Qt=function(e){return Kt(e,Dt,qt)},Vt=Me(a,"DataView"),Zt=Me(a,"Promise"),Xt=Me(a,"Set"),er=Me(a,"WeakMap"),tr=be(Vt),rr=be(Ce),nr=be(Zt),or=be(Xt),sr=be(er),ar=v;(Vt&&"[object DataView]"!=ar(new Vt(new ArrayBuffer(1)))||Ce&&"[object Map]"!=ar(new Ce)||Zt&&"[object Promise]"!=ar(Zt.resolve())||Xt&&"[object Set]"!=ar(new Xt)||er&&"[object WeakMap]"!=ar(new er))&&(ar=function(e){var t=v(e),r="[object Object]"==t?e.constructor:void 0,n=r?be(r):"";if(n)switch(n){case tr:return"[object DataView]";case rr:return"[object Map]";case nr:return"[object Promise]";case or:return"[object Set]";case sr:return"[object WeakMap]"}return t});var ir=ar,cr=Object.prototype.hasOwnProperty;var ur=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&cr.call(e,"index")&&(r.index=e.index,r.input=e.input),r},lr=a.Uint8Array;var dr=function(e){var t=new e.constructor(e.byteLength);return new lr(t).set(new lr(e)),t};var pr=function(e,t){var r=t?dr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},fr=/\w*$/;var hr=function(e){var t=new e.constructor(e.source,fr.exec(e));return t.lastIndex=e.lastIndex,t},mr=i?i.prototype:void 0,vr=mr?mr.valueOf:void 0;var gr=function(e){return vr?Object(vr.call(e)):{}};var yr=function(e,t){var r=t?dr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var wr=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return dr(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return pr(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return yr(e,r);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return hr(e);case"[object Set]":return new n;case"[object Symbol]":return gr(e)}},br=Object.create,Er=function(){function e(){}return function(t){if(!fe(t))return{};if(br)return br(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();var _r=function(e){return"function"!=typeof e.constructor||It(e)?{}:Er(_(e))};var Sr=function(e){return y(e)&&"[object Map]"==ir(e)},kr=wt&&wt.isMap,Ir=kr?yt(kr):Sr;var xr=function(e){return y(e)&&"[object Set]"==ir(e)},Ar=wt&&wt.isSet,jr=Ar?yt(Ar):xr,Mr={};Mr["[object Arguments]"]=Mr["[object Array]"]=Mr["[object ArrayBuffer]"]=Mr["[object DataView]"]=Mr["[object Boolean]"]=Mr["[object Date]"]=Mr["[object Float32Array]"]=Mr["[object Float64Array]"]=Mr["[object Int8Array]"]=Mr["[object Int16Array]"]=Mr["[object Int32Array]"]=Mr["[object Map]"]=Mr["[object Number]"]=Mr["[object Object]"]=Mr["[object RegExp]"]=Mr["[object Set]"]=Mr["[object String]"]=Mr["[object Symbol]"]=Mr["[object Uint8Array]"]=Mr["[object Uint8ClampedArray]"]=Mr["[object Uint16Array]"]=Mr["[object Uint32Array]"]=!0,Mr["[object Error]"]=Mr["[object Function]"]=Mr["[object WeakMap]"]=!1;var Cr=function e(t,r,n,o,s,a){var i,c=1&r,u=2&r,l=4&r;if(n&&(i=s?n(t,o,s,a):n(t)),void 0!==i)return i;if(!fe(t))return t;var d=g(t);if(d){if(i=ur(t),!c)return $t(t,i)}else{var p=ir(t),f="[object Function]"==p||"[object GeneratorFunction]"==p;if(pt(t))return zt(t,c);if("[object Object]"==p||"[object Arguments]"==p||f&&!s){if(i=u||f?{}:_r(t),!c)return u?Gt(t,Ft(i,t)):Jt(t,Rt(i,t))}else{if(!Mr[p])return s?t:{};i=wr(t,p,c)}}a||(a=new Ze);var h=a.get(t);if(h)return h;a.set(t,i),jr(t)?t.forEach((function(o){i.add(e(o,r,n,o,t,a))})):Ir(t)&&t.forEach((function(o,s){i.set(s,e(o,r,n,s,t,a))}));var m=d?void 0:(l?u?Qt:Yt:u?Dt:Ct)(t);return Xe(m||t,(function(o,s){m&&(o=t[s=o]),nt(i,s,e(o,r,n,s,t,a))})),i};var Rr=function(e){return Cr(e,5)};const{origin:Pr,version:Or}=M,Tr=async()=>{const e=Math.floor(Date.now()/1e3/60/60/6),t=await fetch(`${Pr}/manifest.json?t=${e}`);if(t.ok){const e=await t.json();return e.time=Date.now(),localStorage.setItem("sczh:manifest",JSON.stringify(e)),e}throw new Error(`${t.status} ${t.url}`)},Dr=new Promise((e,t)=>{(async()=>{let e;try{let t=localStorage.getItem("sczh:manifest");t&&(e=JSON.parse(t)),Date.now()-e.time>60*M.cacheTime*1e3&&(e=!1)}catch(e){}return e?K(Or,e.version)?e=await Tr():setTimeout(Tr,5e3):e=await Tr(),e})().then(t=>{M.newVersion=t.version,M.hashes=t.hashes,e(t)}).catch(t)}),Fr=async(e,t)=>{if(!t){const{hashes:r}=await Dr;t=r[e.replace(/^\/(data\/)?/,"")]}return await(async e=>new Promise((t,r)=>{let n=setTimeout(()=>{r(`불러오기${e}시간초과`)},1e3*M.timeout);fetch(`${Pr}${e}`).then(e=>{if(clearTimeout(n),!e.ok)return r(`${e.status} ${e.url}`),"";const t=e.headers.get("content-type");return(null==t?void 0:t.includes("json"))?e.json():e.text()}).then(t).catch(r)}))(`${e}${t?"?v="+t:""}`)};let zr=null;const $r=new Map([["AOBA",e=>e&&e.loaders&&e.Text&&e.BLEND_MODES],["SCENARIO",e=>e&&e.default&&e.default.load&&e.default._errorEvent&&e.default._handleError],["REQUEST",e=>e&&e.get&&e.post&&e.put&&e.patch],["PHRASE",e=>e&&e.default&&e.default._polyglot&&e.default._polyglot.phrases],["SPEAKER",e=>e&&e.default&&e.default.getCharacterBackLogIconId]]),Nr=new Map([["AOBA",e=>e],["SCENARIO",e=>e.default],["REQUEST",e=>e],["PHRASE",e=>e.default._polyglot.phrases],["SPEAKER",e=>e.default]]),Lr=Object.freeze;Object.freeze=new Proxy(Lr,{apply:(e,t,[r])=>r});const Br=/^function\s(\w)\((\w)\){if\((\w)\[\2\]\)return\s\3\[\2\]\.exports;var\s(\w)=\3\[\2\]={\w:\2,(\w):!1,exports:{}};return\s\w\[\2\]\.call\(\4.exports,\4,\4\.exports,\1\),\4\.\5=!0,\4\.exports}$/,Ur=Function.prototype.call;let Hr={Reflect:window.Reflect};Function.prototype.call=new Proxy(Ur,{apply(e,t,r){var n;return(null==r||null===(n=r[3])||void 0===n?void 0:n.toString)&&Br.test(r[3].toString())&&r[3](0).VERSION&&void 0!==r[3](0).VERSION._version&&(zr=r[3],Function.prototype.call=Ur),Hr.Reflect.apply(e,t,r)}});const Jr=async e=>{const{moduleId:t}=await Dr;let[r,n]=((e,t)=>{let r,n,o=((e,t)=>{let r=e+t,n=[];for(let o=e-t;o<=r;o++)o>=0&&o!==e&&n.push(o);return n.unshift(e),n})(e,20);for(let e=0;e<o.length;e++){let s=zr(o[e]);if(t(s)){r=s,n=o[e];break}}return[r,n]})(t[e],$r.get(e));return r?Nr.get(e)(r):null},Wr=(e,t,r,n)=>{if(M.dev){let o=n;n&&(o=Rr(n)),W(`%c${e}%c %c${r[0]}`,...(e=>[`background-color:${e};color:#fff;padding:0 0.3em`,"",`color:${e};text-decoration:underline`])(t),r[1]||"","\n=>",o)}},qr=async(e,t,r)=>{try{for(let[n,o]of r){let r=!1;if(("string"===o.type&&o.key===t||"regexp"===o.type&&o.key.test(t))&&(r=!0),r){const t=o.handles;for(let r of t)await r(e)}}}catch(e){W(e)}},Gr=e=>{const t=e.replace(/{num}/g,"\\d+").replace(/{uuid}/g,"[a-f\\d]{8}-([a-f\\d]{4}-){3}[a-f\\d]{12}");return new RegExp(`^${t}$`)},Kr={get:new Map,post:new Map,patch:new Map,put:new Map},Yr=(e,t,r)=>{if(!r.has(e)){const t=e.includes("{")||e.includes("("),n={handles:[],key:t?Gr(e):e,type:t?"regexp":"string"};r.set(e,n)}const n=r.get(e);Array.isArray(t)?n.handles=n.handles.concat(t):n.handles.push(t)},Qr=(e,t,r)=>{if(Array.isArray(e))for(let n of e)Yr(n,t,r);else Yr(e,t,r)},Vr=e=>(t,r)=>{const n=Kr[e];if(r)Qr(t,r,n);else{const e=t;for(let[t,r]of e)Qr(t,r,n)}},Zr={get:Vr("get"),post:Vr("post"),patch:Vr("patch"),put:Vr("put")};async function Xr(){const e=await Jr("REQUEST"),t=e.get;e.get=async function(...e){const r=e[0],n=await t.apply(this,e);if(!r)return n;let o=n.body;return Wr("GET","#009688",e,o),await qr(o,r,Kr.get),n};const r=e.patch;e.patch=async function(...e){const t=e[0],n=await r.apply(this,e);if(!t)return n;let o=n.body;return Wr("PATCH","#8BC34A",e,o),await qr(o,t,Kr.patch),n};const n=e.post;e.post=async function(...e){const t=e[0],r=await n.apply(this,e);if(!t)return r;let o=r.body;return Wr("POST","#3F51B5",e,o),await qr(o,t,Kr.post),r};const o=e.put;e.put=async function(...e){const t=e[0],r=await o.apply(this,e);if(!t)return r;let n=r.body;return Wr("PUT","#9C27B0",e,n),await qr(n,t,Kr.put),r}}var en=n((function(e,t){e.exports=function e(){var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{},r=!t.document&&!!t.postMessage,n=r&&/blob:/i.test((t.location||{}).protocol),o={},s=0,a={parse:function(r,n){var i=(n=n||{}).dynamicTyping||!1;if(E(i)&&(n.dynamicTypingFunction=i,i={}),n.dynamicTyping=i,n.transform=!!E(n.transform)&&n.transform,n.worker&&a.WORKERS_SUPPORTED){var c=function(){if(!a.WORKERS_SUPPORTED)return!1;var r,n,i=(r=t.URL||t.webkitURL||null,n=e.toString(),a.BLOB_URL||(a.BLOB_URL=r.createObjectURL(new Blob(["(",n,")();"],{type:"text/javascript"})))),c=new t.Worker(i);return c.onmessage=v,c.id=s++,o[c.id]=c}();return c.userStep=n.step,c.userChunk=n.chunk,c.userComplete=n.complete,c.userError=n.error,n.step=E(n.step),n.chunk=E(n.chunk),n.complete=E(n.complete),n.error=E(n.error),delete n.worker,void c.postMessage({input:r,config:n,workerId:c.id})}var f=null;return"string"==typeof r?f=n.download?new u(n):new d(n):!0===r.readable&&E(r.read)&&E(r.on)?f=new p(n):(t.File&&r instanceof File||r instanceof Object)&&(f=new l(n)),f.stream(r)},unparse:function(e,t){var r=!1,n=!0,o=",",s="\r\n",i='"',c=i+i,u=!1,l=null;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||a.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(o=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(u=t.skipEmptyLines),"string"==typeof t.newline&&(s=t.newline),"string"==typeof t.quoteChar&&(i=t.quoteChar),"boolean"==typeof t.header&&(n=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");l=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+i)}}();var d=new RegExp(h(i),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return f(null,e,u);if("object"==typeof e[0])return f(l||p(e[0]),e,u)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:p(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),f(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function p(e){if("object"!=typeof e)return[];var t=[];for(var r in e)t.push(r);return t}function f(e,t,r){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var i=Array.isArray(e)&&0<e.length,c=!Array.isArray(t[0]);if(i&&n){for(var u=0;u<e.length;u++)0<u&&(a+=o),a+=m(e[u],u);0<t.length&&(a+=s)}for(var l=0;l<t.length;l++){var d=i?e.length:t[l].length,p=!1,f=i?0===Object.keys(t[l]).length:0===t[l].length;if(r&&!i&&(p="greedy"===r?""===t[l].join("").trim():1===t[l].length&&0===t[l][0].length),"greedy"===r&&i){for(var h=[],v=0;v<d;v++){var g=c?e[v]:v;h.push(t[l][g])}p=""===h.join("").trim()}if(!p){for(var y=0;y<d;y++){0<y&&!f&&(a+=o);var w=i&&c?e[y]:y;a+=m(t[l][w],y)}l<t.length-1&&(!r||0<d&&!f)&&(a+=s)}}return a}function m(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var n=e.toString().replace(d,c);return"boolean"==typeof r&&r||"function"==typeof r&&r(e,t)||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(-1<e.indexOf(t[r]))return!0;return!1}(n,a.BAD_DELIMITERS)||-1<n.indexOf(o)||" "===n.charAt(0)||" "===n.charAt(n.length-1)?i+n+i:n}}};if(a.RECORD_SEP=String.fromCharCode(30),a.UNIT_SEP=String.fromCharCode(31),a.BYTE_ORDER_MARK="\ufeff",a.BAD_DELIMITERS=["\r","\n",'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!r&&!!t.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=m,a.ParserHandle=f,a.NetworkStreamer=u,a.FileStreamer=l,a.StringStreamer=d,a.ReadableStreamStreamer=p,t.jQuery){var i=t.jQuery;i.fn.parse=function(e){var r=e.config||{},n=[];return this.each((function(e){if("INPUT"!==i(this).prop("tagName").toUpperCase()||"file"!==i(this).attr("type").toLowerCase()||!t.FileReader||!this.files||0===this.files.length)return!0;for(var o=0;o<this.files.length;o++)n.push({file:this.files[o],inputElem:this,instanceConfig:i.extend({},r)})})),o(),this;function o(){if(0!==n.length){var t,r,o,c=n[0];if(E(e.before)){var u=e.before(c.file,c.inputElem);if("object"==typeof u){if("abort"===u.action)return t=c.file,r=c.inputElem,o=u.reason,void(E(e.error)&&e.error({name:"AbortError"},t,r,o));if("skip"===u.action)return void s();"object"==typeof u.config&&(c.instanceConfig=i.extend(c.instanceConfig,u.config))}else if("skip"===u)return void s()}var l=c.instanceConfig.complete;c.instanceConfig.complete=function(e){E(l)&&l(e,c.file,c.inputElem),s()},a.parse(c.file,c.instanceConfig)}else E(e.complete)&&e.complete()}function s(){n.splice(0,1),o()}}}function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=w(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new f(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,r){if(this.isFirstChunk&&E(this._config.beforeFirstChunk)){var o=this._config.beforeFirstChunk(e);void 0!==o&&(e=o)}this.isFirstChunk=!1,this._halted=!1;var s=this._partialLine+e;this._partialLine="";var i=this._handle.parse(s,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var c=i.meta.cursor;this._finished||(this._partialLine=s.substring(c-this._baseIndex),this._baseIndex=c),i&&i.data&&(this._rowCount+=i.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(n)t.postMessage({results:i,workerId:a.WORKER_ID,finished:u});else if(E(this._config.chunk)&&!r){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);i=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!u||!E(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(e){E(this._config.error)?this._config.error(e):n&&this._config.error&&t.postMessage({workerId:a.WORKER_ID,error:e,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),c.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var o=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+o)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var r=t.statusText||e;this._sendError(new Error(r))}}function l(e){var t,r;(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),c.call(this,e);var n="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,n?((t=new FileReader).onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var o=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,o)}var s=t.readAsText(e,this._config.encoding);n||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,r=this._config.chunkSize;return r?(e=t.substring(0,r),t=t.substring(r)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function p(e){c.call(this,e=e||{});var t=[],r=!0,n=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=b((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=b((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=b((function(){this._streamCleanUp(),n=!0,this._streamData("")}),this),this._streamCleanUp=b((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function f(e){var t,r,n,o=Math.pow(2,53),s=-o,i=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)(e[-+]?\d+)?\s*$/,c=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,u=this,l=0,d=0,p=!1,f=!1,v=[],g={data:[],errors:[],meta:{}};if(E(e.step)){var y=e.step;e.step=function(t){if(g=t,S())_();else{if(_(),0===g.data.length)return;l+=t.data.length,e.preview&&l>e.preview?r.abort():(g.data=g.data[0],y(g,u))}}}function b(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function _(){if(g&&n&&(I("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines)for(var t=0;t<g.data.length;t++)b(g.data[t])&&g.data.splice(t--,1);return S()&&function(){if(g)if(Array.isArray(g.data[0])){for(var t=0;S()&&t<g.data.length;t++)g.data[t].forEach(r);g.data.splice(0,1)}else g.data.forEach(r);function r(t){E(e.transformHeader)&&(t=e.transformHeader(t)),v.push(t)}}(),function(){if(!g||!e.header&&!e.dynamicTyping&&!e.transform)return g;function t(t,r){var n,o=e.header?{}:[];for(n=0;n<t.length;n++){var s=n,a=t[n];e.header&&(s=n>=v.length?"__parsed_extra":v[n]),e.transform&&(a=e.transform(a,s)),a=k(s,a),"__parsed_extra"===s?(o[s]=o[s]||[],o[s].push(a)):o[s]=a}return e.header&&(n>v.length?I("FieldMismatch","TooManyFields","Too many fields: expected "+v.length+" fields but parsed "+n,d+r):n<v.length&&I("FieldMismatch","TooFewFields","Too few fields: expected "+v.length+" fields but parsed "+n,d+r)),o}var r=1;return!g.data.length||Array.isArray(g.data[0])?(g.data=g.data.map(t),r=g.data.length):g.data=t(g.data,0),e.header&&g.meta&&(g.meta.fields=v),d+=r,g}()}function S(){return e.header&&0===v.length}function k(t,r){return n=t,e.dynamicTypingFunction&&void 0===e.dynamicTyping[n]&&(e.dynamicTyping[n]=e.dynamicTypingFunction(n)),!0===(e.dynamicTyping[n]||e.dynamicTyping)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(function(e){if(i.test(e)){var t=parseFloat(e);if(s<t&&t<o)return!0}return!1}(r)?parseFloat(r):c.test(r)?new Date(r):""===r?null:r):r;var n}function I(e,t,r,n){var o={type:e,code:t,message:r};void 0!==n&&(o.row=n),g.errors.push(o)}this.parse=function(o,s,i){var c=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substring(0,1048576);var r=new RegExp(h(t)+"([^]*?)"+h(t),"gm"),n=(e=e.replace(r,"")).split("\r"),o=e.split("\n"),s=1<o.length&&o[0].length<n[0].length;if(1===n.length||s)return"\n";for(var a=0,i=0;i<n.length;i++)"\n"===n[i][0]&&a++;return a>=n.length/2?"\r\n":"\r"}(o,c)),n=!1,e.delimiter)E(e.delimiter)&&(e.delimiter=e.delimiter(o),g.meta.delimiter=e.delimiter);else{var u=function(t,r,n,o,s){var i,c,u,l;s=s||[",","\t","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var d=0;d<s.length;d++){var p=s[d],f=0,h=0,v=0;u=void 0;for(var g=new m({comments:o,delimiter:p,newline:r,preview:10}).parse(t),y=0;y<g.data.length;y++)if(n&&b(g.data[y]))v++;else{var w=g.data[y].length;h+=w,void 0!==u?0<w&&(f+=Math.abs(w-u),u=w):u=w}0<g.data.length&&(h/=g.data.length-v),(void 0===c||f<=c)&&(void 0===l||l<h)&&1.99<h&&(c=f,i=p,l=h)}return{successful:!!(e.delimiter=i),bestDelimiter:i}}(o,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);u.successful?e.delimiter=u.bestDelimiter:(n=!0,e.delimiter=a.DefaultDelimiter),g.meta.delimiter=e.delimiter}var l=w(e);return e.preview&&e.header&&l.preview++,t=o,r=new m(l),g=r.parse(t,s,i),_(),p?{meta:{paused:!0}}:g||{meta:{paused:!1}}},this.paused=function(){return p},this.pause=function(){p=!0,r.abort(),t=E(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){u.streamer._halted?(p=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return f},this.abort=function(){f=!0,r.abort(),g.meta.aborted=!0,E(e.complete)&&e.complete(g),t=""}}function h(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t,r=(e=e||{}).delimiter,n=e.newline,o=e.comments,s=e.step,i=e.preview,c=e.fastMode,u=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(u=e.escapeChar),("string"!=typeof r||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=","),o===r)throw new Error("Comment character same as delimiter");!0===o?o="#":("string"!=typeof o||-1<a.BAD_DELIMITERS.indexOf(o))&&(o=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var l=0,d=!1;this.parse=function(e,a,p){if("string"!=typeof e)throw new Error("Input must be a string");var f=e.length,m=r.length,v=n.length,g=o.length,y=E(s),w=[],b=[],_=[],S=l=0;if(!e)return z();if(c||!1!==c&&-1===e.indexOf(t)){for(var k=e.split(n),I=0;I<k.length;I++){if(_=k[I],l+=_.length,I!==k.length-1)l+=n.length;else if(p)return z();if(!o||_.substring(0,g)!==o){if(y){if(w=[],O(_.split(r)),$(),d)return z()}else O(_.split(r));if(i&&i<=I)return w=w.slice(0,i),z(!0)}}return z()}for(var x=e.indexOf(r,l),A=e.indexOf(n,l),j=new RegExp(h(u)+h(t),"g"),M=e.indexOf(t,l);;)if(e[l]!==t)if(o&&0===_.length&&e.substring(l,l+g)===o){if(-1===A)return z();l=A+v,A=e.indexOf(n,l),x=e.indexOf(r,l)}else{if(-1!==x&&(x<A||-1===A)){if(!(x<M)){_.push(e.substring(l,x)),l=x+m,x=e.indexOf(r,l);continue}var C=N(x,M,A);if(C&&void 0!==C.nextDelim){x=C.nextDelim,M=C.quoteSearch,_.push(e.substring(l,x)),l=x+m,x=e.indexOf(r,l);continue}}if(-1===A)break;if(_.push(e.substring(l,A)),F(A+v),y&&($(),d))return z();if(i&&w.length>=i)return z(!0)}else for(M=l,l++;;){if(-1===(M=e.indexOf(t,M+1)))return p||b.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:w.length,index:l}),D();if(M===f-1)return D(e.substring(l,M).replace(j,t));if(t!==u||e[M+1]!==u){if(t===u||0===M||e[M-1]!==u){-1!==x&&x<M+1&&(x=e.indexOf(r,M+1)),-1!==A&&A<M+1&&(A=e.indexOf(n,M+1));var R=T(-1===A?x:Math.min(x,A));if(e[M+1+R]===r){_.push(e.substring(l,M).replace(j,t)),e[l=M+1+R+m]!==t&&(M=e.indexOf(t,l)),x=e.indexOf(r,l),A=e.indexOf(n,l);break}var P=T(A);if(e.substring(M+1+P,M+1+P+v)===n){if(_.push(e.substring(l,M).replace(j,t)),F(M+1+P+v),x=e.indexOf(r,l),M=e.indexOf(t,l),y&&($(),d))return z();if(i&&w.length>=i)return z(!0);break}b.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:w.length,index:l}),M++}}else M++}return D();function O(e){w.push(e),S=l}function T(t){var r=0;if(-1!==t){var n=e.substring(M+1,t);n&&""===n.trim()&&(r=n.length)}return r}function D(t){return p||(void 0===t&&(t=e.substring(l)),_.push(t),l=f,O(_),y&&$()),z()}function F(t){l=t,O(_),_=[],A=e.indexOf(n,l)}function z(e){return{data:w,errors:b,meta:{delimiter:r,linebreak:n,aborted:d,truncated:!!e,cursor:S+(a||0)}}}function $(){s(z()),w=[],b=[]}function N(n,o,s){var a={nextDelim:void 0,quoteSearch:void 0},i=e.indexOf(t,o+1);if(o<n&&n<i&&(i<s||-1===s)){var c=e.indexOf(r,i);if(-1===c)return a;i<c&&(i=e.indexOf(t,i+1)),a=N(c,i,s)}else a={nextDelim:n,quoteSearch:o};return a}},this.abort=function(){d=!0},this.getCharIndex=function(){return l}}function v(e){var t=e.data,r=o[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){n=!0,g(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(E(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},s),!n);a++);delete t.results}else E(r.userChunk)&&(r.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!n&&g(t.workerId,t.results)}function g(e,t){var r=o[e];E(r.userComplete)&&r.userComplete(t),r.terminate(),delete o[e]}function y(){throw new Error("Not implemented.")}function w(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=w(e[r]);return t}function b(e,t){return function(){e.apply(t,arguments)}}function E(e){return"function"==typeof e}return n&&(t.onmessage=function(e){var r=e.data;if(void 0===a.WORKER_ID&&r&&(a.WORKER_ID=r.workerId),"string"==typeof r.input)t.postMessage({workerId:a.WORKER_ID,results:a.parse(r.input,r.config),finished:!0});else if(t.File&&r.input instanceof File||r.input instanceof Object){var n=a.parse(r.input,r.config);n&&t.postMessage({workerId:a.WORKER_ID,results:n,finished:!0})}}),(u.prototype=Object.create(c.prototype)).constructor=u,(l.prototype=Object.create(c.prototype)).constructor=l,(d.prototype=Object.create(d.prototype)).constructor=d,(p.prototype=Object.create(c.prototype)).constructor=p,a}()}));const tn=e=>{try{return en.parse(e.replace(/^\ufeff/,""),{header:!0}).data}catch(e){return console.log(e),{}}},rn=(e,t="EMPTY")=>e.sort((e,r)=>{let n=e,o=r;return"EMPTY"!==t&&(n=e[t],o=r[t]),o||(o=""),n||(n=""),o.length>n.length?1:n.length>o.length?-1:0});let nn=null;const on=async e=>{if(!nn)try{const e=localStorage.getItem("sczh:data");if(!e)return!1;nn=JSON.parse(e)}catch(e){return console.error(e),!1}if(K(M.version,nn.version))return nn=null,localStorage.removeItem("sczh:data"),!1;let t=e;/(\.csv|\.json)/.test(e)||(t=e+".csv");const{hashes:r}=await Dr,n=r[t],o=nn.hashes[t];return o&&o===n?nn[e]:(nn.hashes[t]=n,!1)},sn=(e,t)=>{nn&&nn.hashes||(nn={hashes:M.hashes,version:M.version});let r=e;/(\.csv|\.json)/.test(e)||(r=e+".csv");const n=M.hashes[r];n&&(nn.hashes[r]=n),nn[e]=t;const o=JSON.stringify(nn);try{localStorage.setItem("sczh:data",o)}catch(e){console.error(e)}},an=new Map,cn=async(e,t)=>{const r=t||e;if(an.has(e))return an.get(e);let n=await on(e);n||(n=await Fr(`/data/${r}.csv`),sn(e,n));const o=tn(n);return an.set(e,o),o},un=e=>{const t=new Map;let r=!1;const{name:n,path:o}=e,s=e.keys||{},a=s.text||"text",i=s.trans||"trans";return async()=>{if(!r){const s=await cn(n,o);e.sort&&rn(s,e.sort),s.forEach(e=>{const r=U(e[a]),n=U(e[i],!0);r&&n&&t.set(r,n)}),r=!0}return t}},ln=(e,t=[])=>{let r=e.replace(/\./g,"\\.").replace(/\$num/g,"([+-＋－]?[0-9０-９①-─]{1,10}\\.?[0-9０-９①-─]{0,4}?)").replace(/\$percent/g,"([+-＋－]?[0-9０-９]{1,10}\\.?[0-9０-９]{0,4}?[%％])").replace(/\$unknown/g,"(.*?)").replace(/\$uk/g,"(.*?)").replace(/\$sep/g,".?");return t.forEach(e=>{r=r.replace(e.re,e.exp),e.re.lastIndex=0}),new RegExp(r,"gi")},dn=un({name:"name",keys:{text:"name"}}),pn=un({name:"idol-name",path:"etc/idol-name",keys:{text:"name"}}),fn=async(e=!0)=>{const t=await pn(),r=new Map;for(let[n,o]of t){const t=n.split(" "),s=o.split(" ");e&&r.set(t[1],s[1]),r.set(t.join(""),s.join(" ")),r.set(n,s[1])}return r};let hn=null;const mn=async()=>{if(hn)return hn;const e=await dn(),t=await fn();return hn=new Map([...e,...t]),hn},vn=t=>{let r=null;const n=((e,...t)=>{let r=null,n=null;return async()=>(n||(n=e(...t)),r||(r=await n),r)})((e=>{const t={expMap:new Map,textMap:new Map,nounMap:new Map,nameMap:new Map,otherMap:new Map,nounArr:[],nameArr:[],otherArr:[],loaded:!1};return async()=>{let{expMap:r,nounMap:n,textMap:o,nameMap:s,otherMap:a,nounArr:i,nameArr:c,otherArr:u,loaded:l}=t;if(!l){const l=await cn(e),d=await fn();c=[...d.keys()];const p=new Map;rn(l,"text").forEach(e=>{if(null==e?void 0:e.text){const t=U(e.text),r=U(e.trans,!0),l=B(e.type);t&&r&&("noun"===l?(i.push(J(t)),n.set(t,r)):"text"===l?o.set(t,r):"name"===l?(c.push(J(t)),s.set(t,r)):"other"===l?(u.push(J(t)),a.set(t,r)):p.set(t.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),r))}}),t.nameMap=new Map([...s,...d]),s=t.nameMap,t.textMap=new Map([...o,...s,n,a]),o=t.textMap;const f=[{re:/\$noun/g,exp:`(${i.join("|")})`},{re:/\$name/g,exp:`(${c.join("|")})`},{re:/\$other/g,exp:`(${u.join("|")})`}];for(let[e,t]of p){const n=ln(e,f);r.set(n,t)}t.loaded=!0}return{expMap:r,wordMaps:[n,a,s],textMap:o}}})(t)),o=e=>async t=>{r||(r=await n()),e(t)},s=e=>e.map(e=>{const t=e[1];return Array.isArray(t)?e[1]=t.map(e=>o(e)):e[1]=o(t),e}),a=(e,t)=>{if(!t){let t=[];return e.forEach((r,n)=>{let o=r.match(/([＋+]+)$/);(null==o?void 0:o[1])?(t.push(o[1]),e[n]=r.replace(/[＋+]+$/,"")):t.push("")}),t}e.forEach((r,n)=>{e[n]=r+t[n]})};return{api:{get(e){Zr.get(s(e))},post(e){Zr.post(s(e))},put(e){Zr.put(s(e))},patch(e){Zr.patch(s(e))}},transItem:(t,n,o=r)=>{if(null==t?void 0:t[n]){let r=t[n].split("/");r.forEach((e,t)=>{let n=a(r);Z(r,t,o),a(r,n)});let s=r.join("/");s!==t[n]&&(t[n]=e(s,!0))}}}},{api:gn,transItem:yn}=vn("skill"),wn=e=>{var t,r;e&&(null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{yn(e,"effectName"),yn(e,"effectDescription")}),null===(r=e.rivalMemoryAppealEffects)||void 0===r||r.forEach(e=>{yn(e,"effectName"),yn(e,"effectDescription")}))},bn=(e,t=!1)=>{e&&(yn(e,"comment"),yn(e,"name"),t&&wn(e),e.linkSkill&&(yn(e.linkSkill,"comment"),yn(e.linkSkill,"name"),t&&wn(e.linkSkill)))},En=e=>{e&&e.forEach(e=>{yn(e,"releaseConditions"),yn(e.passiveSkills,"comment"),yn(e.passiveSkills,"name"),bn(e.skill),bn(e.concertActiveSkill),e.activeSkills&&e.activeSkills.forEach(e=>{bn(e)})})},_n=e=>{e.forEach(e=>{bn(e)})},Sn=(e,t=!1)=>{var r,n,o;let s=e.userProduceIdol;s&&(null===(r=s.activeSkills)||void 0===r||r.forEach(e=>{bn(e)}),null===(n=s.passiveSkills)||void 0===n||n.forEach(e=>{bn(e)}),null===(o=s.limitBreaks)||void 0===o||o.forEach(e=>{bn(e)}),t&&En(s.skillPanels))},kn=e=>{e.forEach(e=>{bn(e.skill,!0)})},In=e=>{e&&e.forEach(e=>{var t,r,n;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{wn(e)})}),null===(r=e.userRaidDeck)||void 0===r||r.userRaidDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{bn(e,!0)})}),null===(n=e.rival)||void 0===n||n.rivalSkills.forEach(e=>{wn(e)})})},xn=e=>{En(e.idol.skillPanels),_n(e.idol.memoryAppeals)},An=e=>{var t,r,n;En(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(r=t.supportIdolActiveSkill)||void 0===r||null===(n=r.activeSkills)||void 0===n||n.forEach(e=>{yn(e,"comment"),yn(e,"name")})},jn=e=>{const t=e.userFesIdol;t.activeSkills.forEach(e=>{bn(e)}),bn(t.memoryAppeal),t.passiveSkills.forEach(e=>{yn(e,"comment"),yn(e,"name")})},Mn=jn,Cn=e=>{var t,r,n,o;e.userProduceSupportIdols.forEach(e=>{En(e.skillPanels)}),Sn(e,!0),null===(t=e.userProduceLimitedSkills)||void 0===t||t.forEach(e=>{bn(e.passiveSkills),bn(e.skill)}),En(null===(r=e.userProduceIdol)||void 0===r||null===(n=r.userIdol)||void 0===n||null===(o=n.idol)||void 0===o?void 0:o.skillPanels)},Rn=e=>{var t;e.userFesIdol&&(e.userFesIdol.activeSkills.forEach(e=>{bn(e,!0)}),bn(e.userFesIdol.memoryAppeal,!0),null===(t=e.userFesIdol.passiveSkills)||void 0===t||t.forEach(e=>{yn(e,"comment"),yn(e,"name"),wn(e)}))},Pn=e=>{var t,r;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(Rn),null===(r=e.userRaidDeck)||void 0===r||r.userRaidDeckMembers.forEach(Rn),kn(e.judges),In(e.userFesRivals),In(e.userFesRaidRivals),wn(e.feverActiveSkill)},On=e=>{var t;null===(t=e.fanActiveSkills)||void 0===t||t.forEach(e=>{bn(e,!0)}),e.userProduceSupportIdols.forEach(e=>{bn(e.activeSkill,!0)});let r=e.userProduceIdol;r.activeSkills.forEach(e=>{bn(e,!0)}),bn(r.memoryAppeal,!0),r.passiveSkills.forEach(e=>{bn(e,!0)});let n=e.produceAudition||e.produceConcert;kn(n.judges),(e=>{e.forEach(e=>{wn(e.rivalMemoryAppeal),e.rivalSkills.forEach(e=>{wn(e)})})})(n.rivals),wn(e.feverActiveSkill)},Tn=e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?On(t):(t.userFesDeck||t.userRaidDeck)&&Pn(t),e.gameData=JSON.stringify(t)}catch(e){log(e)}},Dn=e=>{e.userProduceIdol.activeSkills.forEach(e=>{bn(e)})},Fn=e=>{var t,r,n;null===(t=e.userProduceReporterEvent)||void 0===t||null===(r=t.produceReporterEventResult)||void 0===r||null===(n=r.produceReporterEventSkills)||void 0===n||n.forEach(e=>{yn(e,"name")})};gn.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[An]],["userProduce(Teaching)?SupportIdols/{num}",[e=>{var t,r,n,o;En(e.skillPanels),null===(t=e.userSupportIdol)||void 0===t||null===(r=t.supportIdol)||void 0===r||null===(n=r.supportIdolActiveSkill)||void 0===n||null===(o=n.activeSkills)||void 0===o||o.forEach(e=>{yn(e,"comment"),yn(e,"name")})}]],["userReserveSupportIdols/userSupportIdol/{num}",[e=>{var t,r,n;En(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(r=t.supportIdolActiveSkill)||void 0===r||null===(n=r.activeSkills)||void 0===n||n.forEach(e=>{yn(e,"comment"),yn(e,"name")})}]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[xn]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],e=>{e.activeSkills.forEach(e=>{bn(e)}),_n(e.userIdol.idol.memoryAppeals)}],["userReserveIdols/userIdol/{num}",e=>{En(e.idol.skillPanels),_n(e.idol.memoryAppeals)}],["userFesIdols/{num}",jn],[["userProduces/skillPanels","userProduceTeachings/skillPanels"],Cn],["userDecks/skillPanels",e=>{var t,r,n;e.userSupportIdols.forEach(e=>{En(e.skillPanels)}),En(null===(t=e.userIdol)||void 0===t?void 0:t.skillPanels),En(null===(r=e.userIdol)||void 0===r||null===(n=r.idol)||void 0===n?void 0:n.skillPanels)}],["fes(Match)?Concert/actions/resume",[Tn]],["earthUsers/{uuid}/userFesIdols/{num}",Mn],["userRaidDecks",e=>{e.userRaidDecks.forEach(e=>{e.userRaidDeckMembers.forEach(e=>{var t;null===(t=e.userFesIdol)||void 0===t||t.activeSkills.forEach(e=>{bn(e)})})})}],["userProduceAbilities",Dn],["userProduces",[Fn]]]),gn.post([["userIdols/{num}/produceExSkills/{num}/actions/set",xn],[["userProduce(Teaching)?s/skillPanels/{num}","userProduces/limitedSkills/{num}"],Cn],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[An]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[e=>{e.gameData||Sn(e)},Tn]],[["produces/actions/resume","produces/actions/next"],[Fn]],["fes(Match|Raid)?Concert/actions/start",[Pn]],["fes(Match)?Concert/actions/resume",[Tn]],["fesRaidConcert/actions/resume",[e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.userRaidDeck&&Pn(t),e.gameState.game_data=JSON.stringify(t)}catch(e){log(e)}}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[On]],["userProduceAbilities",Dn]]),gn.patch([["userFesDecks",e=>{e.userFesDecks.forEach(e=>{e.userFesDeckMembers.forEach(Rn)})}]]);const{api:zn,transItem:$n}=vn("etc/ex-skill"),Nn=e=>{$n(e,"name"),$n(e,"description")},Ln=e=>{e.userIdolProduceExSkills.forEach(e=>{Nn(e.produceExSkill)})},Bn=e=>{var t;null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Nn(e.produceExSkill)})},Un=e=>{const t=e.userFesIdol;t.userFesIdolProduceExSkills.forEach(e=>{Nn(e.produceExSkill)}),t.userFesSupportIdols.forEach(e=>{e.userFesSupportIdolProduceExSkills.forEach(e=>{Nn(e.produceExSkill)})})},Hn=Un;zn.get([[["userIdols/produceExSkillTop","userSupportIdols/produceExSkillTop","userIdols/{num}/produceExSkillTop","userSupportIdols/{num}/produceExSkillTop"],e=>{var t,r,n,o,s,a;null===(t=e.userIdols)||void 0===t||t.forEach(e=>{var t;null===(t=e.userIdolProduceExSkills)||void 0===t||t.forEach(e=>{Nn(e.produceExSkill)})}),null===(r=e.userSupportIdols)||void 0===r||r.forEach(e=>{var t;null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Nn(e.produceExSkill)})}),null===(n=e.userIdol)||void 0===n||null===(o=n.userIdolProduceExSkills)||void 0===o||o.forEach(e=>{Nn(e.produceExSkill)}),null===(s=e.userSupportIdol)||void 0===s||null===(a=s.userSupportIdolProduceExSkills)||void 0===a||a.forEach(e=>{Nn(e.produceExSkill)}),e.userProduceExSkills.forEach(e=>{var t;Nn(e.produceExSkill),Nn(null===(t=e.produceExSkillUpgrade)||void 0===t?void 0:t.produceExSkill)})}],[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[Bn]],["userProduce(Teaching)?SupportIdols/{num}",[e=>{var t;null===(t=e.userProduceSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Nn(e.produceExSkill)})}]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[Ln]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],e=>{e.userProduceIdolProduceExSkills.forEach(e=>{Nn(e.produceExSkill)})}],["userFesIdols/{num}",Un],["earthUsers/{uuid}/userFesIdols/{num}",Hn]]),zn.post([["userIdols/{num}/produceExSkills/{num}/actions/set",Ln],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Bn]],["produces/actions/result",[e=>{e.produceExSkillRewards.forEach(e=>{Nn(e.produceExSkill)})}]],["business/actions/finish",e=>{e.slots.forEach(e=>{e.businessProduceExSkillRewards.forEach(e=>{Nn(e.produceExSkill)})})}],["userProduceExSkills/actions/upgrade",e=>{Nn(e.produceExSkill)}]]);const{api:Jn,transItem:Wn}=vn("support-skill"),qn=e=>{null==e||e.forEach(e=>{Wn(e,"description"),Wn(e,"name")})},Gn=e=>{var t,r;const n=null!==(t=e.userSupportIdol)&&void 0!==t?t:e;qn(n.acquiredSupportSkills),qn(n.supportSkills),qn(null===(r=n.supportIdol)||void 0===r?void 0:r.supportSkills)};Jn.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[Gn]],["userProduce(Teaching)?SupportIdols/{num}",[Gn]],["userReserveSupportIdols/userSupportIdol/{num}",[Gn]],["produces/{num}/decks",e=>{var t;null===(t=e.userSupportIdols)||void 0===t||t.forEach(e=>{var t;qn(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills)})}]]),Jn.post([["produces/{num}/actions/ready",[e=>{e.userDecks.forEach(e=>{e.userSupportIdols.forEach(e=>{var t;qn(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills)})})}]],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Gn]],["produces/actions/(resume|next)",[Gn]],[["produceTeachings/resume","produceTeachings/next"],Gn]]),Jn.patch([["userSupportIdols/{num}",Gn],["produces/{num}/produceItem/consume",e=>{qn(e.supportSkills)}]]);const{api:Kn,transItem:Yn}=vn("etc/idea-note"),Qn=e=>{var t;e&&(Yn(e,"title"),(e=>{Yn(e,"title"),Yn(e,"comment")})(e.produceIdeaNoteCompleteBonus),null===(t=e.produceIdeaNoteExtraBonuses)||void 0===t||t.forEach(e=>{Yn(e,"comment"),Yn(e,"condition")}))},Vn=e=>{var t,r;null===(t=e.ideaNoteResult)||void 0===t||null===(r=t.seasonClearBonusIdeaNotes)||void 0===r||r.forEach(e=>{Qn(e)})};Kn.get([["userProduceIdeaNotes",e=>{e.forEach(e=>{Qn(e.produceIdeaNote)})}]]),Kn.post([["produces/actions/(resume|next)",[e=>{var t;null===(t=e.userProduceIdeaNotes)||void 0===t||t.forEach(e=>{Qn(e.produceIdeaNote)})},Vn]],["produces/actions/act",[e=>{var t,r,n;null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{var t;null===(t=e.produceIdeaNotes)||void 0===t||t.forEach(e=>{Qn(e)})});let o=null===(r=e.lessonResult)||void 0===r||null===(n=r.userProduceIdeaNote)||void 0===n?void 0:n.produceIdeaNote;Qn(o)}]],["produces/actions/endWeek",Vn]]),Kn.patch([["userProduceIdeaNotes/228681479/actions/select",e=>{Qn(e.userProduceIdeaNote.produceIdeaNote)}]]);const{api:Zn,transItem:Xn}=vn("etc/grad-skill"),eo=e=>{var t;e&&(Xn(e,"comment"),Xn(e,"name"),Xn(e,"acquireComment"),Xn(e,"releaseComment"),null===(t=e.produceAbilityAcquireConditionComments)||void 0===t||t.forEach(e=>{Xn(e,"name")}))},to=e=>{e.userFesIdol.abilities.forEach(e=>{eo(e)})},ro=to,no=e=>{var t,r;const n=e=>{e.userFesIdol.abilities.forEach(e=>{eo(e)}),e.userFesIdol.concertAbilities.forEach(e=>{eo(e)})};null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(n),null===(r=e.userRaidDeck)||void 0===r||r.userRaidDeckMembers.forEach(n)},oo=e=>{var t,r;const n=e.userProduceIdol;n&&(null===(t=n.abilities)||void 0===t||t.forEach(e=>{eo(e)}),null===(r=n.concertAbilities)||void 0===r||r.forEach(e=>{eo(e)}))},so=e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?oo(t):(t.userFesDeck||t.userRaidDeck)&&no(t),e.gameData=JSON.stringify(t)}catch(e){log(e)}},ao=e=>{e.userProduceIdol.abilities.forEach(e=>{eo(e)}),e.userProduceAbilities.forEach(e=>{eo(e.ability)})};Zn.get([["userFesIdols/{num}",to],["fes(Match)?Concert/actions/resume",[so]],["earthUsers/{uuid}/userFesIdols/{num}",ro],["userProduceAbilities",ao],[["userProduceAreas"],e=>{var t;null===(t=e.abilities)||void 0===t||t.forEach(e=>{eo(e)})}]]),Zn.post([[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[e=>{e.gameData||((e,t=!1)=>{var r;let n=e.userProduceIdol;n&&(null===(r=n.abilities)||void 0===r||r.forEach(e=>{eo(e)}))})(e)},so]],["fes(Match|Raid)?Concert/actions/start",[no]],["fes(Match)?Concert/actions/resume",[so]],["fesRaidConcert/actions/resume",[e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.userRaidDeck&&no(t),e.gameState.game_data=JSON.stringify(t)}catch(e){log(e)}}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[oo]],["produces/({num}/audition|concert)/actions/(start|finish)",e=>{var t,r;null===(t=e.concertEvent)||void 0===t||null===(r=t.abilities)||void 0===r||r.forEach(e=>{Xn(e,"name")})}],["userProduceAbilities",ao]]);const{api:io,transItem:co}=vn("etc/landing-point"),uo=e=>{e&&(co(e,"comment"),co(e,"name"),co(e,"acquireComment"),co(e,"releaseComment"))},lo=e=>{co(e,"title"),e.produceMusicAssignmentClearBonuses.forEach(e=>{co(e,"title")})},po=e=>{var t,r;co(e.feverActiveSkill,"comment"),e.produceMusicProficiencyBonuses.forEach(e=>{var t;co(e,"description"),e.ability&&(uo(e.ability),null===(t=e.ability.produceAbilityAcquireConditionComments)||void 0===t||t.forEach(e=>{co(e,"name")}))}),null===(t=e.produceMusicAssignments)||void 0===t||t.forEach(lo),null===(r=e.produceMusicProficiencyJudgeStarBonuses)||void 0===r||r.forEach(e=>{co(e,"description")})},fo=e=>{var t,r,n;po(e.produceMusic),null===(t=e.userProduceMusicAssignments)||void 0===t||t.forEach(e=>{lo(e.produceMusicAssignment)}),null===(r=e.allUserProduceMusicAssignments)||void 0===r||r.forEach(e=>{lo(e.produceMusicAssignment)}),null===(n=e.judgeStarBonuses)||void 0===n||n.forEach(e=>{co(e,"description")})},ho=e=>{var t,r;null===(t=e.userProduceMusicProficiencies)||void 0===t||t.forEach(fo),null===(r=e.activatedProduceMusicAssignmentBonuses)||void 0===r||r.forEach(e=>{var t;null===(t=e.produceMusicAssignmentClearBonuses)||void 0===t||t.forEach(e=>{co(e,"title")})})},mo=e=>{var t;uo(e),null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{co(e,"effectDescription"),co(e,"effectName")})},vo=e=>{var t,r,n,o;null===(t=e.produceMusic)||void 0===t||null===(r=t.judgeStarBonuses)||void 0===r||r.forEach(e=>{co(e,"description")}),null===(n=e.userProduceIdol)||void 0===n||null===(o=n.abilities)||void 0===o||o.forEach(mo),co(e.feverActiveSkill,"comment")};io.get([[["userProduceAreas","produceMusics"],e=>{var t;null===(t=e.produceMusics)||void 0===t||t.forEach(po)}],["userProduces",[ho]],["userFesIdols/{num}",e=>{var t,r;null===(t=e.userFesIdol)||void 0===t||null===(r=t.abilities)||void 0===r||r.forEach(mo)}]]),io.post([[["produces/actions/resume","produces/actions/next"],[ho]],["produces/actions/resume",e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?vo(t):t.userFesDeck||t.userRaidDeck,e.gameData=JSON.stringify(t)}catch(e){log(e)}}],["userProduceMusicProficiencies",e=>{fo(e.userProduceMusicProficiency)}],["produces/concert/actions/start",vo]]),io.patch([["userProduceMusicAssignments/{num}",e=>{lo(e.produceMusicAssignment)}]]);const go=new Map,yo=new Map,wo=new Map;let bo=!1;const Eo=async()=>{if(!bo){(await cn("item")).forEach(e=>{if(null==e?void 0:e.text){const t=U(e.text),r=U(e.trans,!0),n=B(e.type)||"normal";t&&r&&t!==r&&("limit"===n?yo.set(t,r):"note"===n?wo.set(t,r):go.set(t,r))}}),bo=!0}return{itemMap:go,itemLimitMap:yo,itemNoteMap:wo}};let _o=new Map,So=new Map,ko=new Map,Io=new Map,xo=new Map,Ao=!1;const jo=["produceItem","recoveryItem","exchangeItem","lotteryTicket","evolutionItem","gashaTicket","scoutTicket","enhancementItem"];let Mo,Co;const Ro=async()=>{Co||(Co=Eo()),Mo||(Mo=await Co)};let Po=[];(window.unsafeWindow||window).printUnknowItems=()=>W(Po.join("\n"));const Oo=(t,r)=>{if(!t||"string"!=typeof t[r])return;const{itemMap:n,itemLimitMap:o,itemNoteMap:s}=Mo;let a=H(t[r]),i="",c="",u="";if(/[\s\S]+[\r\n]{0,2}\[[^\]]+\]$/.test(a)){let e=a.match(/([\s\S]+)([\r\n]{0,2}\[[^\]]+\])$/);a=e[1].trim();let t=e[2];i=o.has(t)?o.get(t):t}if(/[\s\S]+[\r\n]{0,2}【Exp:\d+】$/.test(a)){let e=a.match(/([\s\S]+)([\r\n]{0,2}【Exp:\d+】)$/);a=e[1].trim(),u=e[2]}if(/[\s\S]+[\r\n]{0,2}[(（][^)）]+[）)]$/.test(a)){let e=a.match(/([\s\S]+)([\r\n]{0,2})[(（]([^)）]+)[）)]$/);a=e[1].trim();let t=e[3];c=s.has(t)?`${e[2]}（${s.get(t)}）`:e[2]+"（txt）"}if(n.has(a)){let o=n.get(a);o=`${o}${c}${u}${i}`,t[r]=e(o)}else M.dev&&(e=>{if(!e)return;let t=G(e);Po.includes(t)||Po.push(t)})(t[r])},To=e=>{var t;null==e||null===(t=e.shopMerchandises)||void 0===t||t.forEach(e=>{Oo(e,"title"),Oo(e,"shopTitle"),Oo(e,"comment")})},Do=async e=>{let t=e;e.userProduceItems&&(t=e.userProduceItems),await Ro(),Array.isArray(t)&&t.forEach(e=>{const t=e[jo[0]]||e[jo[1]]||e[jo[2]]||e[jo[3]]||e[jo[4]]||e[jo[5]]||e[jo[6]]||e[jo[7]];Oo(t,"name"),Oo(t,"comment")})},Fo=async e=>{await Ro(),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{e.gameEventAccumulatedPresent.rewards.forEach(e=>{Oo(e.content,"name")})})},zo=async e=>{var t;await Ro(),null==e||null===(t=e.activeProduceItems)||void 0===t||t.forEach(e=>{Oo(e.produceItem,"name"),Oo(e.produceItem,"comment")})};Zr.get([[["userShops","userIdolPieceShops"],async e=>{await Ro(),e&&(Array.isArray(e.userShops)&&e.userShops.forEach(e=>{To(e)}),Array.isArray(e.userEventShops)&&e.userEventShops.forEach(e=>{To(e.userShop)}))}],[["userRecoveryItems","userProduceItems","userExchangeItems","userLotteryTickets","userEvolutionItems","userGashaTickets","userScoutTickets","userEnhancementItems"],Do],[["userPresents\\?limit={num}","userPresentHistories\\?limit={num}"],async e=>{await Ro(),Array.isArray(e)&&e.forEach(e=>{Oo(e.content,"name"),Oo(e,"note")})}],["userProduces",zo],["missionEvents/{num}/top",Fo]]),Zr.post([["myPage",async e=>{await zo(e.userProduce)}],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",Fo],["userShops/actions/purchase",async e=>{await Ro(),Oo(null==e?void 0:e.shopMerchandise,"title"),Oo(null==e?void 0:e.shopMerchandise,"comment")}],["produces/{num}/actions/ready",Do],["userPresents/{num}/actions/receive",async e=>{await Ro(),Oo(e.receivedPresent,"Name")}],["userMissions/{num}/actions/receive",async e=>{await Ro(),Oo(e.userMission.mission.missionReward.content,"name")}],["userLoginBonuses",async e=>{await Ro(),e.userLoginBonuses.forEach(e=>{e.loginBonus.sheets.forEach(e=>{e.rewards.forEach(e=>{Oo(e.content,"name")})})}),e.userTotalBonuses.forEach(e=>{e.rewards.forEach(e=>{Oo(e.content,"name")})})}],["fesTop",async e=>{await Ro(),e.lastRankingResult&&Array.isArray(e.lastRankingResult.fesMatchGradeRewards)&&e.lastRankingResult.fesMatchGradeRewards.forEach(e=>{Oo(e.content,"name")})}],["userSelectLoginBonuses/{num}",async e=>{await Ro(),e.rewards.forEach(e=>{Oo(e.content,"name")})}]]),Zr.patch("produces/{num}/produceItem/consume",async e=>{var t;await Ro();const r=null===(t=e.consumeProduceItem)||void 0===t?void 0:t.produceItem;r&&(Oo(r,"name"),Oo(r,"comment"))});let $o=null,No=null;const Lo=async()=>{No||(No=(async(e=!1)=>{if(!Ao){const e=await cn("mission-re"),t=await fn(!1),r=[],n=[...t.keys()],o=[],s=new Map;rn(e,"text").forEach(e=>{if(null==e?void 0:e.text){const t=U(e.text),a=U(e.trans,!0),i=B(e.type);t&&a&&("noun"===i?(r.push(J(t)),ko.set(t,a)):"note"===i?(o.push(J(t)),xo.set(t,a),s.set(`【${t}】`,`【${a}】`)):"name"===i?(n.push(J(t)),Io.set(t,a)):"exp"===i&&s.set(t,a),"exp"!==i&&_o.set(t,a))}}),Io=new Map([...Io,...t]);const a=[{re:/\$name/g,exp:`(${n.join("|")})`},{re:/\$noun/g,exp:`(${r.join("|")})`},{re:/\$note/g,exp:`(${o.join("|")})`}];for(let[e,t]of s){const r=ln(e,a);So.set(r,t)}Ao=!0}const t=[ko,xo,Io];let{itemMap:r}=await Eo();return _o=new Map([...r,..._o]),{expMap:So,wordMaps:t,textMap:_o}})()),await Ro(),$o=await No},Bo=(t,r)=>{let n=!1;if(!t||"string"!=typeof t[r])return n;const{expMap:o,wordMaps:s,textMap:a}=$o,i=H(t[r]);let c=i;return i?(a.has(i)?(n=!0,t[r]=e(a.get(i))):(c=V(i,o,s),i!==c?(n=!0,t[r]=e(c)):M.dev&&Go(t,r)),n):n},Uo=(e,t)=>{Bo(e,t)||Oo(e,t)},Ho=e=>{null==e||e.forEach(e=>{Bo(e.mission,"title"),Bo(e.mission,"comment"),e.mission.missionReward.content&&(Uo(e.mission.missionReward.content,"name"),Uo(e.mission.missionReward.content,"comment"))})},Jo=e=>{e.forEach(e=>{let t=e.fesRaidAccumulatedReward;Bo(t,"title"),Bo(t,"comment");let r=t.fesRaidAccumulatedRewardContent;(null==r?void 0:r.content)&&(Uo(r.content,"name"),Uo(r.content,"comment"))})},Wo=(e,t=!0)=>{null==e||e.forEach(e=>{let r=e.mission||e;if(Bo(r,"title"),Bo(r,"comment"),Bo(r,"afterAchievedComment"),Bo(r,"beforeAchievedComment"),t){let e=r.lectureMissionReward;(null==e?void 0:e.content)&&(Uo(e.content,"name"),Uo(e.content,"comment"))}})},qo=[],Go=(e,t)=>{if(!e[t])return;const r=G(e[t]);qo.includes(r)||qo.push(r)};(window.unsafeWindow||window).printUnknownMission=()=>W(qo.join("\n"));const Ko=async e=>{var t,r;await Lo(),Bo(null===(t=e.userRecommendedMission)||void 0===t?void 0:t.mission,"comment"),Bo(null===(r=e.userRecommendedMission)||void 0===r?void 0:r.mission,"title"),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{Bo(e.gameEventAccumulatedPresent,"comment"),Bo(e.gameEventAccumulatedPresent,"title")})},Yo=async e=>{var t;await Lo(),null===(t=e.teachingHints)||void 0===t||t.forEach(e=>{var t,r;null===(t=e.userProduceHints)||void 0===t||t.forEach(e=>{Bo(e.produceTeachingHint,"title")}),null===(r=e.userProduceTeachingHints)||void 0===r||r.forEach(e=>{Bo(e.produceTeachingHint,"title")})})},Qo=async e=>{await Lo(),Wo(e.lectureMissions)},Vo=e=>{var t;null===(t=e.userIdolRoad)||void 0===t||t.idolRoad.idolRoadRewards.forEach(e=>{Uo(e.content,"name"),Uo(e.content,"comment")})};Zr.get([["userMissions",async e=>{var t;await Lo(),Ho(e.dailyUserMissions),Ho(e.weeklyUserMissions),null===(t=e.eventUserMissions)||void 0===t||t.forEach(e=>{Ho(null==e?void 0:e.userMissions)}),Ho(e.normalUserMissions),Ho(e.specialUserMissions)}],["fesRaidEvents/{num}/rewards",async e=>{await Lo(),Jo(e.fesRaidBestScoreRewards),Jo(e.fesRaidLapRewards),Jo(e.fesRaidPointRewards)}],[["userProduces","userProduceTeachings"],[Yo]],["userBeginnerMissions/top",Qo],["idolRoads/top",async e=>{var t;await Lo(),Wo(e.userMissions,!1),null===(t=e.userIdols)||void 0===t||t.forEach(Vo)}],["missionEvents/{num}/top",[Ko]]]),Zr.post([["myPage",[async e=>{await Lo(),Ho(e.reportUserMissions)},async e=>{await Lo();let t=e.beginnerMission;t&&(t.clearedLectureMission&&Wo([t.clearedLectureMission]),t.progressLectureMission&&Wo([t.progressLectureMission]))}]],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",[Ko]],[["produceTeachings/resume","produceTeachings/next"],Yo],["userLectureMissions/{num}/actions/receive",Qo]]),Zr.put("userIdolRoads",async e=>{await Lo(),Vo(e.userIdol)});const Zo=new Map,Xo=new Map,es=new Map;let ts=!1;let rs,ns,os,ss;const as=async()=>{os||(os=(async()=>{if(!ts){(await cn("title")).forEach(e=>{if(null==e?void 0:e.text){const t=U(e.text),r=U(e.trans,!0),n=B(e.type)||"text";t&&r&&t!==r&&("exp"===n?Xo.set(t,r):"text"===n&&Zo.set(t,r))}});for(let[e,t]of Xo){const r=ln(e);es.set(r,t)}ts=!0}return{textMap:Zo,expMap:es}})(),ss=mn()),rs&&ns||(rs=await os,ns=await ss,rs.wordMaps=[ns])};let is=[];(window.unsafeWindow||window).printUnknowTitles=()=>W(is.join("\n"));const cs=new Map,us=(e,t)=>{e&&w(t)&&(cs.has(e)||cs.set(e,t))},ls=(t={},r)=>{let n=t[r];Z(t,r,rs),n!==t[r]?t[r]=e(t[r],!0):M.dev&&(e=>{if(!e)return;let t=G(e);is.includes(t)||is.push(t)})(n)},ds=e=>{e.forEach(e=>{ls(e,"name"),e.communications.forEach(e=>{ls(e,"name"),ls(e,"title"),us(e.id,`${e.name}-${e.title}`)})})};Zr.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],async e=>{await as(),e.supportIdol.produceSupportIdolEvents.forEach(e=>{ls(e,"title"),us(e.id,e.title)})}],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],async e=>{await as(),e.idol.produceAfterEvents.forEach(e=>{ls(e,"title"),us(e.id,e.title)}),e.idol.produceIdolEvents.forEach(e=>{ls(e,"title"),us(e.id,e.title)})}],[["characterAlbums","album/top"],async e=>{await as(),ds(e.gameEvents),ds(e.specialEvents)}]]),Zr.post([["characterAlbums/characters/{num}",async e=>{await as(),e.albumCommunicationTitles.forEach(e=>{ls(e,"title")}),e.communications.forEach(e=>{ls(e,"title"),us(e.communicationId,e.title)}),e.voices.forEach(e=>{ls(e,"title"),ls(e,"releasedConditionComment")})}],["produceMarathons/{num}/top",async e=>{await as(),e.releasedCommunications.forEach(e=>{ls(e,"name"),ls(e,"title"),us(e.id,`${e.name}-${e.title}`)}),ls(e.gameEvent,"name")}]]);const ps=async t=>{const r=await mn();if(t.userProduceIdol){const n=t.userProduceIdol.userIdol.idol.character;r.has(n.name)&&(n.name=e(r.get(n.name))),r.has(n.firstName)&&(n.firstName=e(r.get(n.firstName)))}},fs=async e=>{var t;await as(),null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{ls(e,"title"),us(e.id,e.title)})};Zr.post([["myPage",async e=>{var t;await as(),ls(null==e||null===(t=e.userProduce)||void 0===t?void 0:t.produce,"title")}],["produces/actions/(resume|next)",[fs,ps]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],fs],["produces/actions/act",fs],["produces/({num}/audition|concert)/actions/(start|finish)",ps]]);un({name:"noun-fix",path:"etc/noun-fix",keys:{trans:"fixed"},sort:"text"}),un({name:"caiyun-prefix",path:"etc/caiyun-prefix",keys:{trans:"fixed"},sort:"text"});const hs=new Map,ms=new Map;let vs=!1,gs=null;const ys=t=>{const r=tn(t),n=new Map,o=Y();return r.forEach(t=>{const r=o(B(t.id)),s=U(t.text),a=U(t.trans,!0),i=B(t.name);s&&a&&(r&&!/^0+$/.test(r)&&"select"!==r?n.set(r,e(a)):"select"===r?n.set(s+"-select",e(a)):n.set(s,e(a))),r&&i&&"info"===r&&n.set("name",i)}),n},ws=async()=>{if(!vs){(await cn("comm-story")).forEach(e=>{if(null==e?void 0:e.text){const t=U(e.text),r=U(e.trans,!0);t&&r&&t!==r&&ms.set(t,r)}}),vs=!0}return ms};let bs=null,Es=!1;const _s=un({name:"type-text"}),Ss=async()=>{if(!Es){bs=await _s();const e=await ws();bs=new Map([...e,...bs]),Es=!0}return bs};var ks=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},Is=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},xs=function(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])},As=function(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},js=function(e,t){return[e[0]^t[0],e[1]^t[1]]},Ms=function(e){return e=js(e,[0,e[0]>>>1]),e=Is(e,[4283543511,3981806797]),e=js(e,[0,e[0]>>>1]),e=Is(e,[3301882366,444984403]),e=js(e,[0,e[0]>>>1])};let Cs="";const Rs=()=>{let e="0123456789abcdefghijklmnopqrstuvwxyz",t="";for(let r=0;r<33;r++)t+=e[Math.floor(Math.random()*e.length)];Cs=function(e,t){t=t||0;for(var r=(e=e||"").length%16,n=e.length-r,o=[0,t],s=[0,t],a=[0,0],i=[0,0],c=[2277735313,289559509],u=[1291169091,658871167],l=0;l<n;l+=16)a=[255&e.charCodeAt(l+4)|(255&e.charCodeAt(l+5))<<8|(255&e.charCodeAt(l+6))<<16|(255&e.charCodeAt(l+7))<<24,255&e.charCodeAt(l)|(255&e.charCodeAt(l+1))<<8|(255&e.charCodeAt(l+2))<<16|(255&e.charCodeAt(l+3))<<24],i=[255&e.charCodeAt(l+12)|(255&e.charCodeAt(l+13))<<8|(255&e.charCodeAt(l+14))<<16|(255&e.charCodeAt(l+15))<<24,255&e.charCodeAt(l+8)|(255&e.charCodeAt(l+9))<<8|(255&e.charCodeAt(l+10))<<16|(255&e.charCodeAt(l+11))<<24],a=Is(a,c),a=xs(a,31),a=Is(a,u),o=js(o,a),o=xs(o,27),o=ks(o,s),o=ks(Is(o,[0,5]),[0,1390208809]),i=Is(i,u),i=xs(i,33),i=Is(i,c),s=js(s,i),s=xs(s,31),s=ks(s,o),s=ks(Is(s,[0,5]),[0,944331445]);switch(a=[0,0],i=[0,0],r){case 15:i=js(i,As([0,e.charCodeAt(l+14)],48));case 14:i=js(i,As([0,e.charCodeAt(l+13)],40));case 13:i=js(i,As([0,e.charCodeAt(l+12)],32));case 12:i=js(i,As([0,e.charCodeAt(l+11)],24));case 11:i=js(i,As([0,e.charCodeAt(l+10)],16));case 10:i=js(i,As([0,e.charCodeAt(l+9)],8));case 9:i=js(i,[0,e.charCodeAt(l+8)]),i=Is(i,u),i=xs(i,33),i=Is(i,c),s=js(s,i);case 8:a=js(a,As([0,e.charCodeAt(l+7)],56));case 7:a=js(a,As([0,e.charCodeAt(l+6)],48));case 6:a=js(a,As([0,e.charCodeAt(l+5)],40));case 5:a=js(a,As([0,e.charCodeAt(l+4)],32));case 4:a=js(a,As([0,e.charCodeAt(l+3)],24));case 3:a=js(a,As([0,e.charCodeAt(l+2)],16));case 2:a=js(a,As([0,e.charCodeAt(l+1)],8));case 1:a=js(a,[0,e.charCodeAt(l)]),a=Is(a,c),a=xs(a,31),a=Is(a,u),o=js(o,a)}return o=js(o,[0,e.length]),s=js(s,[0,e.length]),o=ks(o,s),s=ks(s,o),o=Ms(o),s=Ms(s),o=ks(o,s),s=ks(s,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)}(t,31),localStorage.setItem("sczh:bid",Cs)};try{Cs=localStorage.getItem("sczh:bid")}catch(e){}Cs||Rs();var Ps=Object.prototype.hasOwnProperty,Os=Array.isArray,Ts=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),Ds=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},Fs={arrayToObject:Ds,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],s=o.obj[o.prop],a=Object.keys(s),i=0;i<a.length;++i){var c=a[i],u=s[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:s,prop:c}),r.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(Os(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r){if(0===e.length)return e;var n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var o="",s=0;s<n.length;++s){var a=n.charCodeAt(s);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?o+=n.charAt(s):a<128?o+=Ts[a]:a<2048?o+=Ts[192|a>>6]+Ts[128|63&a]:a<55296||a>=57344?o+=Ts[224|a>>12]+Ts[128|a>>6&63]+Ts[128|63&a]:(s+=1,a=65536+((1023&a)<<10|1023&n.charCodeAt(s)),o+=Ts[240|a>>18]+Ts[128|a>>12&63]+Ts[128|a>>6&63]+Ts[128|63&a])}return o},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(Os(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!Ps.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return Os(t)&&!Os(r)&&(o=Ds(t,n)),Os(t)&&Os(r)?(r.forEach((function(r,o){if(Ps.call(t,o)){var s=t[o];s&&"object"==typeof s&&r&&"object"==typeof r?t[o]=e(s,r,n):t.push(r)}else t[o]=r})),t):Object.keys(r).reduce((function(t,o){var s=r[o];return Ps.call(t,o)?t[o]=e(t[o],s,n):t[o]=s,t}),o)}},zs=String.prototype.replace,$s=/%20/g,Ns={RFC1738:"RFC1738",RFC3986:"RFC3986"},Ls=Fs.assign({default:Ns.RFC3986,formatters:{RFC1738:function(e){return zs.call(e,$s,"+")},RFC3986:function(e){return String(e)}}},Ns),Bs=(Date.prototype.toISOString,Ls.default);Ls.formatters[Bs];const Us=async e=>{const t={text:e};try{const e="https://hooks.sla"+"ck.com/services/TN6J76CUB/BNJ2"+"YLNR3/baGxj31D5YxNhL2Q9FcbzaTA";await((e,t)=>{const{method:r="GET",headers:n,data:o}=t;return fetch(e,{body:o,headers:n,method:r,mode:"cors",referrer:"no-referrer"}).then(e=>e.json())})(e,{data:JSON.stringify(t),method:"POST",headers:{accept:"*/*",referer:"https://hooks.slack.com",origin:"https://hooks.slack.com"}});return""}catch(e){return""}},Hs=["text","select","comment","title","actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment","characterComment","producerComment","comment1","comment2"];let Js=!1;const Ws=async(t,r,n)=>{if(!t.length)return;const o=await Ss(),{textInfo:s,textList:a}=((t,r)=>{const n=[],o=[];return t.forEach((t,s)=>{Hs.forEach(a=>{let i=H(t[a]);t[a]&&(r.has(i)?t[a]=e(r.get(i)):(n.push({key:a,index:s}),o.push(i)))})}),{textInfo:n,textList:o}})(t,o);if(s.length&&"……"!=a&&1!=Js&&"…………"!=a&&"………………\n……………………\n…………………………"!=a&&!(s.length>9))if(n){let e=[];a.forEach((t,r)=>{e.push(G(t))});const t=e.join("\n"),r=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,n=[];["…………","……","………………\n……………………\n…………………………"].forEach(e=>{n.push(G(e))}),r.test(t)||n.includes(e[0])||await Us(t),Js=!0}else{let e=[];a.forEach((t,r)=>{e.push("commstory"+G(t))});const t=e.join("\n"),r=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,n=[];["…………","……","………………\n……………………\n…………………………"].forEach(e=>{n.push(G(e))}),r.test(t)||n.includes(e[0])||await Us(t),Js=!0}},qs=async(e,t="comment")=>{if(!e)return;e.map(e=>e[t]).join("").trim();await Ws(e,0,!0)},Gs=["actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment"],Ks=async e=>{try{if(e.produceAudition){e.produceAudition.judges.map(e=>Gs.map(t=>e[t]||"").join("")).join("").trim();await Ws(e.produceAudition.judges,0,!0)}if(e.produceConcert){e.produceConcert.judges.map(e=>Gs.map(t=>e[t]||"").join("")).join("").trim();await Ws(e.produceConcert.judges,0,!0)}e.produceConcertFanSkillComments&&await qs(e.produceConcertFanSkillComments,"comment1")}catch(e){W(e)}},Ys=async e=>{if(e.judges){e.judges.map(e=>Gs.map(t=>e[t]||"").join("")).join("").trim();await Ws(e.judges,0,!0)}},Qs=async e=>{if(e.topCharacterReaction)try{const t=[...e.topCharacterReaction.moveReactions,...e.topCharacterReaction.skillReleasedReactions,...e.topCharacterReaction.touchExReactions,...e.topCharacterReaction.touchReactions,...e.topCharacterReaction.waitReactions];await qs(t)}catch(e){W(e)}},Vs=async e=>{let t=[...e.produceStaffComments||[],...e.produceStaffConcertComments||[],...e.produceStaffFailComments||[],...e.produceStaffSeasonComments||[]];await qs(t)},Zs=async e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.judges?await Ys(t):await Ks(t),e.gameData=JSON.stringify(t)}catch(e){W(e)}},Xs=async e=>{if(!e.characterComment)return;let t=[];t=t.concat(e.characterComment),await qs(t)};Zr.get([["userProduces",Qs],["fes(Match)?Concert/actions/resume",Zs]]),Zr.post([["myPage",async e=>{try{let t=[];e.userHomeDeck.userHomeDeckAnimationMember&&(t=[...e.userHomeDeck.userHomeDeckAnimationMember.mypageComments]);let r=e.userHomeDeck.userHomeAnimationDeck.userHomeAnimationDeckMembers;r&&r.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)}),e.mypageConversations.forEach(e=>{e.mypageConversationComments.forEach(e=>{t.push(e)})})}),e.userHomeDeck.userHomeDeckMembers.length&&e.userHomeDeck.userHomeDeckMembers.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)})}),await qs(t)}catch(e){W(e)}}],["fesTop",async e=>{if(e.userFesDeck)try{let t=[],r=e.userFesDeck.userFesDeckMembers;for(let e of r)e.fesTopCharacterReactions.forEach(e=>{t.push(e)});await qs(t)}catch(e){W(e)}}],["produces/actions/(resume|next)",[Qs,Vs,Zs,Xs,Ks,async e=>{try{var t;await qs(null===(t=e.produceReporterEvent)||void 0===t?void 0:t.produceReporterEventAnswers,"comment2")}catch(e){W(e)}}]],["produces/actions/endWeek",Vs],["produces/actions/act",async e=>{if(!e.lessonResult)return;let t=e.lessonResult;try{let e=[];t.produceActCutinComment&&(e=e.concat(t.produceActCutinComment)),t.produceRestBoostIdolComment&&(e=e.concat(t.produceRestBoostIdolComment)),t.produceRestBoostSupportIdolComment&&(e=e.concat(t.produceRestBoostSupportIdolComment)),t.produceRestComments&&(e=e.concat(t.produceRestComments)),await qs(e)}catch(e){W(e)}}],["fes(Match|Raid)?Concert/actions/start",Ys],["fes(Match)?Concert/actions/resume",Zs],["fesRaidConcert/actions/resume",async e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.judges&&await Ys(t),e.gameState.game_data=JSON.stringify(t)}catch(e){W(e)}}],["produces/actions/result",async e=>{try{let t=e.characterTrustLevelUpComments;await qs(t)}catch(e){W(e)}}],["produces/({num}/audition|concert)/actions/(start|finish)",[Ks,Xs]],["userProduceHelperSupportIdols",async e=>{try{e.characterComment,e.producerComment;await Ws([e],0,!0)}catch(e){W(e)}}]]);Zr.get("gashas/{num}/redraws",async e=>{const t=[];e.forEach(e=>{e.comment&&t.push(e.comment)}),await qs(t)}),Zr.post([["characterAlbums/characters/{num}",async e=>{const t=[];e.produceIdols.forEach(e=>{e.comment&&t.push(e.comment)}),await qs(t)}],["gashas/{num}/actions/draw",async e=>{var t;const r=[];null===(t=e.gashaDraws)||void 0===t||t.forEach(e=>{e.comment&&r.push(e.comment)}),await qs(r)}]]);const ea=new Map;let ta=!1;let ra=null;const na=async()=>(ra||(ra=(async()=>{if(!ta){let e=await on("profile");e||(e=await Fr("/data/profile.csv"),sn("profile",e));tn(e).forEach(e=>{const t=B(e.name);t&&ea.set(t,e)}),ta=!0}return ea})()),await ra),oa=(e,t,r)=>{"unit_name"==t&&r[t]?e.unit.name=r[t]:r[t]&&(e[t]=r[t])},sa=(e,t)=>{oa(e,"arm",t),oa(e,"birthDay",t),oa(e,"characterVoice",t),oa(e,"firstName",t),oa(e,"hobby",t),oa(e,"nameKana",t),oa(e,"place",t),oa(e,"arm",t),oa(e,"specialty",t),oa(e,"starSign",t),oa(e,"unit_name",t)},aa=async e=>{const t=await na();if(e.name){const r=t.get(e.name);sa(e,r)}e.beginnerMissionUnits&&e.beginnerMissionUnits.forEach(e=>{e.idols.forEach(e=>{const r=t.get(e.idol.character.name);sa(e.idol.character,r)})}),e.units&&e.units.forEach(e=>{e.idols.forEach(e=>{const r=t.get(e.character.name);sa(e.character,r)})})},ia=new Map;let ca=!1;const ua=new Map;let la=!1;let da;const pa=async()=>(da||(da=(async()=>{if(!ca){let e=await on("cardname");e||(e=await Fr("/data/cardname.csv"),sn("cardname",e));tn(e).forEach(e=>{const t=B(e.name),r=B(e.trans);t&&r&&t!==r&&ia.set(t,r)}),ca=!0}return ia})()),await da);let fa=[];const ha=e=>{if(!e)return;let t=G(e);fa.includes(t)||fa.push(t)};(window.unsafeWindow||window).printUnknowCardnames=()=>W(fa.join("\n"));const ma=(t,r)=>{if(!t||!r||!t.name)return;let n=H(t.name);r.has(t.name)&&(t.name=e(r.get(t.name))),M.dev&&n===t.name&&ha(n)},va=async e=>{const t=await pa();e.idol&&ma(e.idol,t),e.supportIdol&&ma(e.supportIdol,t),e.userSupportIdol&&ma(e.userSupportIdol.supportIdol,t),e.userProduceSupportIdols&&e.userProduceSupportIdols.forEach((function(e){ma(e.userSupportIdol.supportIdol,t)})),e.userIdol&&ma(e.userIdol.idol,t),e.userProduceIdol&&ma(e.userProduceIdol.userIdol.idol,t),e.userProduce&&e.userProduce.userProduceIdol&&ma(e.userProduce.userProduceIdol.userIdol.idol,t),e.userFesIdol&&ma(e.userFesIdol.idol,t)},ga=async t=>{const r=await pa(),n=await(async()=>{if(!la){let e=await on("costumename");e||(e=await Fr("/data/costumename.csv"),sn("costumename",e));tn(e).forEach(e=>{const t=U(e.name),r=U(e.trans);t&&r&&t!==r&&ua.set(t,r)}),la=!0}return ua})(),o=new Map([...r,...n]);t.idolCostumes&&t.idolCostumes.forEach((function(t){ma(t,o),((t,r)=>{if(!t||!r||!t.comment)return;let n=H(t.comment);r.has(t.comment)&&(t.comment=e(r.get(t.comment))),M.dev&&n===t.comment&&ha(n)})(t,o)})),t.userFesDecks&&t.userFesDecks.forEach((function(e){e.userFesDeckMembers.forEach((function(e){e.idolCostumes.forEach((function(e){ma(e,o)}))}))}))};Zr.get([["userBeginnerMissions/top",[aa]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],va],[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],va],["userProduce(Teaching)?SupportIdols/{num}",va],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],va],["userFesIdols/{num}",va],["userProduces",va],["userReserveIdols/userIdol/{num}",va],["userReserveSupportIdols/userSupportIdol/{num}",va],["tutorialIdols",aa]]),Zr.post([[["myPage","produces/actions/(resume|next)"],va]]),Zr.post("characterAlbums/characters/{num}",[async e=>{if(e.voices){const t=[];e.voices.forEach(e=>{e.characterTrustLevelComment&&t.push(e.characterTrustLevelComment)}),await qs(t)}},aa,ga]),Zr.patch([["userFesDecks",ga]]),Zr.put([["userHomeDecks",ga]]);const ya=new Map;let wa=!1;let ba=null;async function Ea(){const t=await Jr("PHRASE");if(t){ba=await(async(t=!1)=>{if(!wa){(await cn("phrase")).forEach(r=>{if(null==r?void 0:r.id){const n=U(r.id),o=U(r.trans,!0);n&&(t?ya.set(n,r.trans):o&&ya.set(n,e(o)))}}),wa=!0}return ya})();for(let[e,r]of ba)t[e]=r}}let _a=!1,Sa=null;const ka=un({name:"common"});let Ia=new Map,xa=new Map;const Aa=[],ja=e=>{e&&e.fontFamily&&(e.fontFamily===P.HEITI_JA?Reflect.set(e,"fontFamily",P.HEITI_TRANS):e.fontFamily===P.YUAN_JA&&Reflect.set(e,"fontFamily",P.YUAN_TRANS))},Ma=(e,t,r)=>{let n=e,o=H(e);return t.has(o)?(n="​"+t.get(o),ja(r)):e.startsWith("​")||(e=>{e&&e.fontFamily&&(e.fontFamily===P.HEITI_TRANS?Reflect.set(e,"fontFamily",P.HEITI_JA):e.fontFamily===P.YUAN_TRANS&&Reflect.set(e,"fontFamily",P.YUAN_JA))})(r),n},Ca=(e,t,r=!1)=>{if(!w(e))return e;let n=e;return e.startsWith("​")?ja(t):e.trim()&&(r?(n=Ma(e,xa,t),n===e&&(e=>{Aa.push(e),M.dev,setTimeout(()=>Aa.shift(),1e4)})(e)):(e=>{let t=!1;return Aa.forEach(r=>{r.startsWith(e)&&(t=!0)}),t})(e)||e.startsWith("‌")||(n=Ma(e,Ia,t))),n};async function Ra(){const e=await Jr("AOBA");try{Ia=await(async()=>{if(!_a){Sa=await ka();const{itemMap:e}=await Eo(),t=await mn();Sa=new Map([...e,...t,...Sa]),_a=!0}return Sa})(),xa=await Ss()}catch(e){}const t=e.Text.prototype.typeText;e.Text.prototype.typeText=function(...e){const r=e[0];return e[0]=Ca(r,this.style,!0),t.apply(this,e)};const r=e.Text.prototype.updateText;e.Text.prototype.updateText=function(e){if(this.localStyleID!==this._style.styleID&&(this.dirty=!0,this._style.styleID),this.dirty||!e){M.dev,0;const t=Ca(this._text,this._style);return Reflect.set(this,"_text",t),r.call(this,e)}}}const Pa=new Map;let Oa=!1;let Ta=null;let Da=null;const Fa=()=>Da||(Da=(async()=>{if(Ta)return Ta;try{const e=await fetch("https://newbiepr.gitlab.io/shinymaskr.gitlab.io/data/image/comics/4ko.json?t="+Math.floor(Date.now()/36e5)),t=await e.json();Ta=new Map(t)}catch(e){Ta=new Map}return Ta})(),Da);Zr.get([[["comics"],async t=>{await Fa(),t.comics.forEach(t=>{const r=parseInt(t.id);if(Ta.has(r)){const n=Ta.get(r).title;n&&(t.title=e(n))}})}]]);let za=null;const $a=async()=>(za||(za=(async()=>{if(!Oa){(await cn("image")).forEach(e=>{if(null==e?void 0:e.name){const t=B(e.name),r=B(e.url),n=B(e.version)||"1";t&&r&&Pa.set(t,{url:r,version:n})}}),Oa=!0}return Pa})()),await za);let Na="";(()=>{try{Na=sessionStorage.getItem("sczh:res-name")}catch(e){}})();(window.unsafeWindow||window).queryImageName=e=>{try{sessionStorage.setItem("sczh:res-name",e)}catch(e){}};let La=!1;async function Ba(){const e=await Jr("AOBA");if(La)return;const t=e.loaders.Resource.prototype._loadElement,r=async function(e){M.dev&&"image"===e&&Na&&this.url.includes(Na)&&(q("%c조회한 이미지：","color:#66ccff"),q(this.url,this.name));try{const t=await $a();if("image"===e){if(t.has(this.name)){const e=t.get(this.name);if(this.url.endsWith("v="+e.version)){const t="image/"+e.url;this.url=`${M.origin}/data/${t}?v=${M.hashes[t]}`,this.crossOrigin=!0}else W("%cimage version not match","color:#fc4175"),W(this.name,this.url)}else"image"===e&&this.originUrl.includes("idols/name")&&(W("%cidol name display!!","color:#fc4175"),W(this.name,this.url));await async function(e){if(/^images\/content\/comics\/(web|limited|special)\/page\/\d+\.jpg/.test(e.name)){const t=parseInt(e.name.match(/page\/(\d+)\.jpg/)[1]);await Fa(),Ta.has(t)&&(e.url="https://newbiepr.gitlab.io/shinymaskr.gitlab.io/data/image/comics/4ko/"+Ta.get(t).name,e.crossOrigin=!0)}}(this)}}catch(e){}return t.call(this,e)},n=new Proxy(e.loaders.Resource,{construct(e,t,n){var o=Reflect.construct(e,t,n);return new Proxy(o,{get:(e,t,n)=>"_loadElement"==t?r:Reflect.get(e,t,n)})},get:(e,t,r)=>Reflect.get(e,t,r)});Object.defineProperty(e.loaders,"Resource",{value:n}),La=!0}var Ua=function(){return a.Date.now()},Ha=/\s/;var Ja=function(e){for(var t=e.length;t--&&Ha.test(e.charAt(t)););return t},Wa=/^\s+/;var qa=function(e){return e?e.slice(0,Ja(e)+1).replace(Wa,""):e};var Ga=function(e){return"symbol"==typeof e||y(e)&&"[object Symbol]"==v(e)},Ka=/^[-+]0x[0-9a-f]+$/i,Ya=/^0b[01]+$/i,Qa=/^0o[0-7]+$/i,Va=parseInt;var Za=function(e){if("number"==typeof e)return e;if(Ga(e))return NaN;if(fe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=fe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=qa(e);var r=Ya.test(e);return r||Qa.test(e)?Va(e.slice(2),r?2:8):Ka.test(e)?NaN:+e},Xa=Math.max,ei=Math.min;var ti=function(e,t,r){var n,o,s,a,i,c,u=0,l=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var r=n,s=o;return n=o=void 0,u=t,a=e.apply(s,r)}function h(e){return u=e,i=setTimeout(v,t),l?f(e):a}function m(e){var r=e-c;return void 0===c||r>=t||r<0||d&&e-u>=s}function v(){var e=Ua();if(m(e))return g(e);i=setTimeout(v,function(e){var r=t-(e-c);return d?ei(r,s-(e-u)):r}(e))}function g(e){return i=void 0,p&&n?f(e):(n=o=void 0,a)}function y(){var e=Ua(),r=m(e);if(n=arguments,o=this,c=e,r){if(void 0===i)return h(c);if(d)return clearTimeout(i),i=setTimeout(v,t),f(c)}return void 0===i&&(i=setTimeout(v,t)),a}return t=Za(t)||0,fe(r)&&(l=!!r.leading,s=(d="maxWait"in r)?Xa(Za(r.maxWait)||0,t):s,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==i&&clearTimeout(i),u=0,n=c=o=i=void 0},y.flush=function(){return void 0===i?a:g(Ua())},y};const ri=`\n  <style>\n  #sczh-story-tool {\n    position: absolute;\n    display: none;\n    background: #ffffff;\n    border-radius: 24px;\n    box-sizing: border-box;\n    font-family: sczh-yuanti;\n    align-items: center;\n    justify-content: center;\n    color: #ff6499;\n    text-shadow: 0 0 6px #fff;\n    cursor: pointer;\n    user-select: none;\n    width: 100px;\n    height: 100px;\n    font-size: 32px;\n    border: 7px solid transparent;\n    border-image: url(${M.origin}/data/image/border.png);\n    border-image-slice: 7;\n    transform-origin: top right;\n    transition: opacity 0.3s;\n  }\n  .story-tool-btns {\n    width: 100%;\n    height: 100%;\n    display: none;\n  }\n  .story-tool-btns .btn-download-sczh,\n  .story-tool-btns label {\n    flex: 1;\n    height: 100%;\n    background: #fff;\n    display: flex;\n    box-sizing: content-box;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    color: #c0aade;\n    text-shadow: 0 0 6px #fff;\n  }\n  .story-tool-btns .btn-download-sczh:hover {\n    color: #9f66ec;\n  }\n  .story-tool-btns label {\n    color: rgb(242, 156, 199);\n    border-right: 1px solid #c9c9c9;\n  }\n  #sczh-story-tool .btn-close-sczh {\n    height: 25px;\n    width: 50px;\n    background: rgba(0, 0, 0, 0.58);\n    color: #fff;\n    letter-spacing: 2px;\n    position: absolute;\n    right: -25px;\n    top: -20px;\n    border-radius: 4px;\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 1;\n    font-family: sczh-heiti;\n    font-size: 15px;\n  }\n  #sczh-story-tool:hover {\n    width: 200px;\n  }\n  #sczh-story-tool:hover .story-tool-btns {\n    display: flex;\n  }\n  #sczh-story-tool:hover .btn-close-sczh {\n    display: flex;\n  }\n  #sczh-story-tool:hover > .text-sczh {\n    display: none;\n  }\n  #sczh-story-tool .btn-close-sczh:hover {\n    background: rgba(0, 0, 0, 0.9);\n  }\n  #sczh-story-tool.blur {\n    opacity: 0.2;\n  }\n  .story-tool-btns label:hover {\n    color: #f270b1;\n  }\n  .story-tool-btns .btn-download-sczh:hover,\n  .story-tool-btns label:hover {\n    background-color: #f7f7f7;\n  }\n  </style>\n  <div id="sczh-story-tool"><span class="text-sczh">커뮤</span>\n    <span id="btn-close-sczh" class="btn-close-sczh">닫기</span>\n    <input type="file" style="display:none" id="ipt-preview-sczh" multiple accept=".csv">\n    <div class="story-tool-btns">\n      <label for="ipt-preview-sczh">실험</label>\n      <div id="btn-download-sczh" class="btn-download-sczh">다운</div>\n    </div>\n  </div>\n  `;let ni=!1;const oi=e=>{if(ni)return;ni=!0,document.body.insertAdjacentHTML("beforeend",ri);const t=document.getElementById("sczh-story-tool"),r=ti(()=>{const r=[.017,.22],n=window.innerHeight,o=window.innerWidth;let s=n,a=o,i=0,c=0;n/o>9/16?(s=9*o/16,i=(n-s)/2):(a=16*n/9,c=(o-a)/2),t.style.right=Math.floor(c+r[0]*a)+"px",t.style.top=Math.floor(i+r[1]*s)+"px",t.style.transform=`scale(${(s/900).toFixed(3)})`,e.name?t.style.display="flex":t.style.display="none"},300);r(),window.addEventListener("resize",r);document.getElementById("btn-download-sczh").addEventListener("click",(function(){if(e.name){((e,t)=>{const r=document.createElement("a");r.download=t,r.style.display="none";const n=new Blob([e],{type:"text/csv"});r.href=URL.createObjectURL(n),document.body.appendChild(r),r.click(),document.body.removeChild(r)})(en.unparse(e.list),e.filename)}}));document.getElementById("btn-close-sczh").addEventListener("click",(function(){t.style.display="none",M.story="normal",F()}));let n;document.getElementById("ipt-preview-sczh").addEventListener("change",(function(){const t=this.files;t.length&&t.forEach(t=>{const r=new FileReader;r.onload=t=>{const r=t.target.result,n=ys(r);if(n.has("name")){const t=n.get("name");e.preview.set(t,n),(e=>{const t=[...e].slice(-5).map(e=>(e[1]=[...e[1]],e));sessionStorage.setItem("sczh:preview",JSON.stringify(t))})(e.preview),alert(`도입${t}성공`)}},r.readAsText(t)})})),t.addEventListener("mouseenter",()=>{clearTimeout(n),t.classList.remove("blur")});const o=()=>{clearTimeout(n),n=setTimeout(()=>{t.classList.add("blur")},5e3)};t.addEventListener("mouseleave",o),o()},si=new Map,ai=new Map;let ii=!1;const ci=async()=>{if(!ii){(await cn("speaker-icon")).forEach(e=>{let{name:t,id:r,type:n}=e;t=B(t),r=B(r),n=B(n),t&&r&&("sub"===n?ai.set(t,r):si.set(t,r))}),ii=!0}return{iconMap:si,subIconMap:ai}};let ui=null;let li=!1;const di=async()=>{if(li)return;li=!0;const e=await Jr("SPEAKER");if(!e)return q("Speaker-icon module not found.");const{iconMap:r,subIconMap:n}=await ci(),o=e.getSubCharacterBackLogIconId,s=e.getCharacterBackLogIconId;e.getSubCharacterBackLogIconId=function(e){const r=t(e);return n.has(r)?n.get(r):o.call(this,e)},e.getCharacterBackLogIconId=function(e){const n=t(e);return r.has(n)?r.get(n):s.call(this,e)}},pi=(e,t)=>{let r=e,n="";return/[0-9０-９]$/.test(e)&&(n=e.match(/([0-9０-９])$/)[1],r=e.slice(0,e.length-1)),t.has(r)?t.get(r)+n:e},fi=async t=>{if(t.speaker){await di();const r=await(async()=>(ui||(ui=mn()),await ui))();let n=B(t.speaker);if(r.has(n))return t.speaker=e(r.get(n));["＆","&"].forEach(e=>{n=((e,t,r)=>{const n=e.split(t);for(let e=0;e<n.length;e++)n[e]=pi(n[e],r);return n.join(t)})(n,e,r)}),n!==t.speaker&&(t.speaker=e(n))}},hi={name:"",filename:"",list:"",preview:new Map};let mi=!1;const vi=async()=>{const t=await Jr("SCENARIO"),r=t.load;t.load=async function(...t){const n=await r.apply(this,t),o=t[0];if(!o)return n;if(M.dev&&o.includes("/assets/json/")&&Wr("STORY","#ad37c2",t,n),o.includes("/produce_events/")||o.includes("/produce_communications/")||o.includes("/produce_communications_promises/")||o.includes("/produce_communication_promise_results/")||o.includes("/support_skills/")||o.includes("/game_event_communications/")||o.includes("/special_communications/")||o.includes("/mypage_communications/")||o.includes("/produce_communication_cheers/")||o.includes("/produce_communication_auditions/")||o.includes("/business_unit_communication/")||o.includes("/produce_communication_televisions/"))try{if(!Array.isArray(n))return n;const t=o.replace(/^\/assets\/json\//,"");let r;if("edit"===M.story&&(((e,t)=>{const r=t.replace(".json",""),n=(e=>{var t;const r=e.match(/\/(\d+)$/);return null!==(t=null==r?void 0:r[1])&&void 0!==t?t:""})(r);let o=cs.get(n)||r.replace(/\//g,"_");o=o.replace("​","");const s=[];e.forEach(e=>{let t=B(G(e.text));(null==t?void 0:t.trim())?s.push({id:e.id||"0000000000000",name:e.speaker||"",text:t,trans:""}):e.select&&s.push({id:"select",name:"",text:B(G(e.select)),trans:""})}),s.push({id:"info",name:t,text:"",trans:""}),s.push({id:"번역자",name:"",text:"",trans:""}),hi.name=t,hi.filename=o+".csv",hi.list=s})(n,t),oi(hi)),(()=>{if(mi)return;mi=!0;const e=sessionStorage.getItem("sczh:preview");if(e)try{const t=JSON.parse(e),r=new Map(t);for(let[e,t]of r)r.set(e,new Map(t));hi.preview=r}catch(e){W(e)}})(),r=hi.preview.has(t)?hi.preview.get(t):await(async e=>{if(!gs){let e=await on("story.json");if(e)gs=new Map(JSON.parse(e));else{const e=await Fr("/story.json");gs=new Map(e),sn("story.json",JSON.stringify(gs))}}if(gs.has(e)){if(hs.has(e))return hs.get(e);{const t=gs.get(e),r=await Fr(`/data/story/${t}.csv`),n=ys(r);return hs.set(e,n),n}}return!1})(t),r){((t,r,n)=>{const o=Y();t.forEach(t=>{if(t.text){const s=o(t.id),a=H(t.text);r.has(a)?t.text=r.get(a):s&&r.has(""+s)?t.text=r.get(""+s):n.has(a)&&(t.text=e(n.get(a)))}if(t.select){const o=H(t.select),s=o+"-select";r.has(s)?t.select=r.get(s):n.has(o)&&(t.select=e(n.get(t.select)))}})})(n,r,await ws())}else await Ws(n,0,!1);for(let e of n)await fi(e)}catch(e){W(e)}return n}},gi=e=>{const t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.setAttribute("as","font"),t.setAttribute("type","font/woff2"),t.setAttribute("crossorigin","anonymous"),document.head.appendChild(t)},yi=(e,t)=>`/data/font/${e}.woff2?v=${t[`font/${e}.woff2`]}`,wi=async()=>{const e=document.createElement("style"),{hashes:t}=await Dr;e.innerHTML=`\n  @font-face {\n    font-family: "sczh-heiti";\n    src: url("${M.origin}${yi("heiti",t)}");\n  }\n  @font-face {\n    font-family: "sczh-yuanti";\n    src: url("${M.origin}${yi("heiti",t)}");\n  }\n  ::-webkit-scrollbar {\n    display: none;\n  }\n  `,"yuanti"===M.font1&&gi(`${M.origin}${yi("heiti",t)}`),"heiti"===M.font2&&gi(`${M.origin}${yi("heiti",t)}`),document.head.appendChild(e)};window.addEventListener("blur",(function(e){"on"===M.bgm&&e.stopImmediatePropagation()}),!1),document.addEventListener("visibilitychange",(function(e){"on"===M.bgm&&e.stopImmediatePropagation()}));let bi=0;const Ei=async()=>{var e;zr||bi>=300?(async()=>{try{await Promise.all([Ba(),wi(),Ea(),Ra(),Xr(),vi()])}catch(e){W(e)}})():(await(e=100,new Promise(t=>{setTimeout(t,e)})),bi++,bi%10==0&&W(`Waiting: ${bi/10}s`),await Ei())};"loading"!=document.readyState?Ei():window.unsafeWindow?window.unsafeWindow.addEventListener("DOMContentLoaded",Ei):window.addEventListener("DOMContentLoaded",Ei)}();
